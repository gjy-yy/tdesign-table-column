{"version":3,"file":"image.js","sources":["../../src/upload/image.tsx"],"sourcesContent":["import { defineComponent, PropType, computed } from 'vue';\n\nimport { AddIcon as TdAddIcon, DeleteIcon as TdDeleteIcon, BrowseIcon as TdBrowseIcon } from 'tdesign-icons-vue-next';\nimport TLoading from '../loading';\n\nimport { UploadFile } from './type';\nimport props from './props';\nimport { UploadRemoveOptions } from './interface';\nimport { UploadConfig } from '../config-provider/type';\n\nimport { useFormDisabled } from '../form/hooks';\nimport { useGlobalIcon } from '../hooks/useGlobalIcon';\nimport { useConfig, usePrefixClass, useCommonClassName } from '../hooks/useConfig';\n\n// props\nexport default defineComponent({\n  name: 'TImageUpload',\n\n  props: {\n    files: props.files,\n    loadingFile: {\n      type: Object as PropType<UploadFile>,\n      default: () => {\n        return null as UploadFile;\n      },\n    },\n    locale: {\n      type: Object as PropType<UploadConfig>,\n      default: () => {\n        return null as UploadConfig;\n      },\n    },\n    percent: Number,\n    showUploadProgress: props.showUploadProgress,\n    placeholder: props.placeholder,\n    multiple: props.multiple,\n    max: props.max,\n    disabled: props.disabled,\n    onClick: Function as PropType<(e: MouseEvent) => void>,\n    onRemove: Function as PropType<(options: UploadRemoveOptions) => void>,\n    onImgPreview: Function as PropType<(options: MouseEvent, file: UploadFile) => void>,\n  },\n\n  setup(props) {\n    const disabled = useFormDisabled();\n    const { classPrefix: prefix, globalConfig } = useConfig('upload');\n    const UPLOAD_NAME = usePrefixClass('upload');\n    const { AddIcon, DeleteIcon, BrowseIcon } = useGlobalIcon({\n      AddIcon: TdAddIcon,\n      DeleteIcon: TdDeleteIcon,\n      BrowseIcon: TdBrowseIcon,\n    });\n    const { STATUS } = useCommonClassName();\n\n    const showTrigger = computed(() => {\n      const { multiple, max, files } = props;\n      if (multiple) {\n        return !max || (files && files.length < max);\n      }\n      return !(files && files[0]);\n    });\n\n    const onMaskClick = (e: MouseEvent) => {\n      !showTrigger.value && props.onClick(e);\n    };\n\n    const renderCardItem = (file: UploadFile, index: number) => (\n      <li class={`${UPLOAD_NAME.value}__card-item ${prefix.value}-is--background`}>\n        <div class={`${UPLOAD_NAME.value}__card-content ${UPLOAD_NAME.value}__card-box`}>\n          <img class={`${UPLOAD_NAME.value}__card-image`} src={file.url} />\n          <div class={`${UPLOAD_NAME.value}__card-mask`} onClick={onMaskClick}>\n            <span class={`${UPLOAD_NAME.value}__card-mask-item`}>\n              <BrowseIcon\n                onClick={({ e }: { e: MouseEvent }) => {\n                  e.stopPropagation();\n                  props.onImgPreview(e, file);\n                }}\n              />\n            </span>\n            {!disabled.value && [\n              <span class={`${UPLOAD_NAME.value}__card-mask-item-divider`} key=\"divider\"></span>,\n              <span class={`${UPLOAD_NAME.value}__card-mask-item`} key=\"delete-icon\">\n                <DeleteIcon\n                  onClick={({ e }: { e: MouseEvent }) => {\n                    e.stopPropagation();\n                    props.onRemove({ e, file, index });\n                  }}\n                />\n              </span>,\n            ]}\n          </div>\n        </div>\n      </li>\n    );\n\n    const renderTrigger = () => (\n      <li\n        class={[\n          `${UPLOAD_NAME.value}__card-item ${prefix.value}-is--background`,\n          { [STATUS.value.disabled]: disabled.value },\n        ]}\n        onClick={props.onClick}\n      >\n        {props.showUploadProgress && props.loadingFile && props.loadingFile.status === 'progress' ? (\n          <div class={`${UPLOAD_NAME.value}__card-container ${UPLOAD_NAME.value}__card-box`}>\n            <TLoading />\n            <p>\n              {props.locale?.progress?.uploadingText || globalConfig.value.progress.uploadingText}{' '}\n              {Math.min(props.percent, 99)}%\n            </p>\n          </div>\n        ) : (\n          <div class={`${UPLOAD_NAME.value}__card-container ${UPLOAD_NAME.value}__card-box`}>\n            <AddIcon />\n            <p class={`${prefix.value}-size-s`}>\n              {props.placeholder ||\n                props.locale?.triggerUploadText?.image ||\n                globalConfig.value.triggerUploadText.image}\n            </p>\n          </div>\n        )}\n      </li>\n    );\n\n    return () => (\n      <ul class={`${UPLOAD_NAME.value}__card`}>\n        {props.files && props.files.map((file, index) => renderCardItem(file, index))}\n        {showTrigger.value && renderTrigger()}\n      </ul>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","files","loadingFile","type","Object","locale","percent","Number","showUploadProgress","placeholder","multiple","max","disabled","onClick","Function","onRemove","onImgPreview","setup","useFormDisabled","useConfig","prefix","classPrefix","globalConfig","UPLOAD_NAME","usePrefixClass","useGlobalIcon","AddIcon","TdAddIcon","DeleteIcon","TdDeleteIcon","BrowseIcon","TdBrowseIcon","useCommonClassName","STATUS","showTrigger","computed","length","onMaskClick","e","value","renderCardItem","file","index","_createVNode","url","stopPropagation","renderTrigger","status","progress","uploadingText","Math","min","triggerUploadText","image","map"],"mappings":"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"}