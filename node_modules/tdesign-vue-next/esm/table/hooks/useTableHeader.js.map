{"version":3,"file":"useTableHeader.js","sources":["../../../src/table/hooks/useTableHeader.tsx"],"sourcesContent":["import { SetupContext, computed, h } from 'vue';\nimport isString from 'lodash/isString';\nimport isFunction from 'lodash/isFunction';\nimport { BaseTableCol, PrimaryTableCol, TableRowData, TdBaseTableProps } from '../type';\nimport { getThRowspanAndColspan, getThList } from './useMultiHeader';\nimport useClassName from './useClassName';\nimport { TNodeReturnValue } from '../../common';\nimport { BaseTableColumns } from '../interface';\nimport TEllipsis from '../ellipsis';\n\n// 渲染表头的通用方法\nexport function renderTitle(slots: SetupContext['slots'], col: BaseTableColumns[0], index: number) {\n  const params = { col, colIndex: index };\n  if (isFunction(col.title)) {\n    return col.title(h, params);\n  }\n  if (isString(col.title) && slots[col.title]) {\n    return slots[col.title](params);\n  }\n  if (isFunction(col.render)) {\n    return (\n      col.render(h, {\n        ...params,\n        type: 'title',\n        row: {},\n        rowIndex: -1,\n      }) || col.title\n    );\n  }\n  return col.title;\n}\n\nexport default function useTableHeader(props: TdBaseTableProps) {\n  const { tableSortClasses, tableFilterClasses } = useClassName();\n  // 一次性获取 colspan 和 rowspan 可以避免其他数据更新导致的重复计算\n  const spansAndLeafNodes = computed(() => getThRowspanAndColspan(props.columns));\n  // 表头二维数据\n  const thList = computed(() => getThList(props.columns));\n  const isMultipleHeader = computed(() => thList.value.length > 1);\n\n  const renderTitleWidthIcon = (\n    [title, sortIcon, filterIcon]: TNodeReturnValue[],\n    col: PrimaryTableCol<TableRowData>,\n    colIndex: number,\n    ellipsisTitle: BaseTableCol['ellipsisTitle'],\n    attach: HTMLElement,\n  ) => {\n    const classes = {\n      [tableSortClasses.sortable]: sortIcon,\n      [tableFilterClasses.filterable]: filterIcon,\n    };\n    const content = isFunction(ellipsisTitle) ? ellipsisTitle(h, { col, colIndex }) : undefined;\n    return (\n      <div class={classes}>\n        <div class={tableSortClasses.title}>\n          {col.ellipsis && ellipsisTitle !== false && ellipsisTitle !== null ? (\n            <TEllipsis\n              placement=\"bottom-right\"\n              attach={attach ? () => attach : undefined}\n              tooltipContent={content && (() => content)}\n              tooltipProps={typeof ellipsisTitle === 'object' ? ellipsisTitle : undefined}\n            >\n              {title}\n            </TEllipsis>\n          ) : (\n            <div>{title}</div>\n          )}\n          {Boolean(sortIcon || filterIcon) && (\n            <div class={tableFilterClasses.iconWrap}>\n              {sortIcon}\n              {filterIcon}\n            </div>\n          )}\n        </div>\n      </div>\n    );\n  };\n\n  return {\n    thList,\n    isMultipleHeader,\n    spansAndLeafNodes,\n    renderTitleWidthIcon,\n  };\n}\n"],"names":["renderTitle","slots","col","index","params","colIndex","isFunction","title","h","isString","render","type","row","rowIndex","useTableHeader","props","useClassName","tableSortClasses","tableFilterClasses","spansAndLeafNodes","computed","getThRowspanAndColspan","columns","thList","getThList","isMultipleHeader","value","length","renderTitleWidthIcon","ellipsisTitle","attach","sortIcon","filterIcon","classes","sortable","filterable","content","_createVNode","ellipsis","Boolean","iconWrap"],"mappings":"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"}