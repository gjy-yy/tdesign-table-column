{"version":3,"file":"head-menu.js","sources":["../../src/menu/head-menu.tsx"],"sourcesContent":["import { defineComponent, computed, provide, ref, reactive, watch, onMounted, watchEffect, toRefs } from 'vue';\nimport log from '../_common/js/log/log';\nimport props from './head-menu-props';\nimport { MenuValue } from './type';\nimport { TdMenuInterface, TdOpenType } from './const';\nimport { Tabs, TabPanel } from '../tabs';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport VMenu from './v-menu';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useVModel from '../hooks/useVModel';\nimport useDefaultValue from '../hooks/useDefaultValue';\n\nexport default defineComponent({\n  name: 'THeadMenu',\n  props: { ...props },\n  setup(props, ctx) {\n    const classPrefix = usePrefixClass();\n    watchEffect(() => {\n      if (ctx.slots.options) {\n        log.warnOnce('TMenu', '`options` slot is going to be deprecated, please use `operations` for slot instead.');\n      }\n    });\n    const { value, modelValue, expanded } = toRefs(props);\n    const [activeValue, setActiveValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n    const [expandValues, setExpanded] = useDefaultValue(expanded, props.defaultExpanded, props.onExpand, 'expanded');\n    const activeValues = ref([]);\n    const theme = computed(() => props.theme);\n    const menuClass = computed(() => [\n      `${classPrefix.value}-menu`,\n      `${classPrefix.value}-head-menu`,\n      `${classPrefix.value}-menu--${props.theme}`,\n    ]);\n    const mode = ref(props.expandType);\n    const submenu = reactive([]);\n    const vMenu = new VMenu({ isMutex: true, expandValues: expandValues.value });\n\n    provide<TdMenuInterface>('TdMenu', {\n      mode,\n      theme,\n      vMenu,\n      isHead: true,\n      expandValues,\n      activeValue,\n      activeValues,\n      select: (value: MenuValue) => {\n        setActiveValue(value);\n      },\n      open: (value: MenuValue, type: TdOpenType) => {\n        const expanded = [...expandValues.value];\n        const index = expanded.indexOf(value);\n\n        if (mode.value === 'popup') {\n          if (type === 'add') {\n            if (index === -1) {\n              // 可能初始expanded里包含了该value\n              expanded.push(value);\n            }\n          } else if (type === 'remove') {\n            expanded.splice(index, 1);\n          }\n        } else {\n          expanded.splice(0, 1);\n          if (index === -1) {\n            expanded.push(value);\n          }\n        }\n        setExpanded(expanded);\n      },\n    });\n\n    // methods\n    const handleTabChange = (value: MenuValue) => {\n      setActiveValue(value);\n    };\n\n    const handleSubmenuExpand = (value: MenuValue) => {\n      const ans = vMenu.getChild(value);\n      submenu.length = 0;\n      submenu.push(...ans);\n    };\n\n    // watch\n    watch(expandValues, (value) => {\n      if (mode.value === 'normal') {\n        handleSubmenuExpand(value[0]);\n      }\n    });\n    const updateActiveValues = (value: MenuValue) => {\n      activeValues.value = vMenu.select(value);\n    };\n    watch(activeValue, updateActiveValues);\n    watch(\n      () => props.expandType,\n      (value) => {\n        mode.value = value;\n      },\n    );\n\n    onMounted(() => {\n      activeValues.value = vMenu.select(activeValue.value);\n      if (expandValues.value?.length > 0) {\n        handleSubmenuExpand(expandValues.value[0]); // 顶部导航只能同时展开一个子菜单\n      }\n    });\n\n    return {\n      classPrefix,\n      mode,\n      menuClass,\n      expandValues,\n      activeValue,\n      activeValues,\n      submenu,\n      handleTabChange,\n    };\n  },\n  methods: {\n    renderNormalSubmenu() {\n      if (this.submenu.length === 0) return null;\n      return (\n        <ul class={[`${this.classPrefix}-head-menu__submenu`, `${this.classPrefix}-submenu`]}>\n          {\n            <Tabs value={this.activeValue} onChange={this.handleTabChange}>\n              {this.submenu.map((item) => (\n                <TabPanel value={item.value} label={item.vnode()[0]?.children} />\n              ))}\n            </Tabs>\n          }\n        </ul>\n      );\n    },\n  },\n  render() {\n    const { classPrefix } = this;\n    const operations = renderContent(this, 'operations', 'options');\n    const logo = renderTNodeJSX(this, 'logo');\n    return (\n      <div class={this.menuClass}>\n        <div class={`${classPrefix}-head-menu__inner`}>\n          {logo && <div class={`${classPrefix}-menu__logo`}>{logo}</div>}\n          <ul class={`${classPrefix}-menu`}>{renderContent(this, 'default', 'content')}</ul>\n          {operations && <div class={`${classPrefix}-menu__operations`}>{operations}</div>}\n        </div>\n        {this.mode === 'normal' && this.renderNormalSubmenu()}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","ctx","classPrefix","usePrefixClass","watchEffect","slots","options","log","warnOnce","toRefs","value","modelValue","expanded","useVModel","defaultValue","onChange","activeValue","setActiveValue","useDefaultValue","defaultExpanded","onExpand","expandValues","setExpanded","activeValues","ref","theme","computed","menuClass","mode","expandType","submenu","reactive","vMenu","VMenu","isMutex","provide","isHead","select","open","type","index","indexOf","push","splice","handleTabChange","handleSubmenuExpand","ans","getChild","length","watch","updateActiveValues","onMounted","methods","renderNormalSubmenu","_createVNode","map","item","vnode","children","render","operations","renderContent","logo","renderTNodeJSX"],"mappings":"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"}