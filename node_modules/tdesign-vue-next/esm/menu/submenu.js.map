{"version":3,"file":"submenu.js","sources":["../../src/menu/submenu.tsx"],"sourcesContent":["import {\n  defineComponent,\n  computed,\n  inject,\n  ref,\n  provide,\n  onMounted,\n  getCurrentInstance,\n  watch,\n  Slots,\n  toRefs,\n  reactive,\n} from 'vue';\nimport props from './submenu-props';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport { TdMenuInterface, TdSubMenuInterface, TdMenuItem } from './const';\nimport FakeArrow from '../common-components/fake-arrow';\nimport useRipple from '../hooks/useRipple';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { Popup, PopupPlacement } from '../popup';\n\nexport default defineComponent({\n  name: 'TSubmenu',\n\n  props,\n  setup(props, ctx) {\n    const classPrefix = usePrefixClass();\n    const menu = inject<TdMenuInterface>('TdMenu');\n    const { theme, activeValues, expandValues, mode, isHead, open } = menu;\n    const submenu = inject<TdSubMenuInterface>('TdSubmenu', null);\n\n    const menuItems = ref([]); // 因composition-api的缺陷，不用reactive， 详见：https://github.com/vuejs/composition-api/issues/637\n    const isActive = computed(() => activeValues.value.indexOf(props.value) > -1);\n    const popupVisible = ref(false);\n    const isCursorInPopup = ref(false);\n    const rippleColor = computed(() => (theme.value === 'light' ? '#E7E7E7' : '#383838'));\n    const isOpen = computed(() => {\n      if (mode.value === 'popup') {\n        return popupVisible.value;\n      }\n      return expandValues ? expandValues.value?.includes(props.value) : false;\n    });\n    const isNested = ref(false); // 是否嵌套\n\n    const submenuRef = ref<HTMLElement>();\n    useRipple(submenuRef, rippleColor);\n\n    const classes = computed(() => [\n      `${classPrefix.value}-submenu`,\n      {\n        [`${classPrefix.value}-is-disabled`]: props.disabled,\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n      },\n    ]);\n    const popupClass = computed(() => [\n      `${classPrefix.value}-menu__popup`,\n      `${classPrefix.value}-menu__popup--${theme.value}`,\n      `${classPrefix.value}-is-${isHead ? 'horizontal' : 'vertical'}`,\n      {\n        [`${classPrefix.value}-is-opened`]: popupVisible.value,\n      },\n      'narrow-scrollbar',\n    ]);\n    const submenuClass = computed(() => [\n      `${classPrefix.value}-menu__item`,\n      `${classPrefix.value}-menu__item-spacer`,\n      `${classPrefix.value}-menu__item-spacer--${isHead && !isNested.value ? 'bottom' : 'right'}`,\n      {\n        [`${classPrefix.value}-is-disabled`]: props.disabled,\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n        [`${classPrefix.value}-is-active`]: isActive.value,\n      },\n    ]);\n    const subClass = computed(() => [\n      `${classPrefix.value}-menu__sub`,\n      {\n        [`${classPrefix.value}-is-opened`]: isOpen.value,\n      },\n    ]);\n    const arrowClass = computed(() => [\n      {\n        [`${classPrefix.value}-fake-arrow--active`]: isOpen.value,\n      },\n    ]);\n\n    // methods\n    const handleMouseEnter = () => {\n      if (props.disabled) return;\n      setTimeout(() => {\n        if (!popupVisible.value) {\n          open(props.value);\n        }\n        popupVisible.value = true;\n      }, 0);\n    };\n    const handleMouseLeave = (e: MouseEvent) => {\n      setTimeout(() => {\n        const inPopup = (e.relatedTarget as HTMLElement)?.classList.contains(`${classPrefix.value}-menu__popup`);\n\n        if (isCursorInPopup.value || inPopup) return;\n        popupVisible.value = false;\n      }, 0);\n    };\n    const handleMouseLeavePopup = (e: any) => {\n      const { toElement, relatedTarget } = e;\n      let target = toElement || relatedTarget;\n      const isSubmenu = (el: Element) => el === submenuRef.value;\n\n      while (target !== document && !isSubmenu(target)) {\n        target = target.parentNode;\n      }\n\n      isCursorInPopup.value = false;\n\n      if (!isSubmenu(target)) {\n        popupVisible.value = false;\n      }\n    };\n    const handleEnterPopup = () => {\n      isCursorInPopup.value = true;\n    };\n\n    const handleSubmenuItemClick = () => {\n      if (props.disabled) return;\n      open(props.value);\n    };\n\n    watch(popupVisible, (visible) => {\n      menu.open(props.value, visible ? 'add' : 'remove');\n    });\n\n    // provide\n    const { value } = toRefs(props);\n    provide<TdSubMenuInterface>(\n      'TdSubmenu',\n      reactive({\n        value,\n        addMenuItem: (item: TdMenuItem) => {\n          menuItems.value.push(item);\n          if (submenu) {\n            submenu.addMenuItem(item);\n          }\n        },\n      }),\n    );\n\n    onMounted(() => {\n      menu?.vMenu?.add({ value: props.value, parent: submenu?.value, vnode: ctx.slots.default });\n      const instance = getCurrentInstance();\n      let node = instance.parent;\n\n      while (node && !/^t(head)?menu/i.test(node?.type.name)) {\n        if (/submenu/i.test(node?.type.name)) {\n          isNested.value = true;\n          break;\n        }\n        node = node?.parent;\n      }\n    });\n\n    return {\n      classPrefix,\n      menuItems,\n      mode,\n      theme,\n      isHead,\n      isNested,\n      classes,\n      subClass,\n      arrowClass,\n      popupClass,\n      submenuClass,\n      submenuRef,\n      popupVisible,\n      isCursorInPopup,\n      handleEnterPopup,\n      handleMouseEnter,\n      handleMouseLeave,\n      handleMouseLeavePopup,\n      handleSubmenuItemClick,\n    };\n  },\n  methods: {\n    renderPopup(triggerElement: Slots[]) {\n      let placement = 'right-top';\n      if (!this.isNested && this.isHead) {\n        placement = 'bottom-left';\n      }\n      const overlayInnerStyle = { [`margin-${this.isHead ? 'top' : 'left'}`]: '20px' };\n      const popupWrapper = (\n        <div\n          class={[\n            // ...this.popupClass,\n            `${this.classPrefix}-menu__spacer`,\n            `${this.classPrefix}-menu__spacer--${!this.isNested && this.isHead ? 'top' : 'left'}`,\n          ]}\n          onMouseenter={this.handleEnterPopup}\n          onMouseleave={this.handleMouseLeavePopup}\n        >\n          <ul class={`${this.classPrefix}-menu__popup-wrapper`}>{renderContent(this, 'default', 'content')}</ul>\n        </div>\n      );\n      const popupInside = (\n        <div ref=\"submenuRef\" class={this.submenuClass}>\n          {triggerElement}\n          <div class={this.popupClass}>{popupWrapper}</div>\n        </div>\n      );\n      const slots = {\n        content: () => popupWrapper,\n      };\n      const realPopup = (\n        <Popup\n          overlayInnerClassName={[...this.popupClass]}\n          visible={this.popupVisible}\n          placement={placement as PopupPlacement}\n          overlayInnerStyle={overlayInnerStyle}\n          v-slots={slots}\n        >\n          <div ref=\"submenuRef\" class={this.submenuClass}>\n            {triggerElement}\n          </div>\n        </Popup>\n      );\n\n      return this.isNested ? popupInside : realPopup;\n    },\n    renderHeadSubmenu() {\n      const icon = renderTNodeJSX(this, 'icon');\n      const normalSubmenu = [\n        <div ref=\"submenuRef\" class={this.submenuClass} onClick={this.handleSubmenuItemClick}>\n          {icon}\n          <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>\n        </div>,\n        <ul style=\"opacity: 0; width: 0; height: 0; overflow: hidden\">{renderContent(this, 'default', 'content')}</ul>,\n      ];\n\n      const needRotate = this.mode === 'popup' && this.isNested;\n\n      const triggerElement = [\n        icon,\n        <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>,\n        <FakeArrow\n          overlayClassName={this.arrowClass}\n          overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)` }}\n        />,\n      ];\n\n      return this.mode === 'normal' ? normalSubmenu : this.renderPopup(triggerElement);\n    },\n    renderSubmenu() {\n      const hasContent = this.$slots.content || this.$slots.default;\n      const icon = renderTNodeJSX(this, 'icon');\n      const child = renderContent(this, 'default', 'content');\n      let { parent } = getCurrentInstance();\n      let paddingLeft = 44;\n\n      while (parent && parent.type.name !== 'TMenu') {\n        if (parent.type.name === 'TSubmenu') {\n          paddingLeft += 16;\n        }\n        parent = parent.parent;\n      }\n\n      const needRotate = this.mode === 'popup' && this.isNested;\n\n      const normalSubmenu = [\n        <div ref=\"submenuRef\" class={this.submenuClass} onClick={this.handleSubmenuItemClick}>\n          {icon}\n          <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>\n          {hasContent && (\n            <FakeArrow\n              overlayClassName={this.arrowClass}\n              overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)` }}\n            />\n          )}\n        </div>,\n        <ul class={this.subClass} style={{ '--padding-left': `${paddingLeft}px` }}>\n          {child}\n        </ul>,\n      ];\n\n      const triggerElement = [\n        icon,\n        <span class={[`${this.classPrefix}-menu__content`]}>{renderTNodeJSX(this, 'title', { silent: true })}</span>,\n        <FakeArrow\n          overlayClassName={this.arrowClass}\n          overlayStyle={{ transform: `rotate(${needRotate ? -90 : 0}deg)`, 'margin-left': 'auto' }}\n        />,\n      ];\n\n      return this.mode === 'normal' ? normalSubmenu : this.renderPopup(triggerElement);\n    },\n  },\n  render() {\n    let child = null;\n    let events = {};\n\n    if (this.mode === 'popup') {\n      events = {\n        onMouseenter: this.handleMouseEnter,\n        onMouseleave: this.handleMouseLeave,\n      };\n    }\n    if (Object.keys(this.$slots).length > 0) {\n      child = this.isHead ? this.renderHeadSubmenu() : this.renderSubmenu();\n    }\n    return (\n      <li class={this.classes} {...events}>\n        {child}\n      </li>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","ctx","classPrefix","usePrefixClass","menu","inject","theme","activeValues","expandValues","mode","isHead","open","submenu","menuItems","ref","isActive","computed","value","indexOf","popupVisible","isCursorInPopup","rippleColor","isOpen","includes","isNested","submenuRef","useRipple","classes","disabled","popupClass","submenuClass","subClass","arrowClass","handleMouseEnter","setTimeout","handleMouseLeave","e","inPopup","relatedTarget","classList","contains","handleMouseLeavePopup","toElement","target","isSubmenu","el","document","parentNode","handleEnterPopup","handleSubmenuItemClick","watch","visible","toRefs","provide","reactive","addMenuItem","item","push","onMounted","vMenu","add","parent","vnode","slots","instance","getCurrentInstance","node","test","type","methods","renderPopup","triggerElement","placement","overlayInnerStyle","popupWrapper","_createVNode","renderContent","popupInside","content","realPopup","renderHeadSubmenu","icon","renderTNodeJSX","normalSubmenu","silent","needRotate","transform","renderSubmenu","hasContent","$slots","child","paddingLeft","render","events","onMouseenter","onMouseleave","Object","keys","length","_mergeProps"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAqBA,eAAeA,eAAgB,CAAA;AAC7BC,EAAAA,IAAM,EAAA,UADuB;AAG7BC,EAAAA,KAAA,EAAAA,KAH6B;AAI7BC,EAAAA,KAJ6B,EAIvBD,SAAAA,KAAAA,CAAAA,MAJuB,EAIhBE,GAJgB,EAIX;IAChB,IAAMC,cAAcC,cAAe,EAAnC,CAAA;AACM,IAAA,IAAAC,IAAA,GAAOC,OAAwB,SAA/B,CAAA;AACN,IAAA,IAAQC,KAAR,GAAkEF,IAAlE,CAAQE,KAAR;AAAA,QAAeC,YAAf,GAAkEH,IAAlE,CAAeG,YAAf;AAAA,QAA6BC,YAA7B,GAAkEJ,IAAlE,CAA6BI,YAA7B;AAAA,QAA2CC,IAA3C,GAAkEL,IAAlE,CAA2CK,IAA3C;AAAA,QAAiDC,MAAjD,GAAkEN,IAAlE,CAAiDM,MAAjD;AAAA,QAAyDC,IAAzD,GAAkEP,IAAlE,CAAyDO,IAAzD,CAAA;AACM,IAAA,IAAAC,OAAA,GAAUP,MAA2B,CAAA,WAAA,EAAa,IAAb,CAArC,CAAA;AAEA,IAAA,IAAAQ,SAAA,GAAYC,GAAI,CAAA,EAAA,CAAhB,CAAA;IACA,IAAAC,QAAA,GAAWC,SAAS,YAAA;MAAA,OAAMT,YAAA,CAAaU,KAAb,CAAmBC,OAAnB,CAA2BnB,MAAAA,CAAMkB,KAAjC,CAA0C,GAAA,CAAE,CAAlD,CAAA;AAAA,MAApB,CAAA;AACA,IAAA,IAAAE,YAAA,GAAeL,IAAI,MAAnB,CAAA;AACA,IAAA,IAAAM,eAAA,GAAkBN,IAAI,MAAtB,CAAA;IACN,IAAMO,cAAcL,QAAS,CAAA,YAAA;MAAA,OAAOV,MAAMW,KAAN,KAAgB,OAAhB,GAA0B,SAA1B,GAAsC,SAA7C,CAAA;AAAA,KAAA,CAA7B,CAAA;AACM,IAAA,IAAAK,MAAA,GAASN,SAAS,YAAM;AAAA,MAAA,IAAA,mBAAA,CAAA;;AACxB,MAAA,IAAAP,IAAA,CAAKQ,KAAL,KAAe,OAAf,EAAwB;QAC1B,OAAOE,YAAa,CAAAF,KAApB,CAAA;AACF,OAAA;;AACA,MAAA,OAAOT,sCAAeA,YAAa,CAAAS,WAAb,IAAA,IAAA,mBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,mBAAA,CAAoBM,QAApB,CAA6BxB,MAAAA,CAAMkB,KAAnC,IAA4C,KAAlE,CAAA;AACD,MALK,CAAA;AAMA,IAAA,IAAAO,QAAA,GAAWV,IAAI,MAAf,CAAA;IAEN,IAAMW,aAAaX,GAAiB,EAApC,CAAA;AACAY,IAAAA,SAAA,CAAUD,UAAV,EAAsBJ,WAAtB,CAAA,CAAA;IAEM,IAAAM,OAAA,GAAUX,SAAS,YAAA;AAAA,MAAA,IAAA,IAAA,CAAA;;MAAA,OAAM,CAAA,EAAA,CAAA,MAAA,CAC1Bd,WAAY,CAAAe,KADc,2DAGvBf,WAAY,CAAAe,KAHW,EAGWlB,cAAAA,CAAAA,EAAAA,MAAM,CAAA6B,QAHjB,CAAA,EAAA,eAAA,CAAA,IAAA,EAAA,EAAA,CAAA,MAAA,CAIvB1B,WAAY,CAAAe,KAJW,iBAISK,MAAO,CAAAL,KAJhB,CAAN,EAAA,IAAA,EAAA,CAAA;AAAA,MAAnB,CAAA;IAOA,IAAAY,UAAA,GAAab,SAAS,YAAA;AAAA,MAAA,OAAM,CAC7Bd,EAAAA,CAAAA,MAAAA,CAAAA,WAAY,CAAAe,KADiB,6BAE7Bf,WAAY,CAAAe,KAFiB,EAAA,gBAAA,CAAA,CAAA,MAAA,CAEKX,KAAM,CAAAW,KAFX,CAAA,EAAA,EAAA,CAAA,MAAA,CAG7Bf,WAAA,CAAYe,KAHiB,EAGLP,MAAAA,CAAAA,CAAAA,MAAAA,CAAAA,MAAA,GAAS,YAAT,GAAwB,UAHnB,iCAK1BR,WAAY,CAAAe,KALc,EAAA,YAAA,CAAA,EAKME,YAAa,CAAAF,KALnB,CAAA,EAOhC,kBAPgC,CAAN,CAAA;AAAA,MAAtB,CAAA;IASA,IAAAa,YAAA,GAAed,SAAS,YAAA;AAAA,MAAA,IAAA,KAAA,CAAA;;MAAA,OAAM,CAAA,EAAA,CAAA,MAAA,CAC/Bd,WAAY,CAAAe,KADmB,4BAE/Bf,WAAY,CAAAe,KAFmB,EAG/Bf,oBAAAA,CAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WAAY,CAAAe,KAHmB,EAAA,sBAAA,CAAA,CAAA,MAAA,CAGSP,UAAU,CAACc,QAAA,CAASP,KAApB,GAA4B,QAA5B,GAAuC,OAHhD,iDAK5Bf,WAAY,CAAAe,KALgB,EAKMlB,cAAAA,CAAAA,EAAAA,MAAM,CAAA6B,QALZ,CAAA,EAAA,eAAA,CAAA,KAAA,EAAA,EAAA,CAAA,MAAA,CAM5B1B,WAAY,CAAAe,KANgB,EAAA,YAAA,CAAA,EAMIK,MAAO,CAAAL,KANX,oCAO5Bf,WAAY,CAAAe,KAPgB,EAOIF,YAAAA,CAAAA,EAAAA,QAAS,CAAAE,KAPb,CAAN,EAAA,KAAA,EAAA,CAAA;AAAA,MAAxB,CAAA;IAUA,IAAAc,QAAA,GAAWf,SAAS,YAAA;AAAA,MAAA,OAAM,CAC3Bd,EAAAA,CAAAA,MAAAA,CAAAA,WAAY,CAAAe,KADe,EAGxBf,YAAAA,CAAAA,EAAAA,eAAAA,CAAAA,EAAAA,EAAAA,EAAAA,CAAAA,MAAAA,CAAAA,WAAY,CAAAe,KAHY,EAGQK,YAAAA,CAAAA,EAAAA,MAAO,CAAAL,KAHf,CAAN,CAAA,CAAA;AAAA,MAApB,CAAA;IAMA,IAAAe,UAAA,GAAahB,SAAS,YAAA;MAAA,OAAM,CAAA,eAAA,CAAA,EAAA,EAAA,EAAA,CAAA,MAAA,CAE1Bd,WAAY,CAAAe,KAFc,0BAEeK,MAAO,CAAAL,KAFtB,CAAN,CAAA,CAAA;AAAA,MAAtB,CAAA;;AAON,IAAA,IAAMgB,mBAAmB,SAAnBA,gBAAmB,GAAM;MAC7B,IAAIlC,MAAM,CAAA6B,QAAV,EAAoB,OAAA;AACpBM,MAAAA,UAAA,CAAW,YAAM;AACX,QAAA,IAAA,CAACf,aAAaF,KAAd,EAAqB;AACvBN,UAAAA,IAAA,CAAKZ,OAAMkB,KAAX,CAAA,CAAA;AACF,SAAA;;QACAE,YAAA,CAAaF,KAAb,GAAqB,IAArB,CAAA;OAJF,EAKG,CALH,CAAA,CAAA;KAFF,CAAA;;AASM,IAAA,IAAAkB,gBAAA,GAAmB,SAAnBA,gBAAmB,CAACC,CAAD,EAAmB;AAC1CF,MAAAA,UAAA,CAAW,YAAM;AAAA,QAAA,IAAA,gBAAA,CAAA;;AACf,QAAA,IAAMG,8BAAWD,CAAE,CAAAE,mBAAF,IAAA,IAAA,gBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,gBAAA,CAAiCC,SAAjC,CAA2CC,QAA3C,CAAA,EAAA,CAAA,MAAA,CAAuDtC,YAAYe,KAAnE,EAAjB,cAAA,CAAA,CAAA,CAAA;AAEA,QAAA,IAAIG,gBAAgBH,KAAhB,IAAyBoB,OAA7B,EAAsC,OAAA;QACtClB,YAAA,CAAaF,KAAb,GAAqB,KAArB,CAAA;OAJF,EAKG,CALH,CAAA,CAAA;KADI,CAAA;;AAQA,IAAA,IAAAwB,qBAAA,GAAwB,SAAxBA,qBAAwB,CAACL,CAAD,EAAY;AAClC,MAAA,IAAEM,SAAF,GAA+BN,CAA/B,CAAEM,SAAF;AAAA,UAAaJ,aAAb,GAA+BF,CAA/B,CAAaE,aAAb,CAAA;AACN,MAAA,IAAIK,SAASD,SAAa,IAAAJ,aAA1B,CAAA;;AACA,MAAA,IAAMM,SAAY,GAAA,SAAZA,SAAY,CAACC,EAAD,EAAA;AAAA,QAAA,OAAiBA,EAAA,KAAOpB,UAAW,CAAAR,KAAnC,CAAA;OAAlB,CAAA;;MAEA,OAAO0B,MAAW,KAAAG,QAAX,IAAuB,CAACF,SAAA,CAAUD,MAAV,CAA/B,EAAkD;QAChDA,MAAA,GAASA,MAAO,CAAAI,UAAhB,CAAA;AACF,OAAA;;MAEA3B,eAAA,CAAgBH,KAAhB,GAAwB,KAAxB,CAAA;;AAEI,MAAA,IAAA,CAAC2B,SAAU,CAAAD,MAAA,CAAX,EAAoB;QACtBxB,YAAA,CAAaF,KAAb,GAAqB,KAArB,CAAA;AACF,OAAA;KAbI,CAAA;;AAeN,IAAA,IAAM+B,mBAAmB,SAAnBA,gBAAmB,GAAM;MAC7B5B,eAAA,CAAgBH,KAAhB,GAAwB,IAAxB,CAAA;KADF,CAAA;;AAIA,IAAA,IAAMgC,yBAAyB,SAAzBA,sBAAyB,GAAM;MACnC,IAAIlD,MAAM,CAAA6B,QAAV,EAAoB,OAAA;AACpBjB,MAAAA,IAAA,CAAKZ,OAAMkB,KAAX,CAAA,CAAA;KAFF,CAAA;;AAKMiC,IAAAA,KAAA,CAAA/B,YAAA,EAAc,UAACgC,OAAD,EAAa;MAC/B/C,IAAA,CAAKO,IAAL,CAAUZ,MAAAA,CAAMkB,KAAhB,EAAuBkC,OAAA,GAAU,KAAV,GAAkB,QAAzC,CAAA,CAAA;AACD,KAFK,CAAA,CAAA;;IAKN,IAAkBC,OAAAA,GAAAA,MAAA,CAAOrD,MAAP,CAAlB;QAAQkB,KAAR,WAAQA,KAAR,CAAA;;AACAoC,IAAAA,OAAA,CACE,WADF,EAEEC,QAAS,CAAA;AACPrC,MAAAA,KAAA,EAAAA,KADO;MAEPsC,WAAA,EAAa,SAACC,WAAAA,CAAAA,IAAD,EAAsB;AACvB3C,QAAAA,SAAA,CAAAI,KAAA,CAAMwC,IAAN,CAAWD,IAAX,CAAA,CAAA;;AACV,QAAA,IAAI5C,OAAJ,EAAa;UACXA,OAAA,CAAQ2C,WAAR,CAAoBC,IAApB,CAAA,CAAA;AACF,SAAA;AACF,OAAA;AAPO,KAAA,CAFX,CAAA,CAAA;AAaAE,IAAAA,SAAA,CAAU,YAAM;AAAA,MAAA,IAAA,WAAA,CAAA;;MACdtD,IAAA,KAAA,IAAA,IAAAA,IAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,CAAA,WAAA,GAAAA,IAAA,CAAMuD,KAAN,MAAaC,IAAAA,IAAAA,WAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,WAAAA,CAAAA,GAAb,CAAiB;QAAE3C,KAAA,EAAOlB,MAAM,CAAAkB,KAAf;AAAsB4C,QAAAA,MAAQ,EAAAjD,OAAA,KAAA,IAAA,IAAAA,OAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAA,CAASK,KAAvC;QAA8C6C,KAAA,EAAO7D,GAAI,CAAA8D,KAAJ,CAAA,SAAA,CAAA;OAAtE,CAAA,CAAA;MACA,IAAMC,WAAWC,kBAAmB,EAApC,CAAA;AACA,MAAA,IAAIC,OAAOF,QAAS,CAAAH,MAApB,CAAA;;AAEA,MAAA,OAAOK,QAAQ,CAAC,gBAAA,CAAiBC,IAAjB,CAAA,CAAA,KAAA,GAAsBD,IAAtB,MAAA,IAAA,IAAA,KAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAsB,KAAME,CAAAA,IAAN,CAAWtE,IAAjC,CAAhB,EAAwD;AAAA,QAAA,IAAA,KAAA,EAAA,MAAA,EAAA,MAAA,CAAA;;QACtD,IAAI,UAAA,CAAWqE,IAAX,CAAA,CAAA,MAAA,GAAgBD,IAAhB,MAAA,IAAA,IAAA,MAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAgB,OAAME,IAAN,CAAWtE,IAA3B,CAAJ,EAAsC;UACpC0B,QAAA,CAASP,KAAT,GAAiB,IAAjB,CAAA;AACA,UAAA,MAAA;AACF,SAAA;;AACAiD,QAAAA,IAAA,GAAOA,CAAAA,MAAAA,GAAAA,IAAP,MAAO,IAAA,IAAA,MAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,MAAA,CAAML,MAAb,CAAA;AACF,OAAA;AACD,KAZD,CAAA,CAAA;IAcO,OAAA;AACL3D,MAAAA,WAAA,EAAAA,WADK;AAELW,MAAAA,SAAA,EAAAA,SAFK;AAGLJ,MAAAA,IAAA,EAAAA,IAHK;AAILH,MAAAA,KAAA,EAAAA,KAJK;AAKLI,MAAAA,MAAA,EAAAA,MALK;AAMLc,MAAAA,QAAA,EAAAA,QANK;AAOLG,MAAAA,OAAA,EAAAA,OAPK;AAQLI,MAAAA,QAAA,EAAAA,QARK;AASLC,MAAAA,UAAA,EAAAA,UATK;AAULH,MAAAA,UAAA,EAAAA,UAVK;AAWLC,MAAAA,YAAA,EAAAA,YAXK;AAYLL,MAAAA,UAAA,EAAAA,UAZK;AAaLN,MAAAA,YAAA,EAAAA,YAbK;AAcLC,MAAAA,eAAA,EAAAA,eAdK;AAeL4B,MAAAA,gBAAA,EAAAA,gBAfK;AAgBLf,MAAAA,gBAAA,EAAAA,gBAhBK;AAiBLE,MAAAA,gBAAA,EAAAA,gBAjBK;AAkBLM,MAAAA,qBAAA,EAAAA,qBAlBK;AAmBLQ,MAAAA,sBAAA,EAAAA,sBAAAA;KAnBK,CAAA;GA3IoB;AAiK7BoB,EAAAA,OAAS,EAAA;IACPC,WADO,EAAA,SAAA,WAAA,CACKC,cADL,EAC8B;AAAA,MAAA,IAAA,KAAA,GAAA,IAAA,CAAA;;MACnC,IAAIC,SAAY,GAAA,WAAhB,CAAA;;AACA,MAAA,IAAI,CAAC,IAAKhD,CAAAA,QAAN,IAAkB,IAAA,CAAKd,MAA3B,EAAmC;AACrB8D,QAAAA,SAAA,GAAA,aAAA,CAAA;AACd,OAAA;;MACM,IAAAC,iBAAA,GAAiC,eAAA,CAAA,EAAA,EAAA,SAAA,CAAA,MAAA,CAAA,IAAA,CAAK/D,MAAL,GAAc,KAAd,GAAsB,MAAvD,CAAkE,EAAA,MAAlE,CAAA,CAAA;;AACA,MAAA,IAAAgE,YAAA,GAAAC,WAAA,CAAA,KAAA,EAAA;AAAA,QAAA,OAAA,EAEK,WAEF,IAAKzE,CAAAA,WAFH,EAGF,eAAA,CAAA,EAAA,EAAA,CAAA,MAAA,CAAA,IAAA,CAAKA,WAHH,EAGgC,iBAAA,CAAA,CAAA,MAAA,CAAA,CAAC,IAAKsB,CAAAA,QAAN,IAAkB,IAAKd,CAAAA,MAAvB,GAAgC,KAAhC,GAAwC,MAHxE,CAFL,CAAA;AAAA,QAAA,cAAA,EAOY,KAAKsC,gBAPjB;AAAA,QAAA,cAAA,EAQY,IAAKP,CAAAA,qBAAAA;AARjB,OAAA,EAAA,CAAAkC,WAAA,CAAA,IAAA,EAAA;AAAA,QAAA,OAAA,EAAA,EAAA,CAAA,MAAA,CAUY,KAAKzE,WAVjB,EAAA,sBAAA,CAAA;OAUqD0E,EAAAA,CAAAA,cAAc,MAAM,WAAW,UAVpF,CAAA,CAAA,CAAA,CAAA,CAAA;;AAaN,MAAA,IAAMC;eACK;iBAAoB,IAAK/C,CAAAA,YAAAA;UAC/ByC;iBACW,IAAK1C,CAAAA,UAAAA;UAAa6C,aAHlC,CAAA,CAAA,CAAA,CAAA;;AAMA,MAAA,IAAMX,KAAQ,GAAA;AACZe,QAAAA,SAAS,SAAA,OAAA,GAAA;AAAA,UAAA,OAAMJ,YAAN,CAAA;AAAA,SAAA;OADX,CAAA;;AAGA,MAAA,IAAMK,SACJ,GAAAJ,WAAA,CAAA,KAAA,EAAA;AAAA,QAAA,uBAAA,EAAA,kBAAA,CAC6B,KAAK9C,UADlC,CAAA;AAAA,QAAA,SAAA,EAEW,KAAKV,YAFhB;AAAA,QAAA,WAAA,EAGaqD,SAHb;QAAA,mBAIqBC,EAAAA,iBAAAA;AAJrB,OAAA,EAAA,aAAA,CAAA;AAAA,QAAA,SAAA,EAAA,SAAA,QAAA,GAAA;AAAA,UAAA,OAAA,CAAAE,WAAA,CAAA,KAAA,EAAA;AAAA,YAAA,KAAA,EAOW,YAPX;AAAA,YAAA,OAAA,EAO+B,KAAA,CAAK7C,YAAAA;AAPpC,WAAA,EAAA,CAQKyC,cARL,CAAA,CAAA,CAAA,CAAA;AAAA,SAAA;AAAA,OAAA,EAKWR,KALX,CADF,CAAA,CAAA;;AAcO,MAAA,OAAA,IAAKvC,CAAAA,QAAL,GAAgBqD,WAAhB,GAA8BE,SAA9B,CAAA;KA3CF;AA6CPC,IAAAA,iBA7CO,EA6Ca,SAAA,iBAAA,GAAA;AACZ,MAAA,IAAAC,IAAA,GAAOC,cAAe,CAAA,IAAA,EAAM,MAAN,CAAtB,CAAA;AACN,MAAA,IAAMC,aAAgB,GAAA,CAAAR,WAAA,CAAA,KAAA,EAAA;AAAA,QAAA,KAAA,EACX,YADW;AAAA,QAAA,OAAA,EACS,KAAK7C,YADd;AAAA,QAAA,SAAA,EACqC,IAAKmB,CAAAA,sBAAAA;AAD1C,OAAA,EAAA,CAEjBgC,IAFiB,EAAAN,WAAA,CAAA,MAAA,EAAA;QAAA,OAGL,EAAA,CAAA,EAAA,CAAA,MAAA,CAAI,KAAKzE,WAAT,EAAA,gBAAA,CAAA,CAAA;AAHK,OAAA,EAAA,CAGmCgF,cAAe,CAAA,IAAA,EAAM,OAAN,EAAe;AAAEE,QAAAA,MAAA,EAAQ,IAAA;AAAV,OAAf,CAHlD,CAAA,CAAA,CAAA,CAAA,EAAAT,WAAA,CAAA,IAAA,EAAA;QAAA,OAKV,EAAA,mDAAA;OAAqDC,EAAAA,CAAAA,cAAc,MAAM,WAAW,UAL1E,CAAtB,CAAA,CAAA,CAAA;MAQA,IAAMS,UAAa,GAAA,IAAK5E,CAAAA,IAAL,KAAc,OAAd,IAAyB,KAAKe,QAAjD,CAAA;MAEA,IAAM+C,cAAiB,GAAA,CACrBU,IADqB,EAAAN,WAAA,CAAA,MAAA,EAAA;QAAA,OAER,EAAA,CAAA,EAAA,CAAA,MAAA,CAAI,KAAKzE,WAAT,EAAA,gBAAA,CAAA,CAAA;AAFQ,OAAA,EAAA,CAEgCgF,cAAe,CAAA,IAAA,EAAM,OAAN,EAAe;AAAEE,QAAAA,MAAA,EAAQ,IAAA;AAAV,OAAf,CAF/C,CAAA,CAAA,EAAAT,WAAA,CAAA,SAAA,EAAA;AAAA,QAAA,kBAAA,EAID,KAAK3C,UAJJ;QAAA,cAKL,EAAA;AAAEsD,UAAAA,SAAA,mBAAqBD,UAAA,GAAa,CAAM,EAAnB,GAAmB,CAAxC,EAAA,MAAA,CAAA;AAAF,SAAA;OALlB,EAAA,IAAA,CAAA,CAAA,CAAA;MASA,OAAO,IAAA,CAAK5E,IAAL,KAAc,QAAd,GAAyB0E,aAAzB,GAAyC,IAAKb,CAAAA,WAAL,CAAiBC,cAAjB,CAAhD,CAAA;KAlEK;AAoEPgB,IAAAA,aApEO,EAoES,SAAA,aAAA,GAAA;MACd,IAAMC,UAAa,GAAA,IAAKC,CAAAA,MAAL,CAAYX,OAAZ,IAAuB,IAAKW,CAAAA,MAAL,CAA1C,SAAA,CAAA,CAAA;AACM,MAAA,IAAAR,IAAA,GAAOC,cAAe,CAAA,IAAA,EAAM,MAAN,CAAtB,CAAA;MACN,IAAMQ,KAAQ,GAAAd,aAAA,CAAc,IAAd,EAAoB,SAApB,EAA+B,SAA/B,CAAd,CAAA;;AACI,MAAA,IAAA,mBAAA,GAAaX,kBAAmB,EAAhC;UAAEJ,MAAF,uBAAEA,MAAF,CAAA;;MACJ,IAAI8B,WAAc,GAAA,EAAlB,CAAA;;MAEA,OAAO9B,MAAU,IAAAA,MAAA,CAAOO,IAAP,CAAYtE,IAAZ,KAAqB,OAAtC,EAA+C;AACzC,QAAA,IAAA+D,MAAA,CAAOO,IAAP,CAAYtE,IAAZ,KAAqB,UAArB,EAAiC;AACpB6F,UAAAA,WAAA,IAAA,EAAA,CAAA;AACjB,SAAA;;QACA9B,MAAA,GAASA,MAAO,CAAAA,MAAhB,CAAA;AACF,OAAA;;MAEA,IAAMwB,UAAa,GAAA,IAAK5E,CAAAA,IAAL,KAAc,OAAd,IAAyB,KAAKe,QAAjD,CAAA;AAEA,MAAA,IAAM2D,aAAgB,GAAA,CAAAR,WAAA,CAAA,KAAA,EAAA;AAAA,QAAA,KAAA,EACX,YADW;AAAA,QAAA,OAAA,EACS,KAAK7C,YADd;AAAA,QAAA,SAAA,EACqC,IAAKmB,CAAAA,sBAAAA;AAD1C,OAAA,EAAA,CAEjBgC,IAFiB,EAAAN,WAAA,CAAA,MAAA,EAAA;QAAA,OAGL,EAAA,CAAA,EAAA,CAAA,MAAA,CAAI,KAAKzE,WAAT,EAAA,gBAAA,CAAA,CAAA;AAHK,OAAA,EAAA,CAGmCgF,cAAe,CAAA,IAAA,EAAM,OAAN,EAAe;AAAEE,QAAAA,MAAA,EAAQ,IAAA;OAAzB,CAHlD,IAIjBI,UACC,IAAAb,WAAA,CAAA,SAAA,EAAA;AAAA,QAAA,kBAAA,EACoB,KAAK3C,UADzB;QAAA,cAEgB,EAAA;AAAEsD,UAAAA,SAAW,mBAAUD,UAAa,GAAA,CAAA,EAAA,GAAM,CAA7B,EAAA,MAAA,CAAA;AAAb,SAAA;OAPA,EAAA,IAAA,CAAA,CAAA,CAAA,EAAAV,WAAA,CAAA,IAAA,EAAA;AAAA,QAAA,OAAA,EAWT,KAAK5C,QAXI;QAAA,OAWa,EAAA;AAAE,UAAA,gBAAA,EAAA,EAAA,CAAA,MAAA,CAAqB4D,WAArB,EAAA,IAAA,CAAA;AAAF,SAAA;AAXb,OAAA,EAAA,CAYjBD,KAZiB,CAAtB,CAAA,CAAA,CAAA;MAgBA,IAAMnB,cAAiB,GAAA,CACrBU,IADqB,EAAAN,WAAA,CAAA,MAAA,EAAA;QAAA,OAER,EAAA,CAAA,EAAA,CAAA,MAAA,CAAI,KAAKzE,WAAT,EAAA,gBAAA,CAAA,CAAA;AAFQ,OAAA,EAAA,CAEgCgF,cAAe,CAAA,IAAA,EAAM,OAAN,EAAe;AAAEE,QAAAA,MAAA,EAAQ,IAAA;AAAV,OAAf,CAF/C,CAAA,CAAA,EAAAT,WAAA,CAAA,SAAA,EAAA;AAAA,QAAA,kBAAA,EAID,KAAK3C,UAJJ;QAAA,cAKL,EAAA;AAAEsD,UAAAA,SAAW,mBAAUD,UAAa,GAAA,CAAA,EAAA,GAAM,CAA7B,EAAb,MAAA,CAAA;UAAmD,aAAe,EAAA,MAAA;AAAlE,SAAA;OALlB,EAAA,IAAA,CAAA,CAAA,CAAA;MASA,OAAO,IAAA,CAAK5E,IAAL,KAAc,QAAd,GAAyB0E,aAAzB,GAAyC,IAAKb,CAAAA,WAAL,CAAiBC,cAAjB,CAAhD,CAAA;AACF,KAAA;GA/Q2B;AAiR7BqB,EAAAA,MAjR6B,EAiRpB,SAAA,MAAA,GAAA;IACP,IAAIF,KAAQ,GAAA,IAAZ,CAAA;IACA,IAAIG,SAAS,EAAb,CAAA;;AAEI,IAAA,IAAA,IAAKpF,CAAAA,IAAL,KAAc,OAAd,EAAuB;AAChBoF,MAAAA,MAAA,GAAA;QACPC,cAAc,KAAK7D,gBADZ;AAEP8D,QAAAA,cAAc,IAAK5D,CAAAA,gBAAAA;OAFZ,CAAA;AAIX,KAAA;;IACA,IAAI6D,OAAOC,IAAP,CAAY,IAAA,CAAKR,MAAjB,CAAyBS,CAAAA,MAAzB,GAAkC,CAAtC,EAAyC;MACvCR,KAAA,GAAQ,IAAKhF,CAAAA,MAAL,GAAc,IAAA,CAAKsE,iBAAL,EAAd,GAAyC,IAAKO,CAAAA,aAAL,EAAjD,CAAA;AACF,KAAA;;AACA,IAAA,OAAAZ,WAAA,CAAA,IAAA,EAAAwB,UAAA,CAAA;AAAA,MAAA,OAAA,EACa,IAAKxE,CAAAA,OAAAA;KAAakE,EAAAA,MAD/B,IAEKH,KAFL,CAAA,CAAA,CAAA;AAKF,GAAA;AAnS6B,CAAA,CAA/B;;;;"}