{"version":3,"file":"v-menu.js","sources":["../../src/menu/v-menu.ts"],"sourcesContent":["import { ref, Slot } from 'vue';\n\ntype MenuValue = string | number;\ntype MenuNode = MenuValue | VMenuData;\n\ninterface VMenuData {\n  value: MenuValue;\n  parent?: MenuNode;\n  children: VMenuData[];\n  vnode?: Slot;\n}\n\ninterface VMenuItem {\n  value?: MenuValue;\n  parent: MenuValue;\n  vnode?: Slot;\n}\n\nconst getTreePaths = (node: VMenuData, val: MenuValue, ans: MenuValue[]): MenuValue[] => {\n  if (!node) return;\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return [...ans, node.value];\n    const target = getTreePaths(child, val, [...ans, node.value]);\n    if (target) return target;\n  }\n};\n\nconst getTreeSameParentNodes = (node: VMenuData, val: MenuValue): VMenuData[] => {\n  if (!node) return [];\n  for (let i = 0; i < node.children.length; ++i) {\n    const child = node.children[i];\n    if (child.value === val) return node.children;\n    const target = getTreeSameParentNodes(child, val);\n    if (target) return target;\n  }\n};\n\nconst DFS = (root: VMenuData, val: MenuValue): VMenuData => {\n  if (root.value === val) return root;\n  if (root.children.length > 0) {\n    for (let i = 0, len = root.children.length; i < len; i++) {\n      const res = DFS(root.children[i], val);\n      if (res) return res;\n    }\n  }\n};\n\nexport default class VMenu {\n  data: VMenuData = null;\n\n  cache: Set<VMenuData> = new Set();\n\n  isMutex = ref(false);\n\n  expandValues: Set<MenuValue> = null;\n\n  constructor(options: Record<string, any>) {\n    const root: VMenuData = {\n      value: null,\n      parent: null,\n      children: [],\n    };\n    this.data = root;\n    this.isMutex = options?.isMutex;\n    this.expandValues = new Set(options?.expandValues);\n  }\n\n  add(item: VMenuItem) {\n    const { value, parent, vnode } = item;\n    const node: VMenuData = {\n      value,\n      parent,\n      children: [],\n      vnode,\n    };\n\n    this.cache.forEach((data, v2, set) => {\n      if (item.value === data.parent) {\n        node.children.push(data);\n        set.delete(data);\n      }\n    });\n    if (item.parent == null) {\n      this.data.children.push(node);\n      node.parent = this.data;\n    } else if (this.data.children.length > 0) {\n      const pNode = DFS(this.data, parent);\n      if (pNode) {\n        pNode.children.push(node);\n      } else {\n        this.cache.add(node);\n      }\n    } else {\n      this.cache.add(node);\n    }\n  }\n\n  select(val: MenuValue) {\n    const activeValues = getTreePaths(this.data, val, []) || [];\n\n    activeValues.push(val);\n    return activeValues.filter((val) => val != null);\n  }\n\n  expand(val: MenuValue) {\n    if (this.expandValues.has(val)) {\n      this.expandValues.delete(val);\n      return [...this.expandValues];\n    }\n\n    this.expandValues.add(val);\n\n    if (!this.isMutex.value) {\n      return [...this.expandValues];\n    }\n\n    const sameParentNodes = getTreeSameParentNodes(this.data, val) || [];\n    const sameLevelSubmenuValues = new Set(\n      sameParentNodes.filter((node) => node.children?.length > 0 && node.value !== val).map((child) => child.value),\n    );\n\n    this.expandValues.forEach((val) => {\n      const isHit = sameLevelSubmenuValues.has(val);\n      if (isHit) {\n        this.expandValues.delete(val);\n      }\n    });\n    return [...this.expandValues];\n  }\n\n  getChild(value: MenuValue) {\n    const target = DFS(this.data, value);\n\n    return target ? target.children : [];\n  }\n}\n"],"names":["getTreePaths","node","val","ans","i","children","length","child","value","target","getTreeSameParentNodes","DFS","root","len","res","VMenu","options","Set","ref","parent","data","isMutex","expandValues","item","vnode","cache","forEach","v2","set","push","pNode","add","activeValues","filter","has","sameParentNodes","sameLevelSubmenuValues","map","isHit"],"mappings":"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"}