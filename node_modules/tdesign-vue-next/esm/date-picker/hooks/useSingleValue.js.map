{"version":3,"file":"useSingleValue.js","sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { toRefs, watchEffect, ref, computed } from 'vue';\nimport dayjs from 'dayjs';\nimport { formatDate, formatTime, isValidDate, getDefaultFormat } from '../../_common/js/date-picker/format';\nimport useVModel from '../../hooks/useVModel';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      valueType: props.valueType,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n    if (!extractTimeFormat(formatRef.value.valueType) && formatRef.value.valueType !== 'time-stamp')\n      console.error(`valueType: ${formatRef.value.valueType} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  const time = ref(formatTime(value.value, formatRef.value.timeFormat));\n  const month = ref<number>(dayjs(value.value).month() || new Date().getMonth());\n  const year = ref<number>(dayjs(value.value).year() || new Date().getFullYear());\n  const cacheValue = ref(\n    formatDate(value.value, { format: formatRef.value.format, targetFormat: formatRef.value.format }),\n  ); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = '';\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.valueType)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n      targetFormat: formatRef.value.format,\n    });\n    time.value = formatTime(value.value, formatRef.value.timeFormat);\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n  };\n}\n"],"names":["useSingleValue","props","toRefs","valueFromProps","value","modelValue","useVModel","defaultValue","onChange","formatRef","computed","getDefaultFormat","mode","format","valueType","enableTimePicker","extractTimeFormat","console","error","time","ref","formatTime","timeFormat","month","dayjs","Date","getMonth","year","getFullYear","cacheValue","formatDate","targetFormat","watchEffect","isValidDate"],"mappings":";;;;;;;;;;;;;;;;;;;;;AAOA,SAAwBA,cAAxB,CAAuCC,KAAvC,EAAiE;EAC/D,IAA8CC,OAAAA,GAAAA,OAAOD,MAArD;MAAeE,cAAf,WAAQC,KAAR;MAA+BC,UAA/B,WAA+BA,UAA/B,CAAA;;AACM,EAAA,IAAA,UAAA,GAAoBC,SAAA,CAAUH,cAAV,EAA0BE,UAA1B,EAAsCJ,KAAA,CAAMM,YAA5C,EAA0DN,KAAA,CAAMO,QAAhE,CAApB;AAAA,MAAA,WAAA,GAAA,cAAA,CAAA,UAAA,EAAA,CAAA,CAAA;AAAA,MAACJ,KAAD,GAAA,WAAA,CAAA,CAAA,CAAA;AAAA,MAAQI,QAAR,GAAA,WAAA,CAAA,CAAA,CAAA,CAAA;;EAEN,IAAMC,SAAY,GAAAC,QAAA,CAAS,YAAA;AAAA,IAAA,OACzBC,gBAAiB,CAAA;MACfC,MAAMX,KAAM,CAAAW,IADG;MAEfC,QAAQZ,KAAM,CAAAY,MAFC;MAGfC,WAAWb,KAAM,CAAAa,SAHF;MAIfC,kBAAkBd,KAAM,CAAAc,gBAAAA;AAJT,KAAA,CADQ,CAAA;AAAA,GAAT,CAAlB,CAAA;;EASA,IAAId,MAAMc,gBAAV,EAA4B;AAC1B,IAAA,IAAI,CAACC,iBAAA,CAAkBP,SAAU,CAAAL,KAAV,CAAgBS,MAAlC,CAAL,EACEI,OAAA,CAAQC,KAAR,CAAA,UAAA,CAAA,MAAA,CAAyBT,SAAU,CAAAL,KAAV,CAAgBS,MAAzC,EAAA,8HAAA,CAAA,CAAA,CAAA;IACE,IAAA,CAACG,kBAAkBP,SAAU,CAAAL,KAAV,CAAgBU,UAAnC,IAAiDL,SAAA,CAAUL,KAAV,CAAgBU,SAAhB,KAA8B,YAA/E,EACFG,OAAA,CAAQC,KAAR,CAAA,aAAA,CAAA,MAAA,CAA4BT,SAAU,CAAAL,KAAV,CAAgBU,SAA5C,EAAA,8HAAA,CAAA,CAAA,CAAA;AACJ,GAAA;;AAEM,EAAA,IAAAK,IAAA,GAAOC,IAAIC,UAAW,CAAAjB,KAAA,CAAMA,KAAN,EAAaK,SAAU,CAAAL,KAAV,CAAgBkB,UAA7B,EAAtB,CAAA;AACN,EAAA,IAAMC,KAAQ,GAAAH,GAAA,CAAYI,KAAM,CAAApB,KAAA,CAAMA,KAAN,CAAN,CAAmBmB,KAAnB,EAA8B,IAAA,IAAIE,IAAJ,EAAWC,CAAAA,QAAX,EAA1C,CAAd,CAAA;AACA,EAAA,IAAMC,IAAO,GAAAP,GAAA,CAAYI,KAAM,CAAApB,KAAA,CAAMA,KAAN,CAAN,CAAmBuB,IAAnB,EAA6B,IAAA,IAAIF,IAAJ,EAAWG,CAAAA,WAAX,EAAzC,CAAb,CAAA;EACA,IAAMC,UAAa,GAAAT,GAAA,CACjBU,UAAW,CAAA1B,KAAA,CAAMA,KAAN,EAAa;AAAES,IAAAA,MAAQ,EAAAJ,SAAA,CAAUL,KAAV,CAAgBS,MAA1B;AAAkCkB,IAAAA,YAAc,EAAAtB,SAAA,CAAUL,KAAV,CAAgBS,MAAAA;AAAhE,GAAb,CADM,CAAnB,CAAA;AAKAmB,EAAAA,WAAA,CAAY,YAAM;AACZ,IAAA,IAAA,CAAC5B,MAAMA,KAAP,EAAc;MAChByB,UAAA,CAAWzB,KAAX,GAAmB,EAAnB,CAAA;AACA,MAAA,OAAA;AACF,KAAA;;AACA,IAAA,IAAI,CAAC6B,WAAY,CAAA7B,KAAA,CAAMA,KAAN,EAAaK,SAAA,CAAUL,KAAV,CAAgBU,SAA7B,CAAjB,EAA0D,OAAA;IAE/Ce,UAAA,CAAAzB,KAAA,GAAQ0B,UAAW,CAAA1B,KAAA,CAAMA,KAAN,EAAa;AACzCS,MAAAA,MAAA,EAAQJ,UAAUL,KAAV,CAAgBS,MADiB;AAEzCkB,MAAAA,YAAA,EAActB,UAAUL,KAAV,CAAgBS,MAAAA;AAFW,KAAb,CAAnB,CAAA;AAIXM,IAAAA,IAAA,CAAKf,KAAL,GAAaiB,UAAW,CAAAjB,KAAA,CAAMA,KAAN,EAAaK,SAAA,CAAUL,KAAV,CAAgBkB,UAA7B,CAAxB,CAAA;AACD,GAZD,CAAA,CAAA;EAcO,OAAA;AACLK,IAAAA,IAAA,EAAAA,IADK;AAELJ,IAAAA,KAAA,EAAAA,KAFK;AAGLnB,IAAAA,KAAA,EAAAA,KAHK;AAILe,IAAAA,IAAA,EAAAA,IAJK;AAKLU,IAAAA,UAAA,EAAAA,UALK;AAMLrB,IAAAA,QAAA,EAAAA,QAAAA;GANK,CAAA;AAQT;;;;"}