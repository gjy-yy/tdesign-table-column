{"version":3,"file":"useDragSort.js","sources":["../../src/hooks/useDragSort.tsx"],"sourcesContent":["import { onUnmounted } from 'vue';\n\nconst traversalTabNavs = (tabNavs: HTMLCollection, fn: { (itemNode: any): void; (tabNav: HTMLDivElement): void }) => {\n  for (const itemNode of tabNavs) {\n    if (itemNode.getAttribute('draggable')) {\n      fn(itemNode);\n    }\n  }\n};\n\nconst handleTarget = (target: EventTarget, tabNavs: HTMLCollection): any => {\n  let resultTarget;\n  traversalTabNavs(tabNavs, (itemNode) => {\n    if (itemNode.contains(target)) {\n      resultTarget = itemNode;\n    }\n  });\n  return resultTarget;\n};\n\nexport default function useDragSort(props: any) {\n  let navsWrap: HTMLDivElement = null;\n\n  // 获取当前正在拖动的tabNav节点\n  let dragged: HTMLDivElement;\n  const enterTargets: HTMLDivElement[] = [];\n\n  const dragstart = (event: DragEvent) => {\n    const target = event.target as HTMLDivElement;\n    // const { target } = event;\n    // 保存拖动元素的引用(ref.)\n    dragged = target;\n    // 使其半透明\n    target.style.opacity = '0.5';\n  };\n  const dragend = (event: DragEvent) => {\n    // 重置透明度\n    (event.target as HTMLDivElement).style.opacity = '';\n  };\n  /* 放置目标元素时触发事件 */\n  const dragover = (event: DragEvent) => {\n    // 阻止默认动作以启用drop\n    event.preventDefault();\n  };\n  // 当可拖动的元素进入可放置的目标时\n  const dragenter = (event: DragEvent) => {\n    // 高亮目标节点\n    const target = handleTarget(event.target, navsWrap.children);\n    if (target && target !== dragged) {\n      target.firstChild.style.outline = '1px dashed #0052d9';\n      // 进入的节点全部记录下来\n      if (!enterTargets.includes(target)) {\n        enterTargets.push(target);\n      }\n    }\n  };\n  // 当拖动元素离开可放置目标节点\n  const dragleave = (event: DragEvent) => {\n    const target = event.target as HTMLDivElement;\n    // 重置其边框\n    // const { target } = event;\n    for (const enterTarget of enterTargets) {\n      // 目标不在需要放入的节点内，则重置边框\n      if (!enterTarget.contains(target)) {\n        // 记录过的节点全部重置边框\n        (enterTarget.firstChild as HTMLDivElement).style.outline = 'none';\n      }\n    }\n  };\n  const drop = (event: DragEvent) => {\n    // 阻止默认动作（如打开一些元素的链接）\n    event.preventDefault();\n\n    traversalTabNavs(navsWrap.children, (tabNav) => {\n      tabNav.firstChild.style.outline = 'none';\n    });\n    // 将拖动的元素到所选择的放置目标节点中\n    let target = handleTarget(event.target, navsWrap.children);\n    if (target && target.parentNode !== dragged) {\n      // 获取拖拽元素index\n      const dragIndex = [].indexOf.call(navsWrap.children, dragged);\n      // 获取放入元素index\n      const targetIndex = [].indexOf.call(navsWrap.children, target);\n      if (targetIndex > dragIndex) {\n        target = navsWrap.children[targetIndex + 1];\n      }\n      navsWrap.insertBefore(dragged, target);\n\n      // 当props.theme === \"normal\" 会多出一个指示条为第一个dom节点，所以需要减1\n      const currentIndex = props.theme === 'card' ? dragIndex : dragIndex - 1;\n      const endIndex = props.theme === 'card' ? targetIndex : targetIndex - 1;\n      props.onDragSort({\n        currentIndex,\n        current: props.panels[currentIndex].value,\n        targetIndex: endIndex,\n        target: props.panels[endIndex].value,\n      });\n    }\n  };\n  function setNavsWrap(val: HTMLDivElement) {\n    navsWrap = val;\n    navsWrap.addEventListener('dragstart', dragstart, false);\n    navsWrap.addEventListener('dragend', dragend, false);\n    navsWrap.addEventListener('dragover', dragover, false);\n    navsWrap.addEventListener('dragenter', dragenter, false);\n    document.addEventListener('dragleave', dragleave, false);\n    document.addEventListener('mousemove', dragleave, false);\n    navsWrap.addEventListener('drop', drop, false);\n  }\n\n  onUnmounted(() => {\n    navsWrap.removeEventListener('dragstart', dragstart);\n    navsWrap.removeEventListener('dragend', dragend);\n    navsWrap.removeEventListener('dragover', dragover);\n    navsWrap.removeEventListener('dragenter', dragenter);\n    document.removeEventListener('dragleave', dragleave);\n    document.removeEventListener('mousemove', dragleave);\n    navsWrap.removeEventListener('drop', drop);\n  });\n  return { setNavsWrap };\n}\n"],"names":["traversalTabNavs","tabNavs","fn","itemNode","getAttribute","handleTarget","target","resultTarget","contains","useDragSort","props","navsWrap","dragged","enterTargets","dragstart","event","style","opacity","dragend","dragover","preventDefault","dragenter","children","firstChild","outline","includes","push","dragleave","enterTarget","drop","tabNav","parentNode","dragIndex","indexOf","call","targetIndex","insertBefore","currentIndex","theme","endIndex","onDragSort","current","panels","value","setNavsWrap","val","addEventListener","document","onUnmounted","removeEventListener"],"mappings":"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"}