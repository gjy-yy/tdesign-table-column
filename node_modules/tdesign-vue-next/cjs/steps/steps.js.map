{"version":3,"file":"steps.js","sources":["../../src/steps/steps.tsx"],"sourcesContent":["import { computed, defineComponent, provide, reactive, ref, toRefs, VNode, watchEffect } from 'vue';\nimport isObject from 'lodash/isObject';\nimport props from './props';\nimport stepItemProps from './step-item-props';\nimport { TdStepItemProps } from './type';\n\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useVModel from '../hooks/useVModel';\nimport { useChildComponentSlots } from '../hooks';\n\nexport default defineComponent({\n  name: 'TSteps',\n  props: { ...props },\n\n  setup(props) {\n    const COMPONENT_NAME = usePrefixClass('steps');\n\n    const { current, modelValue } = toRefs(props);\n    const [innerCurrent, setInnerCurrent] = useVModel(\n      current,\n      modelValue,\n      props.defaultCurrent,\n      props.onChange,\n      'current',\n    );\n\n    provide(\n      'StepsState',\n      reactive({\n        current: innerCurrent,\n        setCurrent: setInnerCurrent,\n      }),\n    );\n\n    provide('StepsProps', props);\n\n    const indexMap = ref({});\n    watchEffect(() => {\n      if (!props.options) return;\n      props.options?.forEach((item, index) => {\n        if (item.value !== undefined) indexMap.value[item.value] = index;\n      });\n    });\n\n    const handleStatus = (itemProps: TdStepItemProps, index: number) => {\n      if (itemProps.status && itemProps.status !== 'default') return itemProps.status;\n      if (innerCurrent.value === 'FINISH') return 'finish';\n      // value 不存在时，使用 index 进行区分每一个步骤\n      if (itemProps.value === undefined) {\n        if (props.sequence === 'positive' && index < innerCurrent.value) return 'finish';\n        if (props.sequence === 'reverse' && index > innerCurrent.value) return 'finish';\n      }\n      // value 存在，找匹配位置\n      if (itemProps.value !== undefined) {\n        const matchIndex = indexMap.value[innerCurrent.value];\n        if (matchIndex === undefined) {\n          console.warn('TDesign Steps Warn: The current `value` is not exist.');\n          return 'default';\n        }\n        if (props.sequence === 'positive' && index < matchIndex) return 'finish';\n        if (props.sequence === 'reverse' && index > matchIndex) return 'finish';\n      }\n      const key = itemProps.value === undefined ? index : itemProps.value;\n      if (key === innerCurrent.value) return 'process';\n      return 'default';\n    };\n\n    const getChildComponentByName = useChildComponentSlots();\n\n    const getOptionListBySlots = (nodes: VNode[]) => {\n      const arr: Array<TdStepItemProps> = [];\n      nodes?.forEach((node) => {\n        const option = node?.props;\n        const children = node?.children;\n        if (!option && !children) return;\n        if (children && isObject(children)) {\n          for (const key in children) {\n            if (key in stepItemProps && !option[key]) {\n              option[key] = children[key];\n            }\n          }\n        }\n        props.sequence === 'reverse' ? arr.unshift(option as TdStepItemProps) : arr.push(option as TdStepItemProps);\n      });\n      return arr;\n    };\n    const getOptions = () => {\n      let options: Array<TdStepItemProps>;\n      if (props.options?.length) {\n        options = props.sequence === 'reverse' ? props.options.slice().reverse() : props.options;\n      } else {\n        const nodes: VNode[] = getChildComponentByName('StepItem') as VNode[];\n        options = getOptionListBySlots(nodes);\n      }\n      return options;\n    };\n\n    const renderContent = () => {\n      let content = null;\n      const options = getOptions();\n      const nodes: VNode[] = getChildComponentByName('StepItem') as VNode[];\n\n      content = options.map((item, index) => {\n        const stepIndex = props.sequence === 'reverse' ? options.length - index - 1 : index;\n\n        const stepItem = (\n          <t-step-item {...item} index={stepIndex} status={handleStatus(item, index)} key={item.value || index} />\n        );\n\n        if (nodes && nodes[index]) {\n          const vnode = nodes[index];\n          vnode.props = {\n            ...item,\n            index: stepIndex,\n            status: handleStatus(item, index),\n          };\n          return vnode;\n        }\n        return stepItem;\n      });\n\n      return content;\n    };\n\n    /** class calculate */\n    const handleTheme = () => {\n      let { theme } = props;\n      const options = getOptions();\n      options.forEach((item) => {\n        if (item?.icon !== undefined) {\n          // icon > theme\n          theme = 'default';\n        }\n      });\n      return theme;\n    };\n    const baseClass = computed(() => {\n      return [\n        COMPONENT_NAME.value,\n        `${COMPONENT_NAME.value}--${props.layout}`,\n        `${COMPONENT_NAME.value}--${handleTheme()}-anchor`,\n        `${COMPONENT_NAME.value}--${props.sequence}`,\n        `${COMPONENT_NAME.value}--${props.separator}-separator`,\n      ];\n    });\n    /** class calculate END */\n\n    return () => <div class={baseClass.value}>{renderContent()}</div>;\n  },\n});\n"],"names":["defineComponent","name","props","setup","COMPONENT_NAME","usePrefixClass","toRefs","current","modelValue","useVModel","defaultCurrent","onChange","_slicedToArray","innerCurrent","setInnerCurrent","provide","reactive","setCurrent","indexMap","ref","watchEffect","options","forEach","item","index","value","handleStatus","itemProps","status","sequence","matchIndex","console","warn","key","getChildComponentByName","useChildComponentSlots","getOptionListBySlots","nodes","arr","node","option","children","isObject","stepItemProps","unshift","push","getOptions","length","slice","reverse","renderContent","content","map","stepIndex","stepItem","vnode","handleTheme","theme","icon","baseClass","computed","layout","separator","_createVNode"],"mappings":"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"}