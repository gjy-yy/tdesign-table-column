{"version":3,"file":"head-menu.js","sources":["../../src/menu/head-menu.tsx"],"sourcesContent":["import { defineComponent, computed, provide, ref, reactive, watch, onMounted, watchEffect, toRefs } from 'vue';\nimport log from '../_common/js/log/log';\nimport props from './head-menu-props';\nimport { MenuValue } from './type';\nimport { TdMenuInterface, TdOpenType } from './const';\nimport { Tabs, TabPanel } from '../tabs';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport VMenu from './v-menu';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useVModel from '../hooks/useVModel';\nimport useDefaultValue from '../hooks/useDefaultValue';\n\nexport default defineComponent({\n  name: 'THeadMenu',\n  props: { ...props },\n  setup(props, ctx) {\n    const classPrefix = usePrefixClass();\n    watchEffect(() => {\n      if (ctx.slots.options) {\n        log.warnOnce('TMenu', '`options` slot is going to be deprecated, please use `operations` for slot instead.');\n      }\n    });\n    const { value, modelValue, expanded } = toRefs(props);\n    const [activeValue, setActiveValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n    const [expandValues, setExpanded] = useDefaultValue(expanded, props.defaultExpanded, props.onExpand, 'expanded');\n    const activeValues = ref([]);\n    const theme = computed(() => props.theme);\n    const menuClass = computed(() => [\n      `${classPrefix.value}-menu`,\n      `${classPrefix.value}-head-menu`,\n      `${classPrefix.value}-menu--${props.theme}`,\n    ]);\n    const mode = ref(props.expandType);\n    const submenu = reactive([]);\n    const vMenu = new VMenu({ isMutex: true, expandValues: expandValues.value });\n\n    provide<TdMenuInterface>('TdMenu', {\n      mode,\n      theme,\n      vMenu,\n      isHead: true,\n      expandValues,\n      activeValue,\n      activeValues,\n      select: (value: MenuValue) => {\n        setActiveValue(value);\n      },\n      open: (value: MenuValue, type: TdOpenType) => {\n        const expanded = [...expandValues.value];\n        const index = expanded.indexOf(value);\n\n        if (mode.value === 'popup') {\n          if (type === 'add') {\n            if (index === -1) {\n              // 可能初始expanded里包含了该value\n              expanded.push(value);\n            }\n          } else if (type === 'remove') {\n            expanded.splice(index, 1);\n          }\n        } else {\n          expanded.splice(0, 1);\n          if (index === -1) {\n            expanded.push(value);\n          }\n        }\n        setExpanded(expanded);\n      },\n    });\n\n    // methods\n    const handleTabChange = (value: MenuValue) => {\n      setActiveValue(value);\n    };\n\n    const handleSubmenuExpand = (value: MenuValue) => {\n      const ans = vMenu.getChild(value);\n      submenu.length = 0;\n      submenu.push(...ans);\n    };\n\n    // watch\n    watch(expandValues, (value) => {\n      if (mode.value === 'normal') {\n        handleSubmenuExpand(value[0]);\n      }\n    });\n    const updateActiveValues = (value: MenuValue) => {\n      activeValues.value = vMenu.select(value);\n    };\n    watch(activeValue, updateActiveValues);\n    watch(\n      () => props.expandType,\n      (value) => {\n        mode.value = value;\n      },\n    );\n\n    onMounted(() => {\n      activeValues.value = vMenu.select(activeValue.value);\n      if (expandValues.value?.length > 0) {\n        handleSubmenuExpand(expandValues.value[0]); // 顶部导航只能同时展开一个子菜单\n      }\n    });\n\n    return {\n      classPrefix,\n      mode,\n      menuClass,\n      expandValues,\n      activeValue,\n      activeValues,\n      submenu,\n      handleTabChange,\n    };\n  },\n  methods: {\n    renderNormalSubmenu() {\n      if (this.submenu.length === 0) return null;\n      return (\n        <ul class={[`${this.classPrefix}-head-menu__submenu`, `${this.classPrefix}-submenu`]}>\n          {\n            <Tabs value={this.activeValue} onChange={this.handleTabChange}>\n              {this.submenu.map((item) => (\n                <TabPanel value={item.value} label={item.vnode()[0]?.children} />\n              ))}\n            </Tabs>\n          }\n        </ul>\n      );\n    },\n  },\n  render() {\n    const { classPrefix } = this;\n    const operations = renderContent(this, 'operations', 'options');\n    const logo = renderTNodeJSX(this, 'logo');\n    return (\n      <div class={this.menuClass}>\n        <div class={`${classPrefix}-head-menu__inner`}>\n          {logo && <div class={`${classPrefix}-menu__logo`}>{logo}</div>}\n          <ul class={`${classPrefix}-menu`}>{renderContent(this, 'default', 'content')}</ul>\n          {operations && <div class={`${classPrefix}-menu__operations`}>{operations}</div>}\n        </div>\n        {this.mode === 'normal' && this.renderNormalSubmenu()}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","ctx","classPrefix","usePrefixClass","watchEffect","slots","options","log","warnOnce","toRefs","value","modelValue","expanded","useVModel","defaultValue","onChange","_slicedToArray","activeValue","setActiveValue","useDefaultValue","defaultExpanded","onExpand","expandValues","setExpanded","activeValues","ref","theme","computed","menuClass","mode","expandType","submenu","reactive","vMenu","VMenu","isMutex","provide","isHead","select","open","type","_toConsumableArray","index","indexOf","push","splice","handleTabChange","handleSubmenuExpand","ans","getChild","length","watch","updateActiveValues","onMounted","methods","renderNormalSubmenu","_createVNode","Tabs","map","item","TabPanel","vnode","children","render","operations","renderContent","logo","renderTNodeJSX"],"mappings":"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"}