{"version":3,"file":"menu.js","sources":["../../src/menu/menu.tsx"],"sourcesContent":["import { defineComponent, ref, computed, provide, watchEffect, watch, onMounted, toRefs } from 'vue';\nimport props from './props';\nimport { MenuValue } from './type';\nimport { TdMenuInterface, TdOpenType } from './const';\nimport { renderContent, renderTNodeJSX } from '../utils/render-tnode';\nimport VMenu from './v-menu';\nimport log from '../_common/js/log/log';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useVModel from '../hooks/useVModel';\nimport useDefaultValue from '../hooks/useDefaultValue';\n\nexport default defineComponent({\n  name: 'TMenu',\n  props: { ...props, onCollapsed: Function },\n  setup(props, ctx) {\n    const classPrefix = usePrefixClass();\n    watchEffect(() => {\n      if (ctx.slots.options) {\n        log.warnOnce('TMenu', '`options` slot is going to be deprecated, please use `operations` for slot instead.');\n      }\n    });\n    const mode = ref(props.expandType);\n    const theme = computed(() => props.theme);\n    const isMutex = computed(() => props.expandMutex);\n    const menuClass = computed(() => [\n      `${classPrefix.value}-default-menu`,\n      `${classPrefix.value}-menu--${props.theme}`,\n      {\n        [`${classPrefix.value}-is-collapsed`]: props.collapsed,\n      },\n    ]);\n    const innerClasses = computed(() => [\n      `${classPrefix.value}-menu`,\n      { [`${classPrefix.value}-menu--scroll`]: mode.value !== 'popup' },\n      'narrow-scrollbar',\n    ]);\n    const expandWidth = computed(() => {\n      const { width } = props;\n      const format = (val: string | number) => (typeof val === 'number' ? `${val}px` : val);\n      if (Array.isArray(width)) return width.map((item) => format(item));\n\n      return [format(width), '64px'];\n    });\n\n    const styles = computed(() => ({\n      height: '100%',\n      width: props.collapsed ? expandWidth.value[1] : expandWidth.value[0],\n    }));\n\n    const { value, modelValue, expanded } = toRefs(props);\n    const [activeValue, setActiveValue] = useVModel(value, modelValue, props.defaultValue, props.onChange);\n    const [expandValues, setExpand] = useDefaultValue(expanded, props.defaultExpanded, props.onExpand, 'expanded');\n    const activeValues = ref([]);\n\n    watchEffect(() => {\n      mode.value = props.collapsed ? 'popup' : props.expandType;\n      props.onCollapsed?.({ collapsed: props.collapsed });\n    });\n\n    const vMenu = new VMenu({ isMutex, expandValues: expandValues.value ? [...expandValues.value] : [] });\n    provide<TdMenuInterface>('TdMenu', {\n      activeValue,\n      activeValues,\n      expandValues,\n      mode,\n      theme,\n      isHead: false,\n      vMenu,\n      select: (value: MenuValue) => {\n        setActiveValue(value);\n      },\n      open: (value: MenuValue, type: TdOpenType) => {\n        if (mode.value === 'normal') {\n          setExpand(vMenu.expand(value));\n        } else if (type === 'add') {\n          if (expandValues.value.indexOf(value) === -1) {\n            // 可能初始expanded里包含了该value\n            setExpand([...expandValues.value, value]);\n          }\n        } else if (type === 'remove') {\n          const index = expandValues.value.indexOf(value);\n          const tmp = [...expandValues.value];\n          tmp.splice(index, 1);\n          setExpand(tmp);\n        }\n      },\n    });\n\n    // watch\n    watch(\n      () => props.expanded,\n      (value) => {\n        vMenu.expandValues = new Set(value);\n      },\n    );\n    const updateActiveValues = (value: MenuValue) => {\n      activeValues.value = vMenu.select(value);\n    };\n    watch(activeValue, updateActiveValues);\n\n    // timelifes\n    onMounted(() => {\n      activeValues.value = vMenu.select(activeValue.value);\n    });\n\n    return {\n      styles,\n      classPrefix,\n      menuClass,\n      innerClasses,\n      activeValue,\n      activeValues,\n      expandValues,\n    };\n  },\n  render() {\n    const operations = renderContent(this, 'operations', 'options');\n    const logo = renderTNodeJSX(this, 'logo');\n    return (\n      <div class={this.menuClass} style={this.styles}>\n        <div class={`${this.classPrefix}-default-menu__inner`}>\n          {logo && <div class={`${this.classPrefix}-menu__logo`}>{logo}</div>}\n          <ul class={this.innerClasses}>{renderContent(this, 'default', 'content')}</ul>\n          {operations && <div class={`${this.classPrefix}-menu__operations`}>{operations}</div>}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","onCollapsed","Function","setup","ctx","classPrefix","usePrefixClass","watchEffect","slots","options","log","warnOnce","mode","ref","expandType","theme","computed","isMutex","expandMutex","menuClass","value","_defineProperty","collapsed","innerClasses","expandWidth","width","format","val","Array","isArray","map","item","styles","height","toRefs","modelValue","expanded","useVModel","defaultValue","onChange","_slicedToArray","activeValue","setActiveValue","useDefaultValue","defaultExpanded","onExpand","expandValues","setExpand","activeValues","vMenu","VMenu","provide","isHead","select","open","type","expand","indexOf","index","tmp","_toConsumableArray","splice","watch","Set","updateActiveValues","onMounted","render","operations","renderContent","logo","renderTNodeJSX","_createVNode"],"mappings":"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"}