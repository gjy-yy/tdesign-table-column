{"version":3,"file":"tooltip.js","sources":["../../src/tooltip/tooltip.tsx"],"sourcesContent":["import { computed, defineComponent, onMounted, ref, toRefs, watch, getCurrentInstance } from 'vue';\nimport isFunction from 'lodash/isFunction';\nimport props from './props';\nimport popupProps from '../popup/props';\nimport Popup, { PopupVisibleChangeContext } from '../popup';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX, useContent } from '../hooks/tnode';\nimport { useMouse } from './util';\nimport useVModel from '../hooks/useVModel';\n\nexport default defineComponent({\n  name: 'TTooltip',\n  props: {\n    ...popupProps,\n    ...props,\n  },\n  setup(props, ctx) {\n    const timer = ref(null);\n    const popupRef = ref(null);\n\n    const { visible, modelValue } = toRefs(props);\n    const [innerVisible, setInnerVisible] = useVModel(\n      visible,\n      modelValue,\n      props.defaultVisible,\n      props.onVisibleChange,\n      'visible',\n    );\n    const vm = getCurrentInstance();\n    const innerTooltipVisible = ref(props.visible || props.defaultVisible);\n    const classPrefix = usePrefixClass();\n    const renderTNodeJSX = useTNodeJSX();\n    const renderContent = useContent();\n    const { x } = useMouse();\n    const offsetX = ref(x.value);\n\n    onMounted(() => {\n      if (props.duration && innerTooltipVisible.value) {\n        timer.value = setTimeout(() => {\n          innerTooltipVisible.value = false;\n          clearTimeout(timer.value);\n          timer.value = null;\n        }, props.duration);\n      }\n    });\n\n    const onTipVisibleChange = (val: boolean, ctx?: PopupVisibleChangeContext) => {\n      // 因 props={this.getPopupProps()} 已经透传 onVisibleChange props，此处不再需要使用 emitEvent\n      if (timer.value && ctx?.trigger !== 'document') return;\n      if (val) {\n        offsetX.value = x.value;\n      }\n      setInnerVisible(val, ctx);\n    };\n\n    const tooltipOverlayClassName = computed(() => {\n      return [\n        `${classPrefix.value}-tooltip`,\n        { [`${classPrefix.value}-tooltip--${props.theme}`]: props.theme },\n        props.overlayClassName,\n      ];\n    });\n\n    const popupProps = computed(() => ({\n      ...(vm?.vnode.props || {}),\n      placement: props.placement === 'mouse' ? 'bottom-left' : props.placement,\n      showArrow: props.placement === 'mouse' ? false : props.showArrow,\n      content: () => renderTNodeJSX('content'),\n      default: () => renderContent('default', 'triggerElement'),\n      overlayClassName: tooltipOverlayClassName.value,\n      onVisibleChange: onTipVisibleChange,\n    }));\n\n    const overlayInnerStyle = computed(() => {\n      if (props.placement !== 'mouse' || offsetX.value === 0) {\n        return props.overlayInnerStyle;\n      }\n      const offsetStyle = (triggerEl: HTMLElement) => ({\n        transform: `translateX(${offsetX.value - triggerEl.getBoundingClientRect().left}px)`,\n      });\n      if (props.overlayInnerStyle) {\n        return (triggerEl: HTMLElement, popupEl: HTMLElement) => ({\n          ...offsetStyle(triggerEl),\n          ...(isFunction(props.overlayInnerStyle)\n            ? props.overlayInnerStyle(triggerEl, popupEl)\n            : props.overlayInnerStyle),\n        });\n      }\n      return offsetStyle;\n    });\n\n    watch(\n      () => innerTooltipVisible.value,\n      () => {\n        if (timer.value && !innerTooltipVisible.value) {\n          clearTimeout(timer.value);\n          timer.value = null;\n        }\n      },\n    );\n\n    const onPopupUpdate = () => {\n      popupRef.value?.updatePopper?.();\n    };\n\n    /**\n     * 透传更新popup实例方法，供外部调用\n     */\n    ctx.expose({\n      updatePopper: onPopupUpdate,\n    });\n\n    return () => (\n      <Popup\n        ref={popupRef}\n        visible={innerVisible.value}\n        {...popupProps.value}\n        overlayInnerStyle={overlayInnerStyle.value}\n      />\n    );\n  },\n});\n"],"names":["defineComponent","name","props","popupProps","setup","ctx","timer","ref","popupRef","toRefs","visible","modelValue","useVModel","defaultVisible","onVisibleChange","_slicedToArray","innerVisible","setInnerVisible","vm","getCurrentInstance","innerTooltipVisible","classPrefix","usePrefixClass","renderTNodeJSX","useTNodeJSX","renderContent","useContent","useMouse","x","offsetX","value","onMounted","duration","setTimeout","clearTimeout","onTipVisibleChange","val","trigger","tooltipOverlayClassName","computed","theme","overlayClassName","vnode","placement","showArrow","content","overlayInnerStyle","offsetStyle","triggerEl","transform","getBoundingClientRect","left","popupEl","isFunction","watch","onPopupUpdate","updatePopper","expose","_createVNode","Popup","_mergeProps"],"mappings":"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"}