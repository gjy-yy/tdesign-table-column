{"version":3,"file":"useOverlayInnerStyle.js","sources":["../../src/select-input/useOverlayInnerStyle.ts"],"sourcesContent":["import { ref, toRefs, computed, CSSProperties } from 'vue';\nimport isObject from 'lodash/isObject';\nimport isFunction from 'lodash/isFunction';\nimport { TdSelectInputProps } from './type';\nimport { TdPopupProps, PopupVisibleChangeContext } from '../popup';\nimport { useFormDisabled } from '../form/hooks';\n\nexport type overlayInnerStyleProps = Pick<\n  TdSelectInputProps,\n  'popupProps' | 'autoWidth' | 'readonly' | 'onPopupVisibleChange' | 'disabled'\n>;\n\n// 单位：px\nconst MAX_POPUP_WIDTH = 1000;\n\nexport default function useOverlayInnerStyle(props: overlayInnerStyleProps) {\n  const { popupProps, autoWidth } = toRefs(props);\n  const innerPopupVisible = ref(false);\n  const disable = useFormDisabled();\n\n  const matchWidthFunc = (triggerElement: HTMLElement, popupElement: HTMLElement) => {\n    // 避免因滚动条出现文本省略，预留宽度 8\n    const SCROLLBAR_WIDTH = popupElement.scrollHeight > popupElement.offsetHeight ? 8 : 0;\n    const width =\n      popupElement.offsetWidth + SCROLLBAR_WIDTH >= triggerElement.offsetWidth\n        ? popupElement.offsetWidth\n        : triggerElement.offsetWidth;\n    let otherOverlayInnerStyle: CSSProperties = {};\n    if (\n      popupProps.value &&\n      typeof popupProps.value.overlayInnerStyle === 'object' &&\n      !popupProps.value.overlayInnerStyle.width\n    ) {\n      otherOverlayInnerStyle = popupProps.value.overlayInnerStyle;\n    }\n    return {\n      width: `${Math.min(width, MAX_POPUP_WIDTH)}px`,\n      ...otherOverlayInnerStyle,\n    };\n  };\n\n  const onInnerPopupVisibleChange = (visible: boolean, context: PopupVisibleChangeContext) => {\n    if (disable.value || props.readonly) return;\n    innerPopupVisible.value = visible;\n    props.onPopupVisibleChange?.(visible, context);\n  };\n\n  const tOverlayInnerStyle = computed(() => {\n    let result: TdPopupProps['overlayInnerStyle'] = {};\n    const overlayInnerStyle = popupProps.value?.overlayInnerStyle || {};\n    if (isFunction(overlayInnerStyle) || (isObject(overlayInnerStyle) && overlayInnerStyle.width)) {\n      result = overlayInnerStyle;\n    } else if (!autoWidth.value) {\n      result = matchWidthFunc;\n    }\n    return result;\n  });\n\n  return {\n    tOverlayInnerStyle,\n    innerPopupVisible,\n    onInnerPopupVisibleChange,\n  };\n}\n"],"names":["MAX_POPUP_WIDTH","useOverlayInnerStyle","props","toRefs","popupProps","autoWidth","innerPopupVisible","ref","disable","useFormDisabled","matchWidthFunc","triggerElement","popupElement","SCROLLBAR_WIDTH","scrollHeight","offsetHeight","width","offsetWidth","otherOverlayInnerStyle","value","_typeof","overlayInnerStyle","Math","min","onInnerPopupVisibleChange","visible","context","readonly","onPopupVisibleChange","tOverlayInnerStyle","computed","result","isFunction","isObject"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,IAAMA,eAAkB,GAAA,GAAxB,CAAA;AAEA,SAAwBC,oBAAxB,CAA6CC,KAA7C,EAA4E;EAC1E,IAAkCC,OAAAA,GAAAA,WAAOD,MAAzC;MAAQE,UAAR,WAAQA,UAAR;MAAoBC,SAApB,WAAoBA,SAApB,CAAA;;AACM,EAAA,IAAAC,iBAAA,GAAoBC,QAAI,MAAxB,CAAA;EACN,IAAMC,UAAUC,0BAAgB,EAAhC,CAAA;;EAEM,IAAAC,cAAA,GAAiB,SAAjBA,cAAiB,CAACC,cAAD,EAA8BC,YAA9B,EAA4D;AAEjF,IAAA,IAAMC,eAAkB,GAAAD,YAAA,CAAaE,YAAb,GAA4BF,YAAA,CAAaG,YAAzC,GAAwD,CAAxD,GAA4D,CAApF,CAAA;AACM,IAAA,IAAAC,KAAA,GACJJ,aAAaK,WAAb,GAA2BJ,eAA3B,IAA8CF,eAAeM,WAA7D,GACIL,YAAA,CAAaK,WADjB,GAEIN,cAAe,CAAAM,WAHf,CAAA;IAIN,IAAIC,yBAAwC,EAA5C,CAAA;;IAEE,IAAAd,UAAA,CAAWe,KAAX,IACAC,4BAAOhB,UAAW,CAAAe,KAAX,CAAiBE,iBAAxB,MAA8C,QAD9C,IAEA,CAACjB,UAAA,CAAWe,KAAX,CAAiBE,iBAAjB,CAAmCL,KAFpC,EAGA;AACAE,MAAAA,sBAAA,GAAyBd,WAAWe,KAAX,CAAiBE,iBAA1C,CAAA;AACF,KAAA;;AACO,IAAA,OAAA,aAAA,CAAA;MACLL,KAAO,EAAA,EAAA,CAAA,MAAA,CAAGM,IAAK,CAAAC,GAAL,CAASP,KAAT,EAAgBhB,eAAhB,CAAH,EAAA,IAAA,CAAA;AADF,KAAA,EAEFkB,sBAFE,CAAA,CAAA;GAfH,CAAA;;EAqBA,IAAAM,yBAAA,GAA4B,SAA5BA,yBAA4B,CAACC,OAAD,EAAmBC,OAAnB,EAA0D;AAAA,IAAA,IAAA,qBAAA,CAAA;;AACtF,IAAA,IAAAlB,OAAA,CAAQW,KAAR,IAAiBjB,KAAM,CAAAyB,QAAvB,EAAiC,OAAA;IACrCrB,iBAAA,CAAkBa,KAAlB,GAA0BM,OAA1B,CAAA;IACM,CAAAvB,qBAAAA,GAAAA,KAAA,CAAA0B,oBAAA,MAAA,IAAA,IAAA,qBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,qBAAA,CAAA,IAAA,CAAA1B,KAAA,EAAuBuB,OAAvB,EAAgCC,OAAhC,CAAA,CAAA;GAHF,CAAA;;AAMA,EAAA,IAAAG,kBAAA,GAAqBC,aAAS,YAAM;AAAA,IAAA,IAAA,iBAAA,CAAA;;IACxC,IAAIC,SAA4C,EAAhD,CAAA;IACA,IAAMV,iBAAoB,GAAA,CAAAjB,CAAAA,iBAAAA,GAAAA,UAAA,CAAWe,KAAX,MAAA,IAAA,IAAA,iBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,iBAAA,CAAkBE,iBAAlB,KAAuC,EAAjE,CAAA;;AACA,IAAA,IAAIW,+BAAWX,kBAAX,IAAkCY,6BAASZ,kBAAT,IAA+BA,kBAAkBL,KAAvF,EAA+F;AACpFe,MAAAA,MAAA,GAAAV,iBAAA,CAAA;AACX,KAFA,MAEA,IAAW,CAAChB,SAAA,CAAUc,KAAtB,EAA6B;AAClBY,MAAAA,MAAA,GAAArB,cAAA,CAAA;AACX,KAAA;;AACO,IAAA,OAAAqB,MAAA,CAAA;AACR,IATK,CAAA;EAWC,OAAA;AACLF,IAAAA,kBAAA,EAAAA,kBADK;AAELvB,IAAAA,iBAAA,EAAAA,iBAFK;AAGLkB,IAAAA,yBAAA,EAAAA,yBAAAA;GAHK,CAAA;AAKT;;;;"}