{"version":3,"file":"useMultiple.js","sources":["../../src/select-input/useMultiple.tsx"],"sourcesContent":["import { SetupContext, computed, ref, toRefs } from 'vue';\nimport isObject from 'lodash/isObject';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys } from './type';\nimport { SelectInputCommonProperties } from './interface';\nimport { InputValue } from '../input';\nimport TagInput, { TagInputValue, InputValueChangeContext } from '../tag-input';\nimport Loading from '../loading';\nimport useDefault from '../hooks/useDefaultValue';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useFormDisabled } from '../form/hooks';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent }) => void;\n  popupVisible: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport default function useMultiple(props: TdSelectInputProps, context: SetupContext) {\n  const { inputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n  const tagInputRef = ref();\n  const [tInputValue, setTInputValue] = useDefault(\n    inputValue,\n    props.defaultInputValue,\n    props.onInputChange,\n    'inputValue',\n  );\n  const disable = useFormDisabled();\n\n  const iKeys = computed<SelectInputKeys>(() => ({ ...DEFAULT_KEYS, ...props.keys }));\n  const tags = computed<TagInputValue>(() => {\n    if (!(props.value instanceof Array)) {\n      return isObject(props.value) ? [props.value[iKeys.value.label]] : [props.value];\n    }\n    return props.value.map((item) => (isObject(item) ? item[iKeys.value.label] : item));\n  });\n\n  const tPlaceholder = computed<string>(() => (!tags.value || !tags.value.length ? props.placeholder : ''));\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n  };\n\n  const renderSelectMultiple = (p: RenderSelectMultipleParams) => {\n    const tagInputProps = {\n      ...p.commonInputProps,\n      tagProps: props.tagProps,\n      label: props.label,\n      autoWidth: props.autoWidth,\n      readonly: props.readonly,\n      placeholder: tPlaceholder.value,\n      minCollapsedNum: props.minCollapsedNum,\n      collapsedItems: props.collapsedItems,\n      tag: props.tag,\n      value: tags.value,\n      valueDisplay: props.valueDisplay,\n      inputValue: tInputValue.value || '',\n      inputProps: {\n        readonly: !props.allowInput || props.readonly,\n        inputClass: {\n          [`${classPrefix.value}-input--focused`]: p.popupVisible,\n        },\n        ...props.inputProps,\n      },\n      suffixIcon: !disable.value && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n      ...props.tagInputProps,\n    };\n\n    return (\n      <TagInput\n        ref=\"tagInputRef\"\n        {...tagInputProps}\n        v-slots={context.slots}\n        onInputChange={(val: InputValue, context: InputValueChangeContext) => {\n          // 筛选器统一特性：筛选器按下回车时不清空输入框\n          if (context?.trigger === 'enter') return;\n          setTInputValue(val, { trigger: context.trigger, e: context.e });\n        }}\n        onChange={onTagInputChange}\n        onClear={p.onInnerClear}\n        onBlur={(val, context) => {\n          props.onBlur?.(props.value, { ...context, tagInputValue: val });\n        }}\n        onEnter={(val, context) => {\n          props.onEnter?.(props.value, { ...context, inputValue: tInputValue.value });\n        }}\n        onFocus={(val, context) => {\n          props.onFocus?.(props.value, { ...context, tagInputValue: val });\n        }}\n      />\n    );\n  };\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","context","toRefs","inputValue","classPrefix","usePrefixClass","tagInputRef","ref","useDefault","defaultInputValue","onInputChange","_slicedToArray","tInputValue","setTInputValue","disable","useFormDisabled","iKeys","computed","keys","tags","value","Array","isObject","map","item","tPlaceholder","length","placeholder","onTagInputChange","val","trigger","e","stopPropagation","onTagChange","renderSelectMultiple","p","tagInputProps","commonInputProps","tagProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","inputProps","allowInput","inputClass","popupVisible","suffixIcon","loading","_createVNode","Loading","TagInput","_mergeProps","onInnerClear","onBlur","tagInputValue","onEnter","onFocus","slots"],"mappings":"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"}