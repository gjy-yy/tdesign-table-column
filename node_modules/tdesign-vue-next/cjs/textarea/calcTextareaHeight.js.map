{"version":3,"file":"calcTextareaHeight.js","sources":["../../src/textarea/calcTextareaHeight.ts"],"sourcesContent":["/**\n * Thanks to https://github.com/ElemeFE/element/blob/dev/packages/input/src/calcTextareaHeight.js\n */\ntype RowsType = number | null;\n\ntype ResultType = {\n  height?: string;\n  minHeight?: string;\n};\n\nlet hiddenTextarea: HTMLTextAreaElement;\n\nconst HIDDEN_TEXTAREA_STYLE = `\n  min-height:0 !important;\n  max-height:none !important;\n  height:0 !important;\n  visibility:hidden !important;\n  overflow:hidden !important;\n  position:absolute !important;\n  z-index:-1000 !important;\n  top:0 !important;\n  right:0 !important\n`;\n\nconst SIZING_PROPS = [\n  'letter-spacing',\n  'line-height',\n  'padding-top',\n  'padding-bottom',\n  'font-family',\n  'font-weight',\n  'font-size',\n  'font-variant',\n  'text-rendering',\n  'text-transform',\n  'width',\n  'text-indent',\n  'padding-left',\n  'padding-right',\n  'border-width',\n  'box-sizing',\n];\n\nfunction calculateNodeStyling(targetElement: HTMLTextAreaElement) {\n  const style = window.getComputedStyle(targetElement);\n\n  const boxSizing =\n    style.getPropertyValue('box-sizing') ||\n    style.getPropertyValue('-moz-box-sizing') ||\n    style.getPropertyValue('-webkit-box-sizing');\n\n  const paddingSize =\n    parseFloat(style.getPropertyValue('padding-bottom')) + parseFloat(style.getPropertyValue('padding-top'));\n\n  const borderSize =\n    parseFloat(style.getPropertyValue('border-bottom-width')) + parseFloat(style.getPropertyValue('border-top-width'));\n\n  const sizingStyle = SIZING_PROPS.map((name) => `${name}:${style.getPropertyValue(name)}`).join(';');\n\n  return {\n    sizingStyle,\n    paddingSize,\n    borderSize,\n    boxSizing,\n  };\n}\n\nexport default function calcTextareaHeight(\n  targetElement: HTMLTextAreaElement,\n  minRows: RowsType = 1,\n  maxRows: RowsType = null,\n) {\n  if (!hiddenTextarea) {\n    hiddenTextarea = document.createElement('textarea');\n    document.body.appendChild(hiddenTextarea);\n  }\n\n  const { paddingSize, borderSize, boxSizing, sizingStyle } = calculateNodeStyling(targetElement);\n\n  hiddenTextarea.setAttribute('style', `${sizingStyle};${HIDDEN_TEXTAREA_STYLE}`);\n  hiddenTextarea.value = targetElement.value || targetElement.placeholder || '';\n\n  let height = hiddenTextarea.scrollHeight;\n  const result: ResultType = {};\n\n  if (boxSizing === 'border-box') {\n    height += borderSize;\n  } else if (boxSizing === 'content-box') {\n    height -= paddingSize;\n  }\n\n  hiddenTextarea.value = '';\n  const singleRowHeight = hiddenTextarea.scrollHeight - paddingSize;\n\n  if (minRows !== null) {\n    let minHeight = singleRowHeight * minRows;\n    if (boxSizing === 'border-box') {\n      minHeight = minHeight + paddingSize + borderSize;\n    }\n    height = Math.max(minHeight, height);\n    result.minHeight = `${minHeight}px`;\n  }\n  if (maxRows !== null) {\n    let maxHeight = singleRowHeight * maxRows;\n    if (boxSizing === 'border-box') {\n      maxHeight = maxHeight + paddingSize + borderSize;\n    }\n    height = Math.min(maxHeight, height);\n  }\n  result.height = `${height}px`;\n  hiddenTextarea.parentNode && hiddenTextarea.parentNode.removeChild(hiddenTextarea);\n  hiddenTextarea = null;\n  return result;\n}\n"],"names":["hiddenTextarea","HIDDEN_TEXTAREA_STYLE","SIZING_PROPS","calculateNodeStyling","targetElement","style","window","getComputedStyle","boxSizing","getPropertyValue","paddingSize","parseFloat","borderSize","sizingStyle","map","name","join","calcTextareaHeight","minRows","maxRows","document","createElement","body","appendChild","setAttribute","value","placeholder","height","scrollHeight","result","singleRowHeight","minHeight","Math","max","maxHeight","min","parentNode","removeChild"],"mappings":"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"}