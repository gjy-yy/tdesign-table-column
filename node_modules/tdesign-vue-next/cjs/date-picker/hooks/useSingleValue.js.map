{"version":3,"file":"useSingleValue.js","sources":["../../../src/date-picker/hooks/useSingleValue.tsx"],"sourcesContent":["import { toRefs, watchEffect, ref, computed } from 'vue';\nimport dayjs from 'dayjs';\nimport { formatDate, formatTime, isValidDate, getDefaultFormat } from '../../_common/js/date-picker/format';\nimport useVModel from '../../hooks/useVModel';\nimport { TdDatePickerProps } from '../type';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport default function useSingleValue(props: TdDatePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      valueType: props.valueType,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n    if (!extractTimeFormat(formatRef.value.valueType) && formatRef.value.valueType !== 'time-stamp')\n      console.error(`valueType: ${formatRef.value.valueType} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  const time = ref(formatTime(value.value, formatRef.value.timeFormat));\n  const month = ref<number>(dayjs(value.value).month() || new Date().getMonth());\n  const year = ref<number>(dayjs(value.value).year() || new Date().getFullYear());\n  const cacheValue = ref(\n    formatDate(value.value, { format: formatRef.value.format, targetFormat: formatRef.value.format }),\n  ); // 缓存选中值，panel 点击时更改\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = '';\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.valueType)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n      targetFormat: formatRef.value.format,\n    });\n    time.value = formatTime(value.value, formatRef.value.timeFormat);\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    cacheValue,\n    onChange,\n  };\n}\n"],"names":["useSingleValue","props","toRefs","valueFromProps","value","modelValue","useVModel","defaultValue","onChange","_slicedToArray","formatRef","computed","getDefaultFormat","mode","format","valueType","enableTimePicker","extractTimeFormat","console","error","time","ref","formatTime","timeFormat","month","dayjs","Date","getMonth","year","getFullYear","cacheValue","formatDate","targetFormat","watchEffect","isValidDate"],"mappings":"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"}