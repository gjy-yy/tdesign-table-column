{"version":3,"file":"loading.js","sources":["../../src/loading/loading.tsx"],"sourcesContent":["import { defineComponent, ref, computed, watch, onMounted, toRefs, CSSProperties } from 'vue';\nimport GradientIcon from './icon/gradient';\nimport { addClass, removeClass } from '../utils/dom';\nimport { renderTNodeJSX, renderContent } from '../utils/render-tnode';\nimport TransferDom from '../utils/transfer-dom';\nimport props from './props';\n\nimport { usePrefixClass, useCommonClassName } from '../hooks/useConfig';\n\nconst useComponentClassName = () => {\n  return {\n    name: usePrefixClass('loading'),\n    centerClass: usePrefixClass('loading--center'),\n    fullscreenClass: usePrefixClass('loading__fullscreen'),\n    lockClass: usePrefixClass('loading--lock'),\n    overlayClass: usePrefixClass('loading__overlay'),\n    relativeClass: usePrefixClass('loading__parent'),\n    fullClass: usePrefixClass('loading--full'),\n    inheritColorClass: usePrefixClass('loading--inherit-color'),\n  };\n};\n\nexport default defineComponent({\n  name: 'TLoading',\n  directives: {\n    TransferDom,\n  },\n  props,\n  setup(props, { slots }) {\n    const delayShowLoading = ref(false);\n\n    const { name, centerClass, fullscreenClass, lockClass, overlayClass, relativeClass, fullClass, inheritColorClass } =\n      useComponentClassName();\n\n    const classPrefix = usePrefixClass();\n    const { SIZE } = useCommonClassName();\n\n    const countDelay = () => {\n      delayShowLoading.value = false;\n      const timer = setTimeout(() => {\n        delayShowLoading.value = true;\n        clearTimeout(timer);\n      }, props.delay);\n    };\n\n    // 延时计时是否完成。用于控制延时计时结束前不能显示加载态\n    const delayCounted = computed(() => Boolean(!props.delay || (props.delay && delayShowLoading.value)));\n\n    // loading style\n    const styles = computed(() => {\n      const styles: CSSProperties = {};\n      if (props.zIndex !== undefined) {\n        styles.zIndex = props.zIndex;\n      }\n      if (!['small', 'medium', 'large'].includes(props.size)) {\n        styles['font-size'] = props.size;\n      }\n      return styles;\n    });\n\n    const hasContent = computed(() => Boolean(props.default || slots.default || props.content || slots.content));\n    const lockFullscreen = computed(() => props.preventScrollThrough && props.fullscreen);\n    const showText = computed(() => Boolean(props.text || slots.text));\n    const showWrapLoading = computed(() => hasContent.value && props.loading && delayCounted.value);\n    const showFullScreenLoading = computed(() => props.fullscreen && props.loading && delayCounted.value);\n    const showNormalLoading = computed(() => props.attach && props.loading && delayCounted.value);\n    const showAttachedLoading = computed(() => props.attach && props.loading && delayCounted.value);\n    const classes = computed(() => {\n      const baseClasses = [\n        centerClass.value,\n        SIZE.value[props.size],\n        { [inheritColorClass.value]: props.inheritColor },\n      ];\n      const fullScreenClasses = [name.value, fullscreenClass.value, centerClass.value, overlayClass.value];\n\n      return {\n        baseClasses,\n        attachClasses: baseClasses.concat([name.value, fullClass.value, { [overlayClass.value]: props.showOverlay }]),\n        withContentClasses: baseClasses.concat([\n          name.value,\n          fullClass.value,\n          {\n            [overlayClass.value]: props.showOverlay,\n          },\n        ]),\n        fullScreenClasses,\n        normalClasses: baseClasses.concat([name.value]),\n      };\n    });\n\n    const { loading } = toRefs(props);\n\n    watch([loading], ([isLoading]) => {\n      if (isLoading) {\n        countDelay();\n        lockFullscreen.value && addClass(document.body, lockClass.value);\n      } else {\n        lockFullscreen.value && removeClass(document.body, lockClass.value);\n      }\n    });\n\n    onMounted(() => {\n      props.delay && countDelay();\n    });\n\n    return {\n      classPrefix,\n      relativeClass,\n      delayShowLoading,\n      styles,\n      showText,\n      hasContent,\n      classes,\n      lockFullscreen,\n      showWrapLoading,\n      showNormalLoading,\n      showFullScreenLoading,\n      showAttachedLoading,\n    };\n  },\n  render() {\n    const { fullScreenClasses, baseClasses, withContentClasses, attachClasses, normalClasses } = this.classes;\n\n    const defaultIndicator = <GradientIcon size={this.size} />;\n    const indicator = this.loading && renderTNodeJSX(this, 'indicator', defaultIndicator);\n    const text = this.showText && <div class={`${this.classPrefix}-loading__text`}>{renderTNodeJSX(this, 'text')}</div>;\n\n    // full screen loading\n    if (this.fullscreen) {\n      if (!this.showFullScreenLoading) return null;\n      return (\n        <div class={fullScreenClasses} style={this.styles} v-transfer-dom={this.attach}>\n          <div class={baseClasses}>\n            {indicator}\n            {text}\n          </div>\n        </div>\n      );\n    }\n\n    // Loading is wrapping a HTMLElement.\n    if (this.hasContent) {\n      return (\n        <div class={this.relativeClass}>\n          {renderContent(this, 'default', 'content')}\n          {this.showWrapLoading && (\n            <div class={withContentClasses} style={this.styles}>\n              {indicator}\n              {text}\n            </div>\n          )}\n        </div>\n      );\n    }\n\n    // transfer parent node\n    if (this.attach) {\n      if (!this.showAttachedLoading) return null;\n      return (\n        <div class={attachClasses} style={this.styles} v-transfer-dom={this.attach}>\n          {indicator}\n          {text}\n        </div>\n      );\n    }\n\n    // Normal Loading without overlay or content\n    return (\n      <div class={normalClasses} style={this.styles}>\n        {indicator}\n        {text}\n      </div>\n    );\n  },\n});\n"],"names":["useComponentClassName","name","usePrefixClass","centerClass","fullscreenClass","lockClass","overlayClass","relativeClass","fullClass","inheritColorClass","defineComponent","directives","TransferDom","props","setup","slots","delayShowLoading","ref","classPrefix","useCommonClassName","SIZE","countDelay","value","timer","setTimeout","clearTimeout","delay","delayCounted","computed","Boolean","styles","zIndex","includes","size","hasContent","content","lockFullscreen","preventScrollThrough","fullscreen","showText","text","showWrapLoading","loading","showFullScreenLoading","showNormalLoading","attach","showAttachedLoading","classes","baseClasses","_defineProperty","inheritColor","fullScreenClasses","attachClasses","concat","showOverlay","withContentClasses","normalClasses","toRefs","watch","_slicedToArray","isLoading","addClass","document","body","removeClass","onMounted","render","defaultIndicator","_createVNode","GradientIcon","indicator","renderTNodeJSX","_withDirectives","_resolveDirective","renderContent"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AASA,IAAMA,wBAAwB,SAAxBA,qBAAwB,GAAM;EAC3B,OAAA;AACLC,IAAAA,IAAA,EAAMC,+BAAe,UADhB;AAELC,IAAAA,WAAA,EAAaD,+BAAe,kBAFvB;AAGLE,IAAAA,eAAA,EAAiBF,+BAAe,sBAH3B;AAILG,IAAAA,SAAA,EAAWH,+BAAe,gBAJrB;AAKLI,IAAAA,YAAA,EAAcJ,+BAAe,mBALxB;AAMLK,IAAAA,aAAA,EAAeL,+BAAe,kBANzB;AAOLM,IAAAA,SAAA,EAAWN,+BAAe,gBAPrB;IAQLO,iBAAA,EAAmBP,+BAAe;GAR7B,CAAA;AAUT,CAXA,CAAA;;AAaA,eAAeQ,mBAAgB,CAAA;AAC7BT,EAAAA,IAAM,EAAA,UADuB;AAE7BU,EAAAA,UAAY,EAAA;AACVC,IAAAA,WAAA,EAAAA,4BAAAA;GAH2B;AAK7BC,EAAAA,KAAA,EAAAA,wBAL6B;EAM7BC,KAN6B,EAAA,SAAA,KAAA,CAMvBD,MANuB,EAML,IAAA,EAAA;IAAA,IAATE,KAAS,QAATA,KAAS,CAAA;AAChB,IAAA,IAAAC,gBAAA,GAAmBC,QAAI,MAAvB,CAAA;;AAEA,IAAA,IAAA,qBAAA,GACJjB,qBAAsB,EADlB;QAAEC,IAAF,yBAAEA,IAAF;QAAQE,WAAR,yBAAQA,WAAR;QAAqBC,eAArB,yBAAqBA,eAArB;QAAsCC,SAAtC,yBAAsCA,SAAtC;QAAiDC,YAAjD,yBAAiDA,YAAjD;QAA+DC,aAA/D,yBAA+DA,aAA/D;QAA8EC,SAA9E,yBAA8EA,SAA9E;QAAyFC,iBAAzF,yBAAyFA,iBAAzF,CAAA;;IAGN,IAAMS,cAAchB,8BAAe,EAAnC,CAAA;;AACM,IAAA,IAAA,mBAAA,GAAWiB,kCAAmB,EAA9B;QAAEC,IAAF,uBAAEA,IAAF,CAAA;;AAEN,IAAA,IAAMC,aAAa,SAAbA,UAAa,GAAM;MACvBL,gBAAA,CAAiBM,KAAjB,GAAyB,KAAzB,CAAA;AACM,MAAA,IAAAC,KAAA,GAAQC,WAAW,YAAM;QAC7BR,gBAAA,CAAiBM,KAAjB,GAAyB,IAAzB,CAAA;QACAG,YAAA,CAAaF,KAAb,CAAA,CAAA;AACF,SAAGV,OAAMa,MAHH,CAAA;KAFR,CAAA;;IASM,IAAAC,YAAA,GAAeC,YAAS,CAAA,YAAA;AAAA,MAAA,OAAMC,OAAQ,CAAA,CAAChB,MAAM,CAAAa,KAAP,IAAiBb,MAAM,CAAAa,KAANb,IAAeG,gBAAiB,CAAAM,KAAjD,CAAd,CAAA;AAAA,KAAA,CAAxB,CAAA;AAGA,IAAA,IAAAQ,MAAA,GAASF,aAAS,YAAM;MAC5B,IAAME,UAAwB,EAA9B,CAAA;;AACIjB,MAAAA,IAAAA,MAAAA,CAAMkB,MAANlB,KAAiB,KAAW,CAA5BA,EAA4B;AAC9BiB,QAAAA,OAAAA,CAAOC,MAAPD,GAAgBjB,MAAM,CAAAkB,MAAtBD,CAAAA;AACF,OAAA;;AACI,MAAA,IAAA,CAAC,CAAC,OAAD,EAAU,QAAV,EAAoB,OAApB,CAA6BE,CAAAA,QAA7B,CAAsCnB,MAAM,CAAAoB,IAA5C,CAAD,EAAoD;AACtDH,QAAAA,OAAAA,CAAO,WAAPA,CAAAA,GAAsBjB,MAAM,CAAAoB,IAA5BH,CAAAA;AACF,OAAA;;AACOA,MAAAA,OAAAA,OAAAA,CAAAA;AACR,MATK,CAAA;IAWN,IAAMI,UAAa,GAAAN,YAAA,CAAS,YAAA;AAAA,MAAA,OAAMC,OAAA,CAAQhB,MAAM,CAAA,SAAA,CAANA,IAAiBE,KAAM,CAAA,SAAA,CAAvBF,IAAkCA,MAAM,CAAAsB,OAAxCtB,IAAmDE,KAAM,CAAAoB,OAAjE,CAAN,CAAA;AAAA,KAAT,CAAnB,CAAA;IACA,IAAMC,iBAAiBR,YAAS,CAAA,YAAA;AAAA,MAAA,OAAMf,MAAM,CAAAwB,oBAANxB,IAA8BA,OAAMyB,UAA1C,CAAA;AAAA,KAAA,CAAhC,CAAA;IACM,IAAAC,QAAA,GAAWX,aAAS,YAAA;MAAA,OAAMC,OAAA,CAAQhB,OAAM2B,IAAN3B,IAAcE,KAAA,CAAMyB,IAA5B,CAAN,CAAA;AAAA,MAApB,CAAA;IACA,IAAAC,eAAA,GAAkBb,aAAS,YAAA;MAAA,OAAMM,UAAA,CAAWZ,KAAX,IAAoBT,MAAM,CAAA6B,OAA1B,IAAqCf,aAAaL,KAAxD,CAAA;AAAA,MAA3B,CAAA;IACA,IAAAqB,qBAAA,GAAwBf,aAAS,YAAA;MAAA,OAAMf,MAAAA,CAAMyB,UAANzB,IAAoBA,MAAM,CAAA6B,OAA1B7B,IAAqCc,aAAaL,KAAxD,CAAA;AAAA,MAAjC,CAAA;IACA,IAAAsB,iBAAA,GAAoBhB,aAAS,YAAA;MAAA,OAAMf,MAAAA,CAAMgC,MAANhC,IAAgBA,MAAM,CAAA6B,OAAtB7B,IAAiCc,aAAaL,KAApD,CAAA;AAAA,MAA7B,CAAA;IACA,IAAAwB,mBAAA,GAAsBlB,aAAS,YAAA;MAAA,OAAMf,MAAAA,CAAMgC,MAANhC,IAAgBA,MAAM,CAAA6B,OAAtB7B,IAAiCc,aAAaL,KAApD,CAAA;AAAA,MAA/B,CAAA;AACA,IAAA,IAAAyB,OAAA,GAAUnB,aAAS,YAAM;MAC7B,IAAMoB,WAAc,GAAA,CAClB7C,WAAY,CAAAmB,KADM,EAElBF,IAAA,CAAKE,KAAL,CAAWT,MAAM,CAAAoB,IAAjB,CAFkB,EAAAgB,mCAAA,CAAA,EAAA,EAGfxC,iBAAkB,CAAAa,KAHH,EAGWT,OAAMqC,YAHjB,CAApB,CAAA,CAAA;AAKM,MAAA,IAAAC,iBAAA,GAAoB,CAAClD,IAAK,CAAAqB,KAAN,EAAalB,gBAAgBkB,KAA7B,EAAoCnB,WAAA,CAAYmB,KAAhD,EAAuDhB,YAAA,CAAagB,KAApE,CAApB,CAAA;MAEC,OAAA;AACL0B,QAAAA,WAAA,EAAAA,WADK;QAELI,aAAe,EAAAJ,WAAA,CAAYK,MAAZ,CAAmB,CAACpD,KAAKqB,KAAN,EAAad,SAAA,CAAUc,KAAvB,EAAA2B,mCAAA,CAAA,EAAA,EAAiC3C,YAAa,CAAAgB,KAA9C,EAAsDT,MAAM,CAAAyC,WAA5D,CAAA,CAAnB,CAFV;QAGLC,kBAAA,EAAoBP,YAAYK,MAAZ,CAAmB,CACrCpD,IAAK,CAAAqB,KADgC,EAErCd,SAAU,CAAAc,KAF2B,EAAA2B,mCAAA,CAAA,EAAA,EAIlC3C,YAAa,CAAAgB,KAJqB,EAIbT,MAAM,CAAAyC,WAJO,CAAA,CAAnB,CAHf;AAULH,QAAAA,iBAAA,EAAAA,iBAVK;QAWLK,eAAeR,WAAY,CAAAK,MAAZ,CAAmB,CAACpD,IAAA,CAAKqB,KAAN,CAAnB,CAAA;OAXV,CAAA;AAaR,MArBK,CAAA;;IAuBN,IAAoBmC,OAAAA,GAAAA,UAAA,CAAO5C,MAAP,CAApB;QAAQ6B,OAAR,WAAQA,OAAR,CAAA;;AAEAgB,IAAAA,SAAA,CAAM,CAAChB,OAAD,CAAN,EAAiB,UAAiB,KAAA,EAAA;AAAA,MAAA,IAAA,KAAA,GAAAiB,kCAAA,CAAA,KAAA,EAAA,CAAA,CAAA;AAAA,UAAfC,SAAe,GAAA,KAAA,CAAA,CAAA,CAAA,CAAA;;AAChC,MAAA,IAAIA,SAAJ,EAAe;QACFvC,UAAA,EAAA,CAAA;AACXe,QAAAA,cAAA,CAAed,KAAf,IAAwBuC,kBAAA,CAASC,QAAS,CAAAC,IAAlB,EAAwB1D,UAAUiB,KAAlC,CAAxB,CAAA;AACK,OAHP,MAGO;AACLc,QAAAA,cAAA,CAAed,KAAf,IAAwB0C,qBAAA,CAAYF,QAAS,CAAAC,IAArB,EAA2B1D,UAAUiB,KAArC,CAAxB,CAAA;AACF,OAAA;AACD,KAPD,CAAA,CAAA;AASA2C,IAAAA,aAAA,CAAU,YAAM;AACdpD,MAAAA,MAAAA,CAAMa,KAANb,IAAeQ,UAAW,EAA1BR,CAAAA;AACD,KAFD,CAAA,CAAA;IAIO,OAAA;AACLK,MAAAA,WAAA,EAAAA,WADK;AAELX,MAAAA,aAAA,EAAAA,aAFK;AAGLS,MAAAA,gBAAA,EAAAA,gBAHK;AAILc,MAAAA,MAAA,EAAAA,MAJK;AAKLS,MAAAA,QAAA,EAAAA,QALK;AAMLL,MAAAA,UAAA,EAAAA,UANK;AAOLa,MAAAA,OAAA,EAAAA,OAPK;AAQLX,MAAAA,cAAA,EAAAA,cARK;AASLK,MAAAA,eAAA,EAAAA,eATK;AAULG,MAAAA,iBAAA,EAAAA,iBAVK;AAWLD,MAAAA,qBAAA,EAAAA,qBAXK;AAYLG,MAAAA,mBAAA,EAAAA,mBAAAA;KAZK,CAAA;GAnFoB;AAkG7BoB,EAAAA,MAlG6B,EAkGpB,SAAA,MAAA,GAAA;AACP,IAAA,IAAA,aAAA,GAA6F,KAAKnB,OAAlG;QAAQI,iBAAR,iBAAQA,iBAAR;QAA2BH,WAA3B,iBAA2BA,WAA3B;QAAwCO,kBAAxC,iBAAwCA,kBAAxC;QAA4DH,aAA5D,iBAA4DA,aAA5D;QAA2EI,aAA3E,iBAA2EA,aAA3E,CAAA;;AAEA,IAAA,IAAMW,gBAAmB,GAAAC,eAAA,CAAAC,gCAAA,EAAA;AAAA,MAAA,MAAA,EAAoB,IAAKpC,CAAAA,IAAAA;KAAlD,EAAA,IAAA,CAAA,CAAA;;AACA,IAAA,IAAMqC,YAAY,IAAK5B,CAAAA,OAAL,IAAgB6B,gCAAe,CAAA,IAAA,EAAM,WAAN,EAAmBJ,gBAAnB,CAAjD,CAAA;;IACA,IAAM3B,IAAO,GAAA,IAAA,CAAKD,QAAL,IAAA6B,eAAA,CAAA,KAAA,EAAA;AAAA,MAAA,OAAA,EAAA,EAAA,CAAA,MAAA,CAAgC,KAAKlD,WAArC,EAAA,gBAAA,CAAA;AAAA,KAAA,EAAA,CAAmEqD,gCAAA,CAAe,IAAf,EAAqB,MAArB,CAAnE,CAAb,CAAA,CAAA;;IAGA,IAAI,IAAA,CAAKjC,UAAT,EAAqB;AACnB,MAAA,IAAI,CAAC,IAAA,CAAKK,qBAAV,EAAwC,OAAA,IAAA,CAAA;AACxC,MAAA,OAAA6B,kBAAA,CAAAJ,eAAA,CAAA,KAAA,EAAA;AAAA,QAAA,OAAA,EACcjB,iBADd;AAAA,QAAA,OAAA,EACwC,IAAKrB,CAAAA,MAAAA;AAD7C,OAAA,EAAA,CAAAsC,eAAA,CAAA,KAAA,EAAA;QAAA,OAEgBpB,EAAAA,WAAAA;AAFhB,OAAA,EAAA,CAGOsB,SAHP,EAIO9B,IAJP,CAAA,CAAA,CAAA,CAAA,EAAA,CAAA,CAAAiC,oBAAA,CAAA,cAAA,CAAA,EACqE,KAAK5B,MAD1E,CAAA,CAAA,CAAA,CAAA;AAQF,KAAA;;IAGA,IAAI,IAAA,CAAKX,UAAT,EAAqB;AAEjB,MAAA,OAAAkC,eAAA,CAAA,KAAA,EAAA;AAAA,QAAA,OAAA,EAAY,IAAK7D,CAAAA,aAAAA;OACdmE,EAAAA,CAAAA,+BAAA,CAAc,IAAd,EAAoB,SAApB,EAA+B,SAA/B,CADH,EAEG,IAAA,CAAKjC,eAAL,IAAA2B,eAAA,CAAA,KAAA,EAAA;AAAA,QAAA,OAAA,EACab,kBADb;AAAA,QAAA,OAAA,EACwC,IAAKzB,CAAAA,MAAAA;OACzCwC,EAAAA,CAAAA,SAFJ,EAGI9B,IAHJ,CAFH,CAAA,CAAA,CAAA,CAAA;AAUJ,KAAA;;IAGA,IAAI,IAAA,CAAKK,MAAT,EAAiB;AACf,MAAA,IAAI,CAAC,IAAA,CAAKC,mBAAV,EAAsC,OAAA,IAAA,CAAA;AAEpC,MAAA,OAAA0B,kBAAA,CAAAJ,eAAA,CAAA,KAAA,EAAA;AAAA,QAAA,OAAA,EAAYhB,aAAZ;AAAA,QAAA,OAAA,EAAkC,IAAKtB,CAAAA,MAAAA;AAAvC,OAAA,EAAA,CACGwC,SADH,EAEG9B,IAFH,CAAA,CAAA,EAAA,CAAA,CAAAiC,oBAAA,CAAA,cAAA,CAAA,EAA+D,KAAK5B,MAApE,CAAA,CAAA,CAAA,CAAA;AAKJ,KAAA;;AAGA,IAAA,OAAAuB,eAAA,CAAA,KAAA,EAAA;AAAA,MAAA,OAAA,EACcZ,aADd;AAAA,MAAA,OAAA,EACoC,IAAK1B,CAAAA,MAAAA;KACpCwC,EAAAA,CAAAA,SAFL,EAGK9B,IAHL,CAAA,CAAA,CAAA;AAMF,GAAA;AAvJ6B,CAAA,CAA/B;;;;"}