{"version":3,"file":"plugin.js","sources":["../../src/loading/plugin.tsx"],"sourcesContent":["import { App, Plugin, createApp, defineComponent, h, reactive } from 'vue';\nimport LoadingComponent from './loading';\nimport { getAttach, removeClass, addClass } from '../utils/dom';\nimport { TdLoadingProps, LoadingInstance, LoadingMethod } from './type';\nimport { usePrefixClass } from '../hooks/useConfig';\n\nlet fullScreenLoadingInstance: LoadingInstance = null;\n\nfunction createLoading(props: TdLoadingProps): LoadingInstance {\n  const component = defineComponent({\n    setup() {\n      const loadingOptions = reactive(props);\n      return {\n        loadingOptions,\n      };\n    },\n    render() {\n      return h(LoadingComponent, {\n        ...this.loadingOptions,\n      });\n    },\n  });\n\n  const attach = getAttach(props.attach);\n\n  const loading = createApp(component).mount(document.createElement('div'));\n  const parentRelativeClass = usePrefixClass('loading__parent--relative').value;\n\n  if (attach) {\n    attach.appendChild(loading.$el);\n    addClass(attach, parentRelativeClass);\n  } else {\n    console.error('attach is not exist');\n  }\n\n  const loadingInstance: LoadingInstance = {\n    hide: () => {\n      loading.loading = false;\n      loading.$el.parentNode.removeChild(loading.$el);\n      removeClass(attach, parentRelativeClass);\n    },\n  };\n  return loadingInstance;\n}\n\nfunction produceLoading(props: boolean | TdLoadingProps): LoadingInstance {\n  const lockClass = usePrefixClass('loading--lock');\n\n  // 全屏加载\n  if (props === true) {\n    fullScreenLoadingInstance = createLoading({\n      fullscreen: true,\n      loading: true,\n      attach: 'body',\n    });\n    return fullScreenLoadingInstance;\n  }\n  removeClass(document.body, lockClass.value);\n\n  if (props === false) {\n    // 销毁全屏实例\n    removeClass(document.body, lockClass.value);\n    fullScreenLoadingInstance.hide();\n    fullScreenLoadingInstance = null;\n    return;\n  }\n  return createLoading(props);\n}\n\nexport type LoadingPluginType = Plugin & LoadingMethod;\n\nconst LoadingPlugin: LoadingPluginType = produceLoading as LoadingPluginType;\n\nLoadingPlugin.install = (app: App) => {\n  // eslint-disable-next-line no-param-reassign\n  app.config.globalProperties.$loading = produceLoading;\n};\n\nexport default LoadingPlugin;\n"],"names":["fullScreenLoadingInstance","createLoading","props","component","defineComponent","setup","loadingOptions","reactive","render","h","LoadingComponent","attach","getAttach","loading","createApp","mount","document","createElement","parentRelativeClass","usePrefixClass","value","appendChild","$el","addClass","console","error","loadingInstance","hide","parentNode","removeChild","removeClass","produceLoading","lockClass","fullscreen","body","LoadingPlugin","install","app","config","globalProperties","$loading"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAMA,IAAIA,yBAA6C,GAAA,IAAjD,CAAA;;AAEA,SAASC,aAAT,CAAuBC,KAAvB,EAA+D;EAC7D,IAAMC,YAAYC,mBAAgB,CAAA;AAChCC,IAAAA,KADgC,EACxB,SAAA,KAAA,GAAA;AACA,MAAA,IAAAC,cAAA,GAAiBC,aAASL,MAA1B,CAAA;MACC,OAAA;AACLI,QAAAA,cAAA,EAAAA,cAAAA;OADK,CAAA;KAHuB;AAOhCE,IAAAA,MAPgC,EAOvB,SAAA,MAAA,GAAA;AACP,MAAA,OAAOC,MAAEC,4BACJ,aAAA,CAAA,EAAA,EAAA,IAAA,CAAKJ,eADV,CAAA,CAAA;AAGF,KAAA;AAXgC,GAAA,CAAlC,CAAA;AAcM,EAAA,IAAAK,MAAA,GAASC,mBAAU,CAAAV,KAAA,CAAMS,MAAN,CAAnB,CAAA;AAEA,EAAA,IAAAE,OAAA,GAAUC,cAAUX,UAAV,CAAqBY,KAArB,CAA2BC,QAAS,CAAAC,aAAT,CAAuB,KAAvB,CAA3B,CAAV,CAAA;AACA,EAAA,IAAAC,mBAAA,GAAsBC,8BAAe,CAAA,2BAAA,CAAf,CAA4CC,KAAlE,CAAA;;AAEN,EAAA,IAAIT,MAAJ,EAAY;AACHA,IAAAA,MAAA,CAAAU,WAAA,CAAYR,QAAQS,GAApB,CAAA,CAAA;AACPC,IAAAA,kBAAA,CAASZ,MAAT,EAAiBO,mBAAjB,CAAA,CAAA;AACK,GAHP,MAGO;IACLM,OAAA,CAAQC,KAAR,CAAc,qBAAd,CAAA,CAAA;AACF,GAAA;;AAEA,EAAA,IAAMC,eAAmC,GAAA;AACvCC,IAAAA,MAAM,SAAM,IAAA,GAAA;MACVd,OAAA,CAAQA,OAAR,GAAkB,KAAlB,CAAA;MACAA,OAAA,CAAQS,GAAR,CAAYM,UAAZ,CAAuBC,WAAvB,CAAmChB,OAAA,CAAQS,GAA3C,CAAA,CAAA;AACAQ,MAAAA,qBAAA,CAAYnB,MAAZ,EAAoBO,mBAApB,CAAA,CAAA;AACF,KAAA;GALF,CAAA;AAOO,EAAA,OAAAQ,eAAA,CAAA;AACT,CAAA;;AAEA,SAASK,cAAT,CAAwB7B,KAAxB,EAA0E;AAClE,EAAA,IAAA8B,SAAA,GAAYb,+BAAe,gBAA3B,CAAA;;EAGN,IAAIjB,UAAU,IAAd,EAAoB;IAClBF,yBAAA,GAA4BC,aAAc,CAAA;AACxCgC,MAAAA,UAAY,EAAA,IAD4B;AAExCpB,MAAAA,OAAS,EAAA,IAF+B;AAGxCF,MAAAA,MAAQ,EAAA,MAAA;AAHgC,KAAA,CAA1C,CAAA;AAKO,IAAA,OAAAX,yBAAA,CAAA;AACT,GAAA;;EACY8B,qBAAA,CAAAd,QAAA,CAASkB,IAAT,EAAeF,SAAA,CAAUZ,KAAzB,CAAA,CAAA;;EAEZ,IAAIlB,UAAU,KAAd,EAAqB;IAEP4B,qBAAA,CAAAd,QAAA,CAASkB,IAAT,EAAeF,SAAA,CAAUZ,KAAzB,CAAA,CAAA;AACZpB,IAAAA,yBAAA,CAA0B2B,IAA1B,EAAA,CAAA;AAC4B3B,IAAAA,yBAAA,GAAA,IAAA,CAAA;AAC5B,IAAA,OAAA;AACF,GAAA;;EACA,OAAOC,cAAcC,MAArB,CAAA;AACF,CAAA;;AAIMiC,IAAAA,aAAmC,GAAAJ,eAAzC;;AAEAI,aAAc,CAAAC,OAAd,GAAwB,UAACC,GAAD,EAAc;AAEhCA,EAAAA,GAAA,CAAAC,MAAA,CAAOC,gBAAP,CAAwBC,QAAxB,GAAmCT,cAAnC,CAAA;AACN,CAHA;;;;"}