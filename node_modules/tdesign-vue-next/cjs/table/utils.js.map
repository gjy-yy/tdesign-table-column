{"version":3,"file":"utils.js","sources":["../../src/table/utils.ts"],"sourcesContent":["import isFunction from 'lodash/isFunction';\nimport get from 'lodash/get';\nimport isObject from 'lodash/isObject';\nimport { PrimaryTableCol, RowClassNameParams, TableRowData, TdBaseTableProps } from './type';\nimport { ClassName, HTMLElementAttributes } from '../common';\nimport { AffixProps } from '../affix';\n\nexport function toString(obj: any): string {\n  return Object.prototype.toString.call(obj).slice(8, -1).toLowerCase();\n}\n\nexport function debounce<T = any>(fn: Function, delay = 200): () => void {\n  let timer: ReturnType<typeof setTimeout>;\n  return function newFn(this: T, ...args: Array<any>): void {\n    // eslint-disable-next-line @typescript-eslint/no-this-alias\n    const context = this;\n    clearTimeout(timer);\n    timer = setTimeout(() => {\n      fn.apply(context, args);\n    }, delay);\n  };\n}\n\nexport interface FormatRowAttributesParams {\n  row: TableRowData;\n  rowIndex: number;\n  type: 'body' | 'foot';\n}\n\n// 行属性\nexport function formatRowAttributes(attributes: TdBaseTableProps['rowAttributes'], params: FormatRowAttributesParams) {\n  if (!attributes) return undefined;\n  const attrList = attributes instanceof Array ? attributes : [attributes];\n  let result: HTMLElementAttributes = {};\n  for (let i = 0; i < attrList.length; i++) {\n    const attrItem = attrList[i];\n    if (!attrItem) continue;\n    const attrProperty = isFunction(attrItem) ? attrItem(params) : attrItem;\n    result =\n      attrProperty instanceof Array ? formatRowAttributes(attrProperty, params) : Object.assign(result, attrProperty);\n  }\n  return result;\n}\n\n// 行类名，['A', 'B']，[() => 'A', () => 'B']\nexport function formatRowClassNames(\n  rowClassNames: TdBaseTableProps['rowClassName'],\n  params: RowClassNameParams<TableRowData>,\n  rowKey: string,\n) {\n  const rowClassList = rowClassNames instanceof Array ? rowClassNames : [rowClassNames];\n  const { row, rowIndex } = params;\n  // 自定义行类名\n  let customClasses: ClassName = [];\n  for (let i = 0, len = rowClassList.length; i < len; i++) {\n    const rName = rowClassList[i];\n    let tClass = isFunction(rName) ? rName(params) : rName;\n    if (isObject(tClass) && !(tClass instanceof Array)) {\n      // 根据下标设置行类名\n      tClass[rowIndex] && (tClass = tClass[rowIndex]);\n      // 根据行唯一标识设置行类名\n      const rowId = get(row, rowKey || 'id');\n      tClass[rowId] && (tClass = tClass[rowId]);\n    } else if (tClass instanceof Array) {\n      tClass = formatRowClassNames(tClass, params, rowKey);\n    }\n    customClasses = customClasses.concat(tClass);\n  }\n  return customClasses;\n}\n\nexport const INNER_PRE_NAME = '@@inner-';\n\nexport enum SCROLL_DIRECTION {\n  X = 'x',\n  Y = 'y',\n  UNKNOWN = 'unknown',\n}\n\nlet preScrollLeft: any;\nlet preScrollTop: any;\n\nexport const getScrollDirection = (scrollLeft: number, scrollTop: number): SCROLL_DIRECTION => {\n  let direction = SCROLL_DIRECTION.UNKNOWN;\n  if (preScrollTop !== scrollTop) {\n    direction = SCROLL_DIRECTION.Y;\n  } else if (preScrollLeft !== scrollLeft) {\n    direction = SCROLL_DIRECTION.X;\n  }\n  preScrollTop = scrollTop;\n  preScrollLeft = scrollLeft;\n  return direction;\n};\n\nexport const getRecord = (record: Record<any, any>) => {\n  if (!record) {\n    return record;\n  }\n  const result = {};\n  Object.keys(record).forEach((key) => {\n    const descriptor = Object.getOwnPropertyDescriptor(record, key);\n    descriptor &&\n      Reflect.defineProperty(result, key, {\n        set(val) {\n          descriptor.set(val);\n        },\n        get() {\n          console.warn('The parameter `record` will be deprecated, please use `row` instead');\n          return descriptor.get();\n        },\n      });\n  });\n  return result;\n};\n\n// 多级表头，列配置场景，获取 currentRow\nexport function getCurrentRowByKey<T extends { colKey?: string; children?: any[] }>(columns: T[], key: string): T {\n  if (!columns || !key) return;\n  const col = columns?.find((t) => t.colKey === key);\n  if (col) return col;\n  for (let i = 0, len = columns.length; i < len; i++) {\n    if (columns[i]?.children?.length) {\n      return getCurrentRowByKey(columns[i]?.children, key);\n    }\n  }\n}\n\n/** 透传 Affix 组件全部特性 */\nexport function getAffixProps(mainAffixProps: boolean | AffixProps, subAffixProps?: AffixProps) {\n  if (typeof mainAffixProps === 'object') return mainAffixProps;\n  if (typeof subAffixProps === 'object') return subAffixProps;\n  return {};\n}\n\nexport function getEditableKeysMap(keys: Array<string | number>, list: any[], rowKey: string) {\n  const map: { [key: string | number]: boolean } = {};\n  for (let i = 0, len = list.length; i < len; i++) {\n    const rowValue = get(list[i], rowKey);\n    if (keys.includes(rowValue)) {\n      map[rowValue] = true;\n    }\n  }\n  return map;\n}\n\nexport function getColumnDataByKey(columns: any[], colKey: string): any {\n  for (let i = 0, len = columns.length; i < len; i++) {\n    if (columns[i].colKey === colKey) return columns[i];\n    if (columns[i].children?.length) {\n      const t = getColumnDataByKey(columns[i].children, colKey);\n      if (t) return t;\n    }\n  }\n  return null;\n}\n\nexport function getColumnIndexByKey(columns: any[], colKey: string): number {\n  for (let i = 0, len = columns.length; i < len; i++) {\n    if (columns[i].colKey === colKey) {\n      return i;\n    }\n    if (columns[i].children?.length) {\n      const t = getColumnDataByKey(columns[i].children, colKey);\n      if (t) return i;\n    }\n  }\n  return -1;\n}\n"],"names":["toString","obj","Object","prototype","call","slice","toLowerCase","debounce","fn","delay","timer","newFn","args","context","clearTimeout","setTimeout","apply","formatRowAttributes","attributes","params","attrList","Array","result","i","length","attrItem","attrProperty","isFunction","assign","formatRowClassNames","rowClassNames","rowKey","rowClassList","row","rowIndex","customClasses","len","rName","tClass","isObject","rowId","get","concat","INNER_PRE_NAME","SCROLL_DIRECTION","preScrollLeft","preScrollTop","getScrollDirection","scrollLeft","scrollTop","direction","getRecord","record","keys","forEach","key","descriptor","getOwnPropertyDescriptor","Reflect","defineProperty","set","val","console","warn","getCurrentRowByKey","columns","col","find","t","colKey","children","getAffixProps","mainAffixProps","subAffixProps","_typeof","getEditableKeysMap","list","map","rowValue","includes","getColumnDataByKey","getColumnIndexByKey"],"mappings":"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"}