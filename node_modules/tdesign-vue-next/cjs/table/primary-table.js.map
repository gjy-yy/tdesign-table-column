{"version":3,"file":"primary-table.js","sources":["../../src/table/primary-table.tsx"],"sourcesContent":["import { computed, defineComponent, toRefs, h, ref, onMounted, SetupContext } from 'vue';\nimport get from 'lodash/get';\nimport omit from 'lodash/omit';\nimport baseTableProps from './base-table-props';\nimport primaryTableProps from './primary-table-props';\nimport BaseTable from './base-table';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport useColumnController from './hooks/useColumnController';\nimport useRowExpand from './hooks/useRowExpand';\nimport useTableHeader, { renderTitle } from './hooks/useTableHeader';\nimport useRowSelect from './hooks/useRowSelect';\nimport {\n  TdPrimaryTableProps,\n  PrimaryTableCol,\n  TableRowData,\n  PrimaryTableCellParams,\n  PrimaryTableRowEditContext,\n} from './type';\nimport useSorter from './hooks/useSorter';\nimport useFilter from './hooks/useFilter';\nimport useDragSort from './hooks/useDragSort';\nimport useAsyncLoading from './hooks/useAsyncLoading';\nimport EditableCell, { EditableCellProps } from './editable-cell';\nimport { PageInfo } from '../pagination';\nimport useClassName from './hooks/useClassName';\nimport useEditableRow from './hooks/useEditableRow';\n\nexport { BASE_TABLE_ALL_EVENTS } from './base-table';\n\nconst OMIT_PROPS = [\n  'hideSortTips',\n  'dragSort',\n  'defaultExpandedRowKeys',\n  'defaultSelectedRowKeys',\n  'columnController',\n  'filterRow',\n  'sortOnRowDraggable',\n  'expandOnRowClick',\n  'multipleSort',\n  'expandIcon',\n  'onChange',\n  'onAsyncLoadingClick',\n  'onColumnChange',\n  'onColumnControllerVisibleChange',\n  'onDataChange',\n  'onDisplayColumnsChange',\n  'onDragSort',\n  'onExpandChange',\n  'onFilterChange',\n  'onSelectChange',\n  'onSortChange',\n];\n\nconst cellRuleMap = new Map<any, PrimaryTableRowEditContext<TableRowData>[]>();\n\nexport default defineComponent({\n  name: 'TPrimaryTable',\n\n  props: {\n    ...baseTableProps,\n    ...primaryTableProps,\n  },\n\n  setup(props: TdPrimaryTableProps, context: SetupContext) {\n    const renderTNode = useTNodeJSX();\n    const { columns, columnController } = toRefs(props);\n    const primaryTableRef = ref(null);\n    const { tableDraggableClasses, tableBaseClass, tableSelectedClasses } = useClassName();\n    // 自定义列配置功能\n    const { tDisplayColumns, renderColumnController } = useColumnController(props, context);\n    // 展开/收起行功能\n    const { showExpandedRow, showExpandIconColumn, getExpandColumn, renderExpandedRow, onInnerExpandRowClick } =\n      useRowExpand(props, context);\n    // 排序功能\n    const { renderSortIcon } = useSorter(props, context);\n    // 行选中功能\n    const { formatToRowSelectColumn, selectedRowClassNames } = useRowSelect(props, tableSelectedClasses);\n    // 过滤功能\n    const {\n      hasEmptyCondition,\n      isTableOverflowHidden,\n      renderFilterIcon,\n      renderFirstFilterRow,\n      setFilterPrimaryTableRef,\n    } = useFilter(props, context);\n\n    // 拖拽排序功能\n    const { isRowHandlerDraggable, isRowDraggable, isColDraggable, setDragSortPrimaryTableRef, setDragSortColumns } =\n      useDragSort(props, context);\n\n    const { renderTitleWidthIcon } = useTableHeader(props);\n    const { renderAsyncLoading } = useAsyncLoading(props, context);\n\n    const { errorListMap, editableKeysMap, validateRowData, validateTableData, onRuleChange, clearValidateData } =\n      useEditableRow(props);\n\n    const primaryTableClasses = computed(() => {\n      return {\n        [tableDraggableClasses.colDraggable]: isColDraggable.value,\n        [tableDraggableClasses.rowHandlerDraggable]: isRowHandlerDraggable.value,\n        [tableDraggableClasses.rowDraggable]: isRowDraggable.value,\n        [tableBaseClass.overflowVisible]: isTableOverflowHidden.value === false,\n        [tableBaseClass.tableRowEdit]: props.editableRowKeys,\n      };\n    });\n\n    // 如果想给 TR 添加类名，请在这里补充，不要透传更多额外 Props 到 BaseTable\n    const tRowClassNames = computed(() => {\n      const tClassNames = [props.rowClassName, selectedRowClassNames.value];\n      return tClassNames.filter((v) => v);\n    });\n\n    // 如果想给 TR 添加属性，请在这里补充，不要透传更多额外 Props 到 BaseTable\n    const tRowAttributes = computed(() => {\n      const tAttributes = [props.rowAttributes];\n      if (isRowHandlerDraggable.value || isRowDraggable.value) {\n        tAttributes.push(({ row }) => ({ 'data-id': get(row, props.rowKey || 'id') }));\n      }\n      return tAttributes.filter((v) => v);\n    });\n\n    // 多个 Hook 共用 primaryTableRef\n    onMounted(() => {\n      setFilterPrimaryTableRef(primaryTableRef.value);\n      setDragSortPrimaryTableRef(primaryTableRef.value);\n    });\n\n    // 对外暴露的方法\n    context.expose({\n      validateRowData,\n      validateTableData,\n      clearValidateData,\n      refreshTable: () => {\n        primaryTableRef.value.refreshTable();\n      },\n    });\n\n    // 1. 影响列数量的因素有：自定义列配置、展开/收起行、多级表头；2. 影响表头内容的因素有：排序图标、筛选图标\n    const getColumns = (columns: PrimaryTableCol<TableRowData>[]) => {\n      const arr: PrimaryTableCol<TableRowData>[] = [];\n      for (let i = 0, len = columns.length; i < len; i++) {\n        let item = { ...columns[i] };\n        // 自定义列显示控制\n        const isDisplayColumn = item.children?.length || tDisplayColumns.value?.includes(item.colKey);\n        if (!isDisplayColumn && props.columnController) continue;\n        item = formatToRowSelectColumn(item);\n        // 添加排序图标和过滤图标\n        if (item.sorter || item.filter) {\n          const titleContent = renderTitle(context.slots, item, i);\n          const { ellipsisTitle } = item;\n          item.title = (h, p) => {\n            const sortIcon = item.sorter ? renderSortIcon(p) : null;\n            const filterIcon = item.filter ? renderFilterIcon(p) : null;\n            // @ts-ignore 注意：此处 Vue2 和 Vue3 有所不同\n            const attach = primaryTableRef.value?.tableContentRef;\n            return renderTitleWidthIcon([titleContent, sortIcon, filterIcon], p.col, p.colIndex, ellipsisTitle, attach);\n          };\n          item.ellipsisTitle = false;\n        }\n        // 如果是单元格可编辑状态\n        if (item.edit?.component) {\n          const oldCell = item.cell;\n          item.cell = (h, p: PrimaryTableCellParams<TableRowData>) => {\n            const cellProps: EditableCellProps = {\n              ...p,\n              oldCell,\n              tableBaseClass,\n              cellEmptyContent: props.cellEmptyContent,\n              onChange: props.onRowEdit,\n              onValidate: props.onRowValidate,\n              onRuleChange,\n            };\n            if (props.editableRowKeys) {\n              const rowValue = get(p.row, props.rowKey || 'id');\n              cellProps.editable = editableKeysMap.value[rowValue] || false;\n              const key = [rowValue, p.col.colKey].join('__');\n              const errorList = errorListMap.value?.[key];\n              errorList && (cellProps.errors = errorList);\n            }\n            if (props.editableCellState) {\n              cellProps.readonly = !props.editableCellState(p);\n            }\n            return <EditableCell {...cellProps} v-slots={context.slots} />;\n          };\n        }\n        if (item.children?.length) {\n          item.children = getColumns(item.children);\n        }\n        // 多级表头和自定义列配置特殊逻辑：要么子节点不存在，要么子节点长度大于 1，方便做自定义列配置\n        if (!item.children || item.children?.length) {\n          arr.push(item);\n        }\n      }\n      return arr;\n    };\n\n    const tColumns = computed(() => {\n      const cols = getColumns(columns.value);\n      if (showExpandIconColumn.value) {\n        cols.unshift(getExpandColumn());\n      }\n      return cols;\n    });\n\n    const onInnerPageChange = (pageInfo: PageInfo, newData: Array<TableRowData>) => {\n      props.onPageChange?.(pageInfo, newData);\n      const changeParams: Parameters<TdPrimaryTableProps['onChange']> = [\n        { pagination: pageInfo },\n        { trigger: 'pagination', currentData: newData },\n      ];\n      props.onChange?.(...changeParams);\n    };\n\n    return () => {\n      const formatNode = (\n        api: string,\n        renderInnerNode: Function,\n        condition: boolean,\n        extra?: { reverse?: boolean },\n      ) => {\n        if (!condition) return props[api];\n        const innerNode = renderInnerNode(h);\n        const propsNode = renderTNode(api);\n        if (innerNode && !propsNode) return () => innerNode;\n        if (propsNode && !innerNode) return () => propsNode;\n        if (innerNode && propsNode) {\n          return () =>\n            extra?.reverse ? (\n              <div>\n                {innerNode}\n                {propsNode}\n              </div>\n            ) : (\n              <div>\n                {propsNode}\n                {innerNode}\n              </div>\n            );\n        }\n        return null;\n      };\n      const isColumnController = !!(columnController.value && Object.keys(columnController.value).length);\n      // @ts-ignore\n      const placement = isColumnController ? columnController.value.placement || 'top-right' : '';\n      const isBottomController = isColumnController && placement?.indexOf('bottom') !== -1;\n      const topContent = formatNode('topContent', renderColumnController, isColumnController && !isBottomController);\n      const bottomContent = formatNode('bottomContent', renderColumnController, isBottomController, {\n        reverse: true,\n      });\n      const firstFullRow = formatNode('firstFullRow', renderFirstFilterRow, !hasEmptyCondition.value);\n      const lastFullRow = formatNode('lastFullRow', renderAsyncLoading, !!props.asyncLoading);\n\n      const baseTableProps = {\n        ...omit(props, OMIT_PROPS),\n        rowClassName: tRowClassNames.value,\n        rowAttributes: tRowAttributes.value,\n        columns: tColumns.value,\n        topContent,\n        bottomContent,\n        firstFullRow,\n        lastFullRow,\n        onPageChange: onInnerPageChange,\n        renderExpandedRow: showExpandedRow.value ? renderExpandedRow : undefined,\n      };\n\n      if (props.expandOnRowClick) {\n        baseTableProps.onRowClick = onInnerExpandRowClick;\n      }\n\n      return (\n        // @ts-ignore\n        <BaseTable\n          ref={primaryTableRef}\n          v-slots={context.slots}\n          {...baseTableProps}\n          class={primaryTableClasses.value}\n          onLeafColumnsChange={setDragSortColumns}\n        />\n      );\n    };\n  },\n});\n"],"names":["OMIT_PROPS","defineComponent","name","props","baseTableProps","primaryTableProps","setup","context","renderTNode","useTNodeJSX","toRefs","columns","columnController","primaryTableRef","ref","useClassName","tableDraggableClasses","tableBaseClass","tableSelectedClasses","useColumnController","tDisplayColumns","renderColumnController","useRowExpand","showExpandedRow","showExpandIconColumn","getExpandColumn","renderExpandedRow","onInnerExpandRowClick","useSorter","renderSortIcon","useRowSelect","formatToRowSelectColumn","selectedRowClassNames","useFilter","hasEmptyCondition","isTableOverflowHidden","renderFilterIcon","renderFirstFilterRow","setFilterPrimaryTableRef","useDragSort","isRowHandlerDraggable","isRowDraggable","isColDraggable","setDragSortPrimaryTableRef","setDragSortColumns","useTableHeader","renderTitleWidthIcon","useAsyncLoading","renderAsyncLoading","useEditableRow","errorListMap","editableKeysMap","validateRowData","validateTableData","onRuleChange","clearValidateData","primaryTableClasses","computed","_defineProperty","colDraggable","value","rowHandlerDraggable","rowDraggable","overflowVisible","tableRowEdit","editableRowKeys","tRowClassNames","tClassNames","rowClassName","filter","v","tRowAttributes","tAttributes","rowAttributes","push","row","get","rowKey","onMounted","expose","refreshTable","getColumns","arr","i","len","item","isDisplayColumn","children","length","includes","colKey","sorter","titleContent","renderTitle","slots","ellipsisTitle","title","h","p","sortIcon","filterIcon","attach","tableContentRef","col","colIndex","edit","component","oldCell","cell","cellProps","cellEmptyContent","onChange","onRowEdit","onValidate","onRowValidate","rowValue","editable","key","join","errorList","errors","editableCellState","readonly","_createVNode","EditableCell","tColumns","cols","unshift","onInnerPageChange","pageInfo","newData","onPageChange","changeParams","pagination","trigger","currentData","formatNode","api","renderInnerNode","condition","extra","innerNode","propsNode","reverse","isColumnController","Object","keys","placement","isBottomController","indexOf","topContent","bottomContent","firstFullRow","lastFullRow","asyncLoading","omit","expandOnRowClick","onRowClick","BaseTable","_mergeProps"],"mappings":"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"}