{"version":3,"file":"thead.js","sources":["../../src/table/thead.tsx"],"sourcesContent":["import { defineComponent, computed, SetupContext, PropType, ref, Ref, h, CSSProperties } from 'vue';\nimport isFunction from 'lodash/isFunction';\nimport { getColumnFixedStyles } from './hooks/useFixed';\nimport useClassName from './hooks/useClassName';\nimport { useConfig } from '../hooks/useConfig';\nimport { BaseTableCol, TableRowData } from './type';\nimport { renderTitle } from './hooks/useTableHeader';\nimport TEllipsis from './ellipsis';\nimport { RowAndColFixedPosition, BaseTableColumns, ThRowspanAndColspan } from './interface';\n\nexport interface TheadProps {\n  // 是否固定表头\n  isFixedHeader: boolean;\n  // 固定列 left/right 具体值\n  rowAndColFixedPosition: RowAndColFixedPosition;\n  // 虚拟滚动单独渲染表头；表头吸顶单独渲染表头\n  thWidthList?: { [colKey: string]: number };\n  bordered: boolean;\n  isMultipleHeader: boolean;\n  spansAndLeafNodes: {\n    rowspanAndColspanMap: ThRowspanAndColspan;\n    leafColumns: BaseTableCol<TableRowData>[];\n  };\n  thList: BaseTableCol<TableRowData>[][];\n  columnResizeParams: {\n    resizeLineRef: Ref<HTMLDivElement>;\n    resizeLineStyle: CSSProperties;\n    onColumnMouseover: (e: MouseEvent) => void;\n    onColumnMousedown: (e: MouseEvent, col: BaseTableCol<TableRowData>) => void;\n  };\n  resizable: Boolean;\n}\n\nexport default defineComponent({\n  name: 'THead',\n\n  props: {\n    isFixedHeader: Boolean,\n    rowAndColFixedPosition: Map as PropType<TheadProps['rowAndColFixedPosition']>,\n    thWidthList: Object as PropType<TheadProps['thWidthList']>,\n    bordered: Boolean,\n    isMultipleHeader: Boolean,\n    resizable: Boolean,\n    spansAndLeafNodes: Object as PropType<TheadProps['spansAndLeafNodes']>,\n    thList: Array as PropType<TheadProps['thList']>,\n    columnResizeParams: Object as PropType<TheadProps['columnResizeParams']>,\n  },\n\n  setup(props: TheadProps, { slots }: SetupContext) {\n    const theadRef = ref<HTMLHeadElement>();\n    const classnames = useClassName();\n    const { tableHeaderClasses, tableBaseClass } = classnames;\n    const { classPrefix } = useConfig();\n    const theadClasses = computed(() => [\n      tableHeaderClasses.header,\n      {\n        [tableHeaderClasses.fixed]: props.isFixedHeader,\n        [tableBaseClass.bordered]: props.bordered && props.isMultipleHeader,\n        [tableHeaderClasses.multipleHeader]: props.isMultipleHeader,\n      },\n    ]);\n\n    return {\n      ...classnames,\n      theadClasses,\n      classPrefix,\n      theadRef,\n      slots,\n    };\n  },\n\n  render() {\n    const renderThNodeList = (\n      rowAndColFixedPosition: RowAndColFixedPosition,\n      thWidthList: TheadProps['thWidthList'],\n    ) => {\n      // thBorderMap: rowspan 会影响 tr > th 是否为第一列表头，从而影响边框\n      const thBorderMap = new Map<any, boolean>();\n      const thRowspanAndColspan = this.spansAndLeafNodes.rowspanAndColspanMap;\n      return this.thList.map((row, rowIndex) => {\n        const thRow = row.map((col: BaseTableColumns[0], index: number) => {\n          const rowspanAndColspan = thRowspanAndColspan.get(col);\n          if (index === 0 && rowspanAndColspan.rowspan > 1) {\n            for (let j = rowIndex + 1; j < rowIndex + rowspanAndColspan.rowspan; j++) {\n              thBorderMap.set(this.thList[j][0], true);\n            }\n          }\n          const thStyles = getColumnFixedStyles(col, index, rowAndColFixedPosition, this.tableColFixedClasses);\n          const colParams = {\n            col,\n            colIndex: index,\n            row: {},\n            rowIndex: -1,\n          };\n          const customClasses = isFunction(col.className) ? col.className({ ...colParams, type: 'th' }) : col.className;\n          const thClasses = [\n            thStyles.classes,\n            customClasses,\n            {\n              // 受 rowspan 影响，部分 tr > th:first-child 需要补足左边框\n              [this.tableHeaderClasses.thBordered]: thBorderMap.get(col),\n              [`${this.classPrefix}-table__th-${col.colKey}`]: col.colKey,\n              [this.tdAlignClasses[col.align]]: col.align && col.align !== 'left',\n            },\n          ];\n          const withoutChildren = !col.children?.length;\n          const width = withoutChildren && thWidthList?.[col.colKey] ? `${thWidthList?.[col.colKey]}px` : undefined;\n          const styles = { ...(thStyles.style || {}), width };\n          const innerTh = renderTitle(this.slots, col, index);\n          const resizeColumnListener = this.resizable\n            ? {\n                onMousedown: (e: MouseEvent) => this.columnResizeParams?.onColumnMousedown?.(e, col),\n                onMousemove: (e: MouseEvent) => this.columnResizeParams?.onColumnMouseover?.(e),\n              }\n            : {};\n          const content = isFunction(col.ellipsisTitle) ? col.ellipsisTitle(h, { col, colIndex: index }) : undefined;\n          return (\n            <th\n              key={col.colKey}\n              data-colkey={col.colKey}\n              class={thClasses}\n              style={styles}\n              {...rowspanAndColspan}\n              {...resizeColumnListener}\n            >\n              <div class={this.tableBaseClass.thCellInner}>\n                {col.ellipsis && col.ellipsisTitle !== false && col.ellipsisTitle !== null ? (\n                  <TEllipsis\n                    placement=\"bottom\"\n                    attach={this.theadRef ? () => this.theadRef : undefined}\n                    tooltipContent={content && (() => content)}\n                    tooltipProps={typeof col.ellipsisTitle === 'object' ? col.ellipsisTitle : undefined}\n                  >\n                    {innerTh}\n                  </TEllipsis>\n                ) : (\n                  innerTh\n                )}\n              </div>\n            </th>\n          );\n        });\n        return <tr key={rowIndex}>{thRow}</tr>;\n      });\n    };\n\n    return (\n      <thead ref=\"theadRef\" class={this.theadClasses}>\n        {renderThNodeList(this.rowAndColFixedPosition, this.thWidthList)}\n      </thead>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","isFixedHeader","Boolean","rowAndColFixedPosition","Map","thWidthList","Object","bordered","isMultipleHeader","resizable","spansAndLeafNodes","thList","Array","columnResizeParams","setup","slots","theadRef","ref","classnames","useClassName","tableHeaderClasses","tableBaseClass","useConfig","classPrefix","theadClasses","computed","header","fixed","_defineProperty","multipleHeader","render","renderThNodeList","thBorderMap","thRowspanAndColspan","rowspanAndColspanMap","map","row","rowIndex","thRow","col","index","rowspanAndColspan","get","rowspan","j","set","thStyles","getColumnFixedStyles","tableColFixedClasses","colParams","colIndex","customClasses","isFunction","className","type","thClasses","classes","thBordered","colKey","tdAlignClasses","align","withoutChildren","children","length","width","styles","style","innerTh","renderTitle","resizeColumnListener","onMousedown","e","onColumnMousedown","onMousemove","onColumnMouseover","content","ellipsisTitle","h","_createVNode","_mergeProps","thCellInner","ellipsis","TEllipsis","_typeof"],"mappings":"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"}