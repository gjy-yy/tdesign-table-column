{"version":3,"file":"ellipsis.js","sources":["../../src/table/ellipsis.tsx"],"sourcesContent":["/** 超出省略显示 */\nimport { defineComponent, PropType, ref, computed } from 'vue';\nimport debounce from 'lodash/debounce';\nimport { TNode } from '../common';\nimport { renderContent } from '../utils/render-tnode';\nimport { isNodeOverflow } from '../utils/dom';\nimport TTooltip, { TooltipProps } from '../tooltip';\nimport { useConfig } from '../hooks/useConfig';\n\nexport interface EllipsisProps {\n  content: string | TNode;\n  default: string | TNode;\n  tooltipContent: string | number | TNode;\n  placement: TooltipProps['placement'];\n  attach: () => HTMLElement;\n  tooltipProps: TooltipProps;\n  zIndex: number;\n}\n\nexport default defineComponent({\n  name: 'TEllipsis',\n\n  props: {\n    /** 内容 */\n    content: {\n      type: [String, Function] as PropType<EllipsisProps['content']>,\n    },\n    /** 内容，同 content */\n    default: {\n      type: [String, Function] as PropType<EllipsisProps['default']>,\n    },\n    /** 内容，同 content，可以单独自定义浮层内容，无需和触发元素保持一致 */\n    tooltipContent: {\n      type: [String, Number, Function] as PropType<EllipsisProps['tooltipContent']>,\n    },\n    /** 浮层位置 */\n    placement: String as PropType<EllipsisProps['placement']>,\n    /** 挂载元素 */\n    attach: Function as PropType<EllipsisProps['attach']>,\n    /** 透传 Tooltip 组件属性 */\n    tooltipProps: Object as PropType<EllipsisProps['tooltipProps']>,\n    zIndex: Number,\n  },\n\n  setup() {\n    const { classPrefix } = useConfig();\n    const root = ref();\n    const isOverflow = ref(false);\n\n    const ellipsisClasses = computed(() => [\n      `${classPrefix.value}-table__ellipsis`,\n      `${classPrefix.value}-text-ellipsis`,\n    ]);\n\n    // 当表格数据量大时，不希望默认渲染全量的 Tooltip，期望在用户 mouseenter 的时候再显示\n    const onTriggerMouseenter = () => {\n      if (!root.value) return;\n      isOverflow.value = isNodeOverflow(root.value);\n    };\n\n    const onTriggerMouseleave = () => {\n      isOverflow.value = isNodeOverflow(root.value);\n    };\n\n    // 使用 debounce 有两个原因：1. 避免 safari/firefox 等浏览器不显示省略浮层；2. 避免省略列快速滚动时，出现一堆的省略浮层\n    const onMouseAround = debounce((e: MouseEvent) => {\n      e.type === 'mouseleave' ? onTriggerMouseleave() : onTriggerMouseenter();\n    }, 80);\n\n    return {\n      root,\n      isOverflow,\n      ellipsisClasses,\n      onMouseAround,\n    };\n  },\n\n  render() {\n    const cellNode = renderContent(this, 'default', 'content');\n    const ellipsisContent = (\n      <div ref=\"root\" class={this.ellipsisClasses} onMouseenter={this.onMouseAround} onMouseleave={this.onMouseAround}>\n        {cellNode}\n      </div>\n    );\n    let content = null;\n    if (this.isOverflow) {\n      const rProps = {\n        content: (this.tooltipContent as string) || (() => cellNode),\n        destroyOnClose: true,\n        zIndex: this.zIndex,\n        attach: this.attach,\n        placement: this.placement,\n        ...(this.tooltipProps as EllipsisProps['tooltipProps']),\n      };\n      content = <TTooltip {...rProps}>{ellipsisContent}</TTooltip>;\n    } else {\n      content = ellipsisContent;\n    }\n    return content;\n  },\n});\n"],"names":["defineComponent","name","props","content","type","String","Function","tooltipContent","Number","placement","attach","tooltipProps","Object","zIndex","setup","useConfig","classPrefix","root","ref","isOverflow","ellipsisClasses","computed","value","onTriggerMouseenter","isNodeOverflow","onTriggerMouseleave","onMouseAround","debounce","e","render","cellNode","renderContent","ellipsisContent","_createVNode","rProps","destroyOnClose"],"mappings":"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"}