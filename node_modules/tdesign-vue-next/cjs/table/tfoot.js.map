{"version":3,"file":"tfoot.js","sources":["../../src/table/tfoot.tsx"],"sourcesContent":["import { SetupContext, h, defineComponent, PropType, toRefs } from 'vue';\nimport isString from 'lodash/isString';\nimport isFunction from 'lodash/isFunction';\nimport get from 'lodash/get';\nimport { BaseTableCellParams, RowspanColspan, TableRowData, TdBaseTableProps } from './type';\nimport { formatRowAttributes, formatRowClassNames } from './utils';\nimport { getColumnFixedStyles } from './hooks/useFixed';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport useRowspanAndColspan, { getCellKey } from './hooks/useRowspanAndColspan';\nimport { RowAndColFixedPosition } from './interface';\nimport useClassName from './hooks/useClassName';\nimport { Styles } from '../common';\n\nexport interface TFootProps {\n  rowKey: string;\n  // 是否固定表头\n  isFixedHeader: boolean;\n  // 固定列 left/right 具体值\n  rowAndColFixedPosition: RowAndColFixedPosition;\n  footData: TdBaseTableProps['footData'];\n  columns: TdBaseTableProps['columns'];\n  rowAttributes: TdBaseTableProps['rowAttributes'];\n  rowClassName: TdBaseTableProps['rowClassName'];\n  // 表尾吸底内容宽度\n  thWidthList?: { [colKey: string]: number };\n  footerSummary?: TdBaseTableProps['footerSummary'];\n  rowspanAndColspanInFooter: TdBaseTableProps['rowspanAndColspanInFooter'];\n}\n\nexport default defineComponent({\n  name: 'TFoot',\n\n  props: {\n    rowKey: String,\n    isFixedHeader: Boolean,\n    rowAndColFixedPosition: Map as PropType<TFootProps['rowAndColFixedPosition']>,\n    footData: Array as PropType<TFootProps['footData']>,\n    columns: Array as PropType<TFootProps['columns']>,\n    rowAttributes: [Array, Object, Function] as PropType<TFootProps['rowAttributes']>,\n    rowClassName: [Array, String, Object, Function] as PropType<TFootProps['rowClassName']>,\n    thWidthList: [Object] as PropType<TFootProps['thWidthList']>,\n    footerSummary: [String, Function] as PropType<TFootProps['footerSummary']>,\n    rowspanAndColspanInFooter: Function as PropType<TFootProps['rowspanAndColspanInFooter']>,\n  },\n\n  // eslint-disable-next-line\n  setup(props: TFootProps, context: SetupContext) {\n    const renderTNode = useTNodeJSX();\n    const classnames = useClassName();\n    const { footData, columns, rowKey, rowspanAndColspanInFooter } = toRefs(props);\n    const { skipSpansMap } = useRowspanAndColspan(footData, columns, rowKey, rowspanAndColspanInFooter);\n    const renderTFootCell = (p: BaseTableCellParams<TableRowData>) => {\n      const { col, row } = p;\n      if (isFunction(col.foot)) {\n        return col.foot(h, p);\n      }\n      if (isString(col.foot) && context.slots[col.foot]) {\n        return context.slots[col.foot](p) || col.foot;\n      }\n      return col.foot || get(row, col.colKey);\n    };\n\n    return {\n      skipSpansMap,\n      ...classnames,\n      renderTFootCell,\n      renderTNode,\n    };\n  },\n\n  render() {\n    if (!this.columns) return null;\n    const theadClasses = [this.tableFooterClasses.footer, { [this.tableFooterClasses.fixed]: this.isFixedHeader }];\n    const footerDomList = this.footData?.map((row, rowIndex) => {\n      const trAttributes = formatRowAttributes(this.rowAttributes, { row, rowIndex, type: 'foot' });\n      // 自定义行类名\n      const customClasses = formatRowClassNames(\n        this.rowClassName,\n        { row, rowIndex, type: 'foot' },\n        this.rowKey || 'id',\n      );\n      return (\n        <tr {...trAttributes} key={rowIndex} class={customClasses}>\n          {this.columns.map((col, colIndex) => {\n            // 合并单元格过滤\n            const cellSpans: RowspanColspan = {};\n            let spanState = null;\n            if (this.skipSpansMap.size) {\n              const cellKey = getCellKey(row, this.rowKey, col.colKey, colIndex);\n              spanState = this.skipSpansMap.get(cellKey) || {};\n              spanState?.rowspan > 1 && (cellSpans.rowspan = spanState.rowspan);\n              spanState?.colspan > 1 && (cellSpans.colspan = spanState.colspan);\n              if (spanState.skipped) return null;\n            }\n            const tdStyles = getColumnFixedStyles(\n              col,\n              colIndex,\n              this.rowAndColFixedPosition,\n              this.tableColFixedClasses,\n            );\n            const style: Styles = { ...tdStyles.style };\n            if (this.thWidthList?.[col.colKey]) {\n              style.width = `${this.thWidthList[col.colKey]}px`;\n            }\n            return (\n              <td {...{ key: col.colKey, ...cellSpans }} class={tdStyles.classes} style={style}>\n                {this.renderTFootCell({\n                  row,\n                  rowIndex,\n                  col,\n                  colIndex,\n                })}\n              </td>\n            );\n          })}\n        </tr>\n      );\n    });\n    const footerSummary = this.renderTNode('footerSummary');\n    // 都不存在，则不需要渲染 footer\n    if (!footerSummary && (!this.footData || !this.footData.length)) return null;\n    return (\n      <tfoot ref=\"tFooterRef\" class={theadClasses}>\n        {footerSummary && (\n          <tr class={this.tableFullRowClasses.base}>\n            <td colspan={this.columns.length}>\n              <div class={this.tableFullRowClasses.innerFullElement}>{footerSummary}</div>\n            </td>\n          </tr>\n        )}\n        {footerDomList}\n      </tfoot>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","rowKey","String","isFixedHeader","Boolean","rowAndColFixedPosition","Map","footData","Array","columns","rowAttributes","Object","Function","rowClassName","thWidthList","footerSummary","rowspanAndColspanInFooter","setup","context","renderTNode","useTNodeJSX","classnames","useClassName","toRefs","useRowspanAndColspan","skipSpansMap","renderTFootCell","p","col","row","isFunction","foot","h","isString","slots","get","colKey","render","theadClasses","tableFooterClasses","footer","_defineProperty","fixed","footerDomList","map","rowIndex","trAttributes","formatRowAttributes","type","customClasses","formatRowClassNames","_createVNode","_mergeProps","colIndex","cellSpans","spanState","size","cellKey","getCellKey","rowspan","colspan","skipped","tdStyles","getColumnFixedStyles","tableColFixedClasses","style","width","key","classes","length","tableFullRowClasses","base","innerFullElement"],"mappings":"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"}