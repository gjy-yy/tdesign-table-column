{"version":3,"file":"dropdown-menu.js","sources":["../../src/dropdown/dropdown-menu.tsx"],"sourcesContent":["import { defineComponent, VNode, inject, ref } from 'vue';\nimport DropdownItem from './dropdown-item';\nimport { DropdownOption, TdDropdownItemProps } from './type';\nimport { TNodeReturnValue } from '../common';\nimport { pxCompat } from '../utils/helper';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { injectKey } from './const';\n\nexport default defineComponent({\n  name: 'TDropdownMenu',\n  props: {\n    options: {\n      type: Array,\n      default: (): [] => [],\n    },\n    maxHeight: {\n      type: Number,\n      default: 300,\n    },\n    maxColumnWidth: {\n      type: Number || String,\n      default: 100,\n    },\n    minColumnWidth: {\n      type: Number || String,\n      default: 10,\n    },\n    onClick: Function,\n  },\n  setup(props, { slots }) {\n    const path = ref('');\n    const renderTNode = useTNodeJSX();\n    const COMPONENT_NAME = usePrefixClass('dropdown__menu');\n\n    const dropdownProvider = inject(injectKey);\n    const { maxHeight, maxColumnWidth, minColumnWidth } = dropdownProvider;\n\n    const handleHoverItem = (p: string) => {\n      path.value = p;\n    };\n\n    const handleItemClick = (\n      data: DropdownOption,\n      context: { e: MouseEvent },\n      onClick: TdDropdownItemProps['onClick'],\n    ) => {\n      onClick?.(data, context);\n      props.onClick?.(data, context);\n    };\n\n    const isActive = (item: DropdownOption, pathPrefix: string, excludeSelf = true): boolean => {\n      const itemPath = `${pathPrefix}/${item.value}`;\n\n      if (excludeSelf && path.value === itemPath) {\n        return false;\n      }\n      return path.value.indexOf(itemPath) === 0;\n    };\n\n    const renderMenuColumn = (children: Array<DropdownOption>, showSubmenu: boolean, pathPrefix: string): VNode => {\n      const menuClass = [`${COMPONENT_NAME.value}-column`, 'narrow-scrollbar', { submenu__visible: showSubmenu }];\n      return (\n        <div\n          class={menuClass}\n          style={{\n            maxHeight: `${maxHeight}px`,\n            maxWidth: pxCompat(maxColumnWidth),\n            minWidth: pxCompat(minColumnWidth),\n          }}\n        >\n          {children.map((item, idx) => {\n            return (\n              <DropdownItem\n                key={idx}\n                disabled={item.disabled}\n                active={isActive(item, pathPrefix) || item.active}\n                value={item.value}\n                content={item.content}\n                divider={item.divider}\n                hasChildren={item.children && item.children.length > 0}\n                path={`${pathPrefix}/${item.value}`}\n                maxColumnWidth={maxColumnWidth}\n                minColumnWidth={minColumnWidth}\n                onHover={handleHoverItem}\n                onClick={(data: DropdownOption, context: { e: MouseEvent }) =>\n                  handleItemClick(data, context, item.onClick)\n                }\n              />\n            );\n          })}\n        </div>\n      );\n    };\n\n    return () => {\n      const columns: TNodeReturnValue[] = [];\n      let menuItems = props.options as DropdownOption[];\n      let pathPrefix = '';\n\n      if (slots.default) {\n        return (\n          <div class={COMPONENT_NAME.value}>\n            <div\n              class={[`${COMPONENT_NAME.value}-column`, 'narrow-scrollbar']}\n              style={{\n                maxHeight: `${maxHeight}px`,\n                maxWidth: `${maxColumnWidth}px`,\n                minWidth: `${minColumnWidth}px`,\n              }}\n            >\n              {renderTNode('default')}\n            </div>\n          </div>\n        );\n      }\n\n      while (menuItems && menuItems.length) {\n        // eslint-disable-next-line no-loop-func\n        const activeItem = menuItems.find((item) => isActive(item, pathPrefix, false));\n\n        columns.push(renderMenuColumn(menuItems, !!activeItem, pathPrefix));\n\n        if (activeItem) {\n          pathPrefix = `${pathPrefix}/${activeItem.value}`;\n          menuItems = activeItem.children || [];\n        } else {\n          menuItems = [];\n        }\n      }\n\n      return <div class={COMPONENT_NAME.value}>{columns}</div>;\n    };\n  },\n});\n"],"names":["defineComponent","name","props","options","type","Array","maxHeight","Number","maxColumnWidth","String","minColumnWidth","onClick","Function","setup","slots","path","ref","renderTNode","useTNodeJSX","COMPONENT_NAME","usePrefixClass","dropdownProvider","inject","injectKey","handleHoverItem","p","value","handleItemClick","data","context","isActive","item","pathPrefix","excludeSelf","itemPath","indexOf","renderMenuColumn","children","showSubmenu","menuClass","submenu__visible","_createVNode","maxWidth","pxCompat","minWidth","map","idx","DropdownItem","disabled","active","content","divider","length","columns","menuItems","activeItem","find","push"],"mappings":"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"}