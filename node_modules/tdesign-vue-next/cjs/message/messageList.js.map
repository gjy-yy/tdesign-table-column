{"version":3,"file":"messageList.js","sources":["../../src/message/messageList.tsx"],"sourcesContent":["import { computed, defineComponent, ref } from 'vue';\nimport { PLACEMENT_OFFSET } from './const';\nimport TMessage from './message';\nimport { MessageOptions } from './type';\nimport { usePrefixClass } from '../hooks/useConfig';\n\nexport const DEFAULT_Z_INDEX = 6000;\n\nconst getUniqueId = (() => {\n  let id = 0;\n  return () => {\n    id += 1;\n    return id;\n  };\n})();\n\nexport const MessageList = defineComponent({\n  name: 'TMessageList',\n  props: {\n    zIndex: {\n      type: Number,\n      default: 0,\n    },\n    placement: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props, { expose }) {\n    const COMPONENT_NAME = usePrefixClass('message__list');\n    const list = ref([]);\n    const messageList = ref([]);\n\n    const styles = computed(() => ({\n      ...PLACEMENT_OFFSET[props.placement],\n      zIndex: props.zIndex !== DEFAULT_Z_INDEX ? props.zIndex : DEFAULT_Z_INDEX,\n    }));\n\n    const add = (msg: MessageOptions): number => {\n      const mg = { ...msg, key: getUniqueId() };\n      list.value.push(mg);\n      return list.value.length - 1;\n    };\n\n    const remove = (index: number) => {\n      list.value.splice(index, 1);\n    };\n\n    const removeAll = () => {\n      list.value = [];\n    };\n\n    const getOffset = (val: string | number) => {\n      if (!val) return;\n      return isNaN(Number(val)) ? val : `${val}px`;\n    };\n\n    const msgStyles = (item: { offset: Array<string | number> }) => {\n      return (\n        item.offset && {\n          position: 'relative',\n          left: getOffset(item.offset[0]),\n          top: getOffset(item.offset[1]),\n        }\n      );\n    };\n\n    const getProps = (index: number, item: MessageOptions) => {\n      return {\n        ...item,\n        onCloseBtnClick: (e: any) => {\n          if (item.onCloseBtnClick) {\n            item.onCloseBtnClick(e);\n          }\n          return remove(index);\n        },\n        onDurationEnd: () => {\n          if (item.onDurationEnd) {\n            item.onDurationEnd();\n          }\n          return remove(index);\n        },\n      };\n    };\n\n    const addChild = (el: Element) => {\n      if (el) {\n        messageList.value.push(el);\n      }\n    };\n\n    expose({ add, removeAll, list, messageList });\n\n    return () => {\n      if (!list.value.length) return;\n\n      return (\n        <div class={COMPONENT_NAME.value} style={styles.value}>\n          {list.value.map((item, index) => (\n            <TMessage key={item.key} style={msgStyles(item)} ref={addChild} {...getProps(index, item)} />\n          ))}\n        </div>\n      );\n    };\n  },\n});\n\nexport default MessageList;\n"],"names":["DEFAULT_Z_INDEX","getUniqueId","id","MessageList","defineComponent","name","props","zIndex","type","Number","placement","String","setup","expose","COMPONENT_NAME","usePrefixClass","list","ref","messageList","styles","computed","PLACEMENT_OFFSET","add","msg","mg","key","value","push","length","remove","index","splice","removeAll","getOffset","val","isNaN","msgStyles","item","offset","position","left","top","getProps","onCloseBtnClick","e","onDurationEnd","addChild","el","_createVNode","map","TMessage","_mergeProps"],"mappings":"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"}