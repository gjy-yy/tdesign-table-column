{"version":3,"file":"plugin.js","sources":["../../src/notification/plugin.ts"],"sourcesContent":["import { App, Plugin, createApp, nextTick, ComponentPublicInstance } from 'vue';\nimport NotificationList from './notificationList';\nimport { getAttach } from '../utils/dom';\nimport {\n  NotificationOptions,\n  NotificationInstance,\n  NotificationMethod,\n  NotificationInfoMethod,\n  NotificationWarningMethod,\n  NotificationErrorMethod,\n  NotificationSuccessMethod,\n  NotificationCloseMethod,\n  NotificationCloseAllMethod,\n} from './type';\nimport { AttachNodeReturnValue } from '../common';\n\nlet seed = 0;\n// 存储不同 attach 和 不同 placement 消息列表实例\nconst instanceMap: Map<AttachNodeReturnValue, Record<string, ComponentPublicInstance>> = new Map();\n\nconst NotificationFunction = (options: NotificationOptions): Promise<NotificationInstance> => {\n  seed += 1;\n  const hackOptions = {\n    placement: 'top-right',\n    zIndex: 6000,\n    attach: 'body',\n    id: seed,\n    ...options,\n  };\n  hackOptions.content = options.content ? options.content : '';\n\n  const attachEl = getAttach(hackOptions.attach);\n\n  if (!instanceMap.get(attachEl)) {\n    instanceMap.set(attachEl, {});\n  }\n  let tmpInstance = instanceMap.get(attachEl)[hackOptions.placement];\n  if (!tmpInstance) {\n    const wrapper = document.createElement('div');\n\n    const instance = createApp(NotificationList, {\n      placement: hackOptions.placement,\n    }).mount(wrapper);\n\n    instance.add(hackOptions);\n    instanceMap.get(attachEl)[hackOptions.placement] = instance;\n    tmpInstance = instance;\n    attachEl.appendChild(instance.$el);\n  } else {\n    tmpInstance.add(hackOptions);\n  }\n\n  return new Promise((resolve) => {\n    const ins = instanceMap.get(attachEl)[hackOptions.placement];\n    nextTick(() => {\n      const { notificationList } = ins;\n      resolve(notificationList[notificationList.length - 1]);\n    });\n  });\n};\n\nconst showThemeNotification: NotificationMethod = (theme, options) => {\n  const hackOptions = { ...options, theme };\n  return NotificationFunction(hackOptions);\n};\n\ninterface ExtraApi {\n  info: NotificationInfoMethod;\n  success: NotificationSuccessMethod;\n  warning: NotificationWarningMethod;\n  error: NotificationErrorMethod;\n  close: NotificationCloseMethod;\n  closeAll: NotificationCloseAllMethod;\n}\n\nconst extraApi: ExtraApi = {\n  info: (options) => showThemeNotification('info', options),\n  success: (options) => showThemeNotification('success', options),\n  warning: (options) => showThemeNotification('warning', options),\n  error: (options) => showThemeNotification('error', options),\n  close: (promise) => {\n    promise.then((instance) => instance.close());\n  },\n  closeAll: () => {\n    instanceMap.forEach((attach) => {\n      Object.keys(attach).forEach((placement) => {\n        attach[placement].removeAll();\n      });\n    });\n  },\n};\nexport type NotificationPluginType = Plugin & ExtraApi & NotificationMethod;\n\nconst NotificationPlugin: NotificationPluginType = showThemeNotification as NotificationPluginType;\n\nNotificationPlugin.install = (app: App) => {\n  app.config.globalProperties.$notify = showThemeNotification;\n  Object.keys(extraApi).forEach((funcName) => {\n    app.config.globalProperties.$notify[funcName] = extraApi[funcName];\n  });\n};\n\nObject.keys(extraApi).forEach((funcName) => {\n  NotificationPlugin[funcName] = extraApi[funcName];\n});\n\nexport default NotificationPlugin;\n"],"names":["seed","instanceMap","Map","NotificationFunction","options","hackOptions","placement","zIndex","attach","id","content","attachEl","getAttach","get","set","tmpInstance","wrapper","document","createElement","instance","createApp","NotificationList","mount","add","appendChild","$el","Promise","resolve","ins","nextTick","notificationList","length","showThemeNotification","theme","extraApi","info","success","warning","error","close","promise","then","closeAll","forEach","Object","keys","removeAll","NotificationPlugin","install","app","config","globalProperties","$notify","funcName"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgBA,IAAIA,IAAO,GAAA,CAAX,CAAA;AAEA,IAAMC,WAAA,sBAAuFC,KAA7F,CAAA;;AAEA,IAAMC,oBAAA,GAAuB,SAAvBA,oBAAuB,CAACC,OAAD,EAAiE;AACpFJ,EAAAA,IAAA,IAAA,CAAA,CAAA;;AACR,EAAA,IAAMK,WAAc,GAAA,aAAA,CAAA;AAClBC,IAAAA,SAAW,EAAA,WADO;AAElBC,IAAAA,MAAQ,EAAA,GAFU;AAGlBC,IAAAA,MAAQ,EAAA,MAHU;AAIlBC,IAAAA,EAAI,EAAAT,IAAAA;AAJc,GAAA,EAKfI,OALe,CAApB,CAAA;;EAOAC,WAAA,CAAYK,OAAZ,GAAsBN,OAAA,CAAQM,OAAR,GAAkBN,OAAA,CAAQM,OAA1B,GAAoC,EAA1D,CAAA;AAEM,EAAA,IAAAC,QAAA,GAAWC,SAAU,CAAAP,WAAA,CAAYG,MAAZ,CAArB,CAAA;;AAEN,EAAA,IAAI,CAACP,WAAA,CAAYY,GAAZ,CAAgBF,QAAhB,CAAL,EAAgC;AAClBV,IAAAA,WAAA,CAAAa,GAAA,CAAIH,QAAJ,EAAc,EAAd,CAAA,CAAA;AACd,GAAA;;EACA,IAAII,WAAc,GAAAd,WAAA,CAAYY,GAAZ,CAAgBF,QAAhB,CAA0BN,CAAAA,WAAY,CAAAC,SAAtC,CAAlB,CAAA;;EACA,IAAI,CAACS,WAAL,EAAkB;AACV,IAAA,IAAAC,OAAA,GAAUC,QAAS,CAAAC,aAAT,CAAuB,KAAvB,CAAV,CAAA;AAEA,IAAA,IAAAC,QAAA,GAAWC,UAAUC,kBAAkB;MAC3Cf,WAAWD,WAAY,CAAAC,SAAAA;AADoB,MAA5B,CAEdgB,KAFc,CAERN,OAFQ,CAAX,CAAA;IAING,QAAA,CAASI,GAAT,CAAalB,WAAb,CAAA,CAAA;IACAJ,WAAA,CAAYY,GAAZ,CAAgBF,QAAhB,EAA0BN,WAAA,CAAYC,SAAtC,CAAA,GAAmDa,QAAnD,CAAA;AACcJ,IAAAA,WAAA,GAAAI,QAAA,CAAA;AACLR,IAAAA,QAAA,CAAAa,WAAA,CAAYL,SAASM,GAArB,CAAA,CAAA;AACJ,GAXP,MAWO;IACLV,WAAA,CAAYQ,GAAZ,CAAgBlB,WAAhB,CAAA,CAAA;AACF,GAAA;;AAEO,EAAA,OAAA,IAAIqB,OAAJ,CAAY,UAACC,OAAD,EAAa;IAC9B,IAAMC,GAAM,GAAA3B,WAAA,CAAYY,GAAZ,CAAgBF,QAAhB,CAA0BN,CAAAA,WAAY,CAAAC,SAAtC,CAAZ,CAAA;AACAuB,IAAAA,QAAA,CAAS,YAAM;AACP,MAAA,IAAEC,gBAAF,GAAuBF,GAAvB,CAAEE,gBAAF,CAAA;MACEH,OAAA,CAAAG,gBAAA,CAAiBA,gBAAiB,CAAAC,MAAjB,GAA0B,CAA3C,CAAA,CAAA,CAAA;AACT,KAHD,CAAA,CAAA;AAID,GANM,CAAA,CAAA;AAOT,CAvCA,CAAA;;AAyCA,IAAMC,qBAAA,GAA4C,SAA5CA,qBAA4C,CAACC,KAAD,EAAQ7B,OAAR,EAAoB;EACpE,IAAMC,WAAc,mCAAKD,OAAL,CAAA,EAAA,EAAA,EAAA;AAAc6B,IAAAA,KAAM,EAANA,KAAAA;GAAlC,CAAA,CAAA;;EACA,OAAO9B,qBAAqBE,YAA5B,CAAA;AACF,CAHA,CAAA;;AAcA,IAAM6B,QAAqB,GAAA;EACzBC,IAAM,EAAA,cAAC/B,OAAD,EAAA;AAAA,IAAA,OAAa4B,qBAAA,CAAsB,MAAtB,EAA8B5B,OAA9B,CAAb,CAAA;GADmB;EAEzBgC,OAAS,EAAA,iBAAChC,OAAD,EAAA;AAAA,IAAA,OAAa4B,qBAAA,CAAsB,SAAtB,EAAiC5B,OAAjC,CAAb,CAAA;GAFgB;EAGzBiC,OAAS,EAAA,iBAACjC,OAAD,EAAA;AAAA,IAAA,OAAa4B,qBAAA,CAAsB,SAAtB,EAAiC5B,OAAjC,CAAb,CAAA;GAHgB;EAIzBkC,KAAO,EAAA,eAAClC,OAAD,EAAA;AAAA,IAAA,OAAa4B,qBAAA,CAAsB,OAAtB,EAA+B5B,OAA/B,CAAb,CAAA;GAJkB;EAKzBmC,KAAA,EAAO,SAACC,KAAAA,CAAAA,OAAD,EAAa;AAClBA,IAAAA,OAAA,CAAQC,IAAR,CAAa,UAACtB,QAAD,EAAA;MAAA,OAAcA,QAAA,CAASoB,KAAT,EAAd,CAAA;KAAb,CAAA,CAAA;GANuB;AAQzBG,EAAAA,UAAU,SAAM,QAAA,GAAA;AACFzC,IAAAA,WAAA,CAAA0C,OAAA,CAAQ,UAACnC,MAAD,EAAY;MAC9BoC,MAAA,CAAOC,IAAP,CAAYrC,MAAZ,EAAoBmC,OAApB,CAA4B,UAACrC,SAAD,EAAe;AACzCE,QAAAA,MAAA,CAAOF,SAAP,CAAA,CAAkBwC,SAAlB,EAAA,CAAA;OADF,CAAA,CAAA;KADU,CAAA,CAAA;AAKd,GAAA;AAdyB,CAA3B,CAAA;AAkBMC,IAAAA,kBAA6C,GAAAf,sBAAnD;;AAEAe,kBAAmB,CAAAC,OAAnB,GAA6B,UAACC,GAAD,EAAc;AACrCA,EAAAA,GAAA,CAAAC,MAAA,CAAOC,gBAAP,CAAwBC,OAAxB,GAAkCpB,qBAAlC,CAAA;EACJY,MAAA,CAAOC,IAAP,CAAYX,QAAZ,EAAsBS,OAAtB,CAA8B,UAACU,QAAD,EAAc;AAC1CJ,IAAAA,GAAA,CAAIC,MAAJ,CAAWC,gBAAX,CAA4BC,OAA5B,CAAoCC,QAApC,CAAgDnB,GAAAA,QAAS,CAAAmB,QAAA,CAAzD,CAAA;GADF,CAAA,CAAA;AAGF,CALA,CAAA;;AAOAT,MAAA,CAAOC,IAAP,CAAYX,QAAZ,EAAsBS,OAAtB,CAA8B,UAACU,QAAD,EAAc;AAC1CN,EAAAA,kBAAA,CAAmBM,QAAnB,CAAA,GAA+BnB,QAAS,CAAAmB,QAAA,CAAxC,CAAA;AACD,CAFD,CAAA;;;;"}