{"version":3,"file":"plugin.js","sources":["../../src/dialog/plugin.tsx"],"sourcesContent":["import { App, createApp, ref, Plugin, defineComponent, h, onMounted } from 'vue';\nimport DialogComponent from './dialog';\nimport { getAttach } from '../utils/dom';\nimport { DialogOptions, DialogMethod, DialogConfirmMethod, DialogAlertMethod, DialogInstance } from './type';\n\nconst createDialog: DialogMethod = (props: DialogOptions) => {\n  const options = { ...props };\n  const wrapper = document.createElement('div');\n  const visible = ref(false);\n  const { className } = options;\n  const component = defineComponent({\n    setup(props, { expose }) {\n      const dialogOptions = ref<Record<string, any>>(options);\n      onMounted(() => {\n        visible.value = true;\n        // 处理 https://github.com/Tencent/tdesign-vue-next/issues/394\n        (document.activeElement as HTMLElement).blur();\n      });\n      const update = (newOptions: DialogOptions) => {\n        dialogOptions.value = {\n          ...options,\n          ...newOptions,\n        };\n      };\n\n      expose({\n        update,\n      });\n\n      return () => {\n        const onClose =\n          options.onClose ||\n          function () {\n            visible.value = false;\n          };\n        delete options.className;\n        return h(DialogComponent, {\n          onClose,\n          visible: visible.value,\n          ...dialogOptions.value,\n        });\n      };\n    },\n  });\n  const dialog = createApp(component).mount(wrapper);\n\n  if (className) {\n    className.split(' ').forEach((name) => {\n      dialog.$el.classList.add(name.trim());\n    });\n  }\n  if (options.style) {\n    (dialog.$el as HTMLElement).style.cssText += options.style;\n  }\n\n  const container = getAttach(options.attach);\n  if (container) {\n    container.appendChild(wrapper);\n  } else {\n    console.error('attach is not exist');\n  }\n\n  const dialogNode: DialogInstance = {\n    show: () => {\n      visible.value = true;\n    },\n    hide: () => {\n      visible.value = false;\n    },\n    update: (newOptions: DialogOptions) => {\n      dialog.update(newOptions);\n    },\n    destroy: () => {\n      visible.value = false;\n      setTimeout(() => {\n        wrapper.parentNode.removeChild(wrapper);\n      }, 300);\n    },\n  };\n  return dialogNode;\n};\ninterface ExtraApi {\n  confirm: DialogConfirmMethod;\n  alert: DialogAlertMethod;\n}\n\nconst confirm: DialogConfirmMethod = (props: DialogOptions) => createDialog(props);\n\nconst alert: DialogAlertMethod = (props: Omit<DialogOptions, 'confirmBtn'>) => {\n  const options = { ...props };\n  options.cancelBtn = null;\n  return createDialog(options);\n};\n\nconst extraApi: ExtraApi = {\n  confirm,\n  alert,\n};\n\nexport type DialogPluginType = Plugin & ExtraApi & DialogAlertMethod;\n\nexport const DialogPlugin: DialogPluginType = createDialog as DialogPluginType;\n\nDialogPlugin.install = (app: App): void => {\n  app.config.globalProperties.$dialog = createDialog;\n  Object.keys(extraApi).forEach((funcName) => {\n    app.config.globalProperties.$dialog[funcName] = extraApi[funcName];\n  });\n};\n\nObject.keys(extraApi).forEach((funcName) => {\n  DialogPlugin[funcName] = extraApi[funcName];\n});\n\nexport default DialogPlugin;\n"],"names":["createDialog","props","options","wrapper","document","createElement","visible","ref","className","component","defineComponent","setup","expose","dialogOptions","onMounted","value","activeElement","blur","update","newOptions","onClose","h","DialogComponent","dialog","createApp","mount","split","forEach","name","$el","classList","add","trim","style","cssText","container","getAttach","attach","appendChild","console","error","dialogNode","show","hide","destroy","setTimeout","parentNode","removeChild","confirm","alert","cancelBtn","extraApi","DialogPlugin","install","app","config","globalProperties","$dialog","Object","keys","funcName"],"mappings":"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"}