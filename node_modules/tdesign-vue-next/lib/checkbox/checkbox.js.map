{"version":3,"file":"checkbox.js","sources":["../../src/checkbox/checkbox.tsx"],"sourcesContent":["import { defineComponent, ref, toRefs, computed, inject } from 'vue';\nimport props from './props';\nimport useVModel from '../hooks/useVModel';\nimport { useFormDisabled } from '../form/hooks';\nimport useRipple from '../hooks/useRipple';\nimport { useContent } from '../hooks/tnode';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { CheckboxGroupInjectionKey } from './constants';\n\nexport default defineComponent({\n  name: 'TCheckbox',\n  props: {\n    ...props,\n    needRipple: Boolean,\n    stopLabelTrigger: Boolean,\n  },\n\n  setup(props) {\n    const labelRef = ref<HTMLElement>();\n    if (props.needRipple) {\n      useRipple(labelRef);\n    }\n\n    const { checked, modelValue } = toRefs(props);\n    const [innerChecked, setInnerChecked] = useVModel(\n      checked,\n      modelValue,\n      props.defaultChecked,\n      props.onChange,\n      'checked',\n    );\n\n    const checkboxGroup = inject(CheckboxGroupInjectionKey, undefined);\n    const GroupDisabled = computed(() => {\n      return props.disabled || !!checkboxGroup?.disabled;\n    });\n    const formDisabled = useFormDisabled(GroupDisabled);\n\n    const name = computed<string>(() => props.name || checkboxGroup?.name);\n\n    const selfChecked = computed<boolean>(() => {\n      if (props.checkAll) return checkboxGroup?.isCheckAll;\n      return checkboxGroup ? !!checkboxGroup.checkedMap[props.value] : innerChecked.value;\n    });\n\n    const disabled = computed<boolean>(() => {\n      if (formDisabled) return formDisabled.value;\n      if (!props.checkAll && !selfChecked.value && checkboxGroup?.maxExceeded) {\n        return true;\n      }\n      if (props.disabled !== undefined) return props.disabled;\n      return !!checkboxGroup?.disabled;\n    });\n\n    const selfIndeterminate = computed<boolean>(() => {\n      if (props.checkAll) return checkboxGroup?.indeterminate;\n      return props.indeterminate;\n    });\n\n    /** 样式计算相关逻辑 */\n    const classPrefix = usePrefixClass();\n    const COMPONENT_NAME = usePrefixClass('checkbox');\n    const labelClasses = computed(() => [\n      `${COMPONENT_NAME.value}`,\n      {\n        [`${classPrefix.value}-is-checked`]: selfChecked.value,\n        [`${classPrefix.value}-is-disabled`]: disabled.value,\n        [`${classPrefix.value}-is-indeterminate`]: selfIndeterminate.value,\n      },\n    ]);\n\n    // methods\n    const handleChange = (e: Event) => {\n      const checked = !selfChecked.value;\n      setInnerChecked(checked, { e });\n      if (checkboxGroup && checkboxGroup.handleCheckboxChange) {\n        checkboxGroup.onCheckedChange({ checked, checkAll: props.checkAll, e, option: props });\n      }\n    };\n\n    const renderContent = useContent();\n\n    const handleLabelClick = (e: MouseEvent) => {\n      // 在tree等组件中使用  阻止label触发checked 与expand冲突\n      if (props.stopLabelTrigger) e.preventDefault();\n    };\n\n    return () => (\n      <label class={labelClasses.value} ref=\"labelRef\">\n        <input\n          type=\"checkbox\"\n          class={`${COMPONENT_NAME.value}__former`}\n          disabled={disabled.value}\n          readonly={props.readonly}\n          indeterminate={props.indeterminate}\n          name={name.value}\n          value={props.value}\n          checked={selfChecked.value}\n          onChange={handleChange}\n        ></input>\n        <span class={`${COMPONENT_NAME.value}__input`}></span>\n        <span class={`${COMPONENT_NAME.value}__label`} onClick={handleLabelClick}>\n          {renderContent('default', 'label')}\n        </span>\n      </label>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","needRipple","Boolean","stopLabelTrigger","setup","labelRef","ref","useRipple","toRefs","checked","modelValue","useVModel","defaultChecked","onChange","innerChecked","setInnerChecked","checkboxGroup","inject","CheckboxGroupInjectionKey","GroupDisabled","computed","disabled","formDisabled","useFormDisabled","selfChecked","checkAll","isCheckAll","checkedMap","value","maxExceeded","selfIndeterminate","indeterminate","classPrefix","usePrefixClass","COMPONENT_NAME","labelClasses","handleChange","e","handleCheckboxChange","onCheckedChange","option","renderContent","useContent","handleLabelClick","preventDefault","_createVNode","readonly"],"mappings":"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"}