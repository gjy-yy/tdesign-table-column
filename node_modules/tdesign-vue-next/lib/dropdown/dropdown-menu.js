/**
 * tdesign v0.21.1
 * (c) 2022 tdesign
 * @license MIT
 */

import { defineComponent, ref, inject, createVNode } from 'vue';
import _DropdownItem from './dropdown-item.js';
import { pxCompat } from '../utils/helper.js';
import { usePrefixClass } from '../hooks/useConfig.js';
import { useTNodeJSX } from '../hooks/tnode.js';
import { injectKey } from './const.js';
import '@babel/runtime/helpers/defineProperty';
import 'tdesign-icons-vue-next';
import '../divider/index.js';
import '../divider/divider.js';
import '../divider/props.js';
import '../config-provider/useConfig.js';
import '../config-provider/context.js';
import 'lodash/mergeWith';
import 'lodash/merge';
import '../_common/js/global-config/default-config.js';
import '../_common/js/global-config/locale/zh_CN.js';
import 'lodash/isEmpty';
import 'lodash/isFunction';
import 'lodash/camelCase';
import 'lodash/kebabCase';
import '../utils/render-tnode.js';
import 'lodash/isString';
import 'lodash/isObject';
import '../utils/withInstall.js';
import './dropdown-item-props.js';
import '../hooks/useRipple.js';
import '../hooks/useKeepAnimation.js';
import '../utils/set-style.js';
import '../hooks/useGlobalIcon.js';
import '@babel/runtime/helpers/objectWithoutProperties';
import '@babel/runtime/helpers/slicedToArray';

var _DropdownMenu = defineComponent({
  name: "TDropdownMenu",
  props: {
    options: {
      type: Array,
      "default": function _default() {
        return [];
      }
    },
    maxHeight: {
      type: Number,
      "default": 300
    },
    maxColumnWidth: {
      type: Number || String,
      "default": 100
    },
    minColumnWidth: {
      type: Number || String,
      "default": 10
    },
    onClick: Function
  },
  setup: function setup(props, _ref) {
    var slots = _ref.slots;
    var path = ref("");
    var renderTNode = useTNodeJSX();
    var COMPONENT_NAME = usePrefixClass("dropdown__menu");
    var dropdownProvider = inject(injectKey);
    var maxHeight = dropdownProvider.maxHeight,
        maxColumnWidth = dropdownProvider.maxColumnWidth,
        minColumnWidth = dropdownProvider.minColumnWidth;

    var handleHoverItem = function handleHoverItem(p) {
      path.value = p;
    };

    var handleItemClick = function handleItemClick(data, context, onClick) {
      var _props$onClick;

      onClick === null || onClick === void 0 ? void 0 : onClick(data, context);
      (_props$onClick = props.onClick) === null || _props$onClick === void 0 ? void 0 : _props$onClick.call(props, data, context);
    };

    var isActive = function isActive(item, pathPrefix) {
      var excludeSelf = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;
      var itemPath = "".concat(pathPrefix, "/").concat(item.value);

      if (excludeSelf && path.value === itemPath) {
        return false;
      }

      return path.value.indexOf(itemPath) === 0;
    };

    var renderMenuColumn = function renderMenuColumn(children, showSubmenu, pathPrefix) {
      var menuClass = ["".concat(COMPONENT_NAME.value, "-column"), "narrow-scrollbar", {
        submenu__visible: showSubmenu
      }];
      return createVNode("div", {
        "class": menuClass,
        "style": {
          maxHeight: "".concat(maxHeight, "px"),
          maxWidth: pxCompat(maxColumnWidth),
          minWidth: pxCompat(minColumnWidth)
        }
      }, [children.map(function (item, idx) {
        return createVNode(_DropdownItem, {
          "key": idx,
          "disabled": item.disabled,
          "active": isActive(item, pathPrefix) || item.active,
          "value": item.value,
          "content": item.content,
          "divider": item.divider,
          "hasChildren": item.children && item.children.length > 0,
          "path": "".concat(pathPrefix, "/").concat(item.value),
          "maxColumnWidth": maxColumnWidth,
          "minColumnWidth": minColumnWidth,
          "onHover": handleHoverItem,
          "onClick": function onClick(data, context) {
            return handleItemClick(data, context, item.onClick);
          }
        }, null);
      })]);
    };

    return function () {
      var columns = [];
      var menuItems = props.options;
      var pathPrefix = "";

      if (slots["default"]) {
        return createVNode("div", {
          "class": COMPONENT_NAME.value
        }, [createVNode("div", {
          "class": ["".concat(COMPONENT_NAME.value, "-column"), "narrow-scrollbar"],
          "style": {
            maxHeight: "".concat(maxHeight, "px"),
            maxWidth: "".concat(maxColumnWidth, "px"),
            minWidth: "".concat(minColumnWidth, "px")
          }
        }, [renderTNode("default")])]);
      }

      while (menuItems && menuItems.length) {
        var activeItem = menuItems.find(function (item) {
          return isActive(item, pathPrefix, false);
        });
        columns.push(renderMenuColumn(menuItems, !!activeItem, pathPrefix));

        if (activeItem) {
          pathPrefix = "".concat(pathPrefix, "/").concat(activeItem.value);
          menuItems = activeItem.children || [];
        } else {
          menuItems = [];
        }
      }

      return createVNode("div", {
        "class": COMPONENT_NAME.value
      }, [columns]);
    };
  }
});

export { _DropdownMenu as default };
//# sourceMappingURL=dropdown-menu.js.map
