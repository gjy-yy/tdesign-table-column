{"version":3,"file":"alert.js","sources":["../../src/alert/alert.tsx"],"sourcesContent":["import { defineComponent, VNode, ref, onMounted, onBeforeUnmount } from 'vue';\nimport {\n  CheckCircleFilledIcon as TdCheckCircleFilledIcon,\n  CloseIcon as TdCloseIcon,\n  ErrorCircleFilledIcon as TdErrorCircleFilledIcon,\n  HelpCircleFilledIcon as TdHelpCircleFilledIcon,\n  InfoCircleFilledIcon as TdInfoCircleFilledIcon,\n} from 'tdesign-icons-vue-next';\n\nimport { on, off, addClass } from '../utils/dom';\nimport props from './props';\nimport { SlotReturnValue } from '../common';\nimport { useIcon } from '../hooks/icon';\nimport { useGlobalIcon } from '../hooks/useGlobalIcon';\nimport { useConfig, usePrefixClass } from '../hooks/useConfig';\n\nimport { useTNodeJSX } from '../hooks/tnode';\n\nexport default defineComponent({\n  name: 'TAlert',\n  props,\n  setup(props) {\n    const { globalConfig, classPrefix } = useConfig('alert');\n    const { CheckCircleFilledIcon, CloseIcon, ErrorCircleFilledIcon, HelpCircleFilledIcon, InfoCircleFilledIcon } =\n      useGlobalIcon({\n        CheckCircleFilledIcon: TdCheckCircleFilledIcon,\n        CloseIcon: TdCloseIcon,\n        ErrorCircleFilledIcon: TdErrorCircleFilledIcon,\n        HelpCircleFilledIcon: TdHelpCircleFilledIcon,\n        InfoCircleFilledIcon: TdInfoCircleFilledIcon,\n      });\n    const COMPONENT_NAME = usePrefixClass('alert');\n    const renderTNodeJSX = useTNodeJSX();\n\n    const renderIconTNode = useIcon();\n    // alert的dom引用\n    const alertRef = ref<HTMLElement | null>(null);\n    // description的dom引用\n    const descriptionRef = ref<HTMLElement | null>(null);\n    // desc高度\n    const descHeight = ref(0);\n    // 是否可见，关闭后置为false\n    const visible = ref(true);\n    // 是否已收起，使用折叠功能时有效，用于表示是否已折叠；默认折叠\n    const collapsed = ref(true);\n\n    const renderIcon = () => {\n      const Component = {\n        info: InfoCircleFilledIcon,\n        success: CheckCircleFilledIcon,\n        warning: ErrorCircleFilledIcon,\n        error: ErrorCircleFilledIcon,\n        question: HelpCircleFilledIcon,\n      };\n      const iconContent = renderIconTNode('icon', Component);\n      return iconContent ? <div class={`${COMPONENT_NAME.value}__icon`}>{iconContent}</div> : null;\n    };\n\n    const renderClose = () => {\n      const { close } = props;\n      let closeContent = null;\n      if (close === true || close === '') {\n        closeContent = <CloseIcon />;\n      } else if (typeof close === 'string') {\n        closeContent = close;\n      } else {\n        closeContent = renderIconTNode('close');\n      }\n      return closeContent ? (\n        <div class={`${COMPONENT_NAME.value}__close`} onClick={handleClose}>\n          {closeContent}\n        </div>\n      ) : null;\n    };\n\n    const renderTitle = () => {\n      const titleContent = renderTNodeJSX('title');\n      return titleContent ? <div class={`${COMPONENT_NAME.value}__title`}> {titleContent}</div> : null;\n    };\n\n    const renderMessage = () => {\n      const operationContent = renderTNodeJSX('operation');\n      return (\n        <div class={`${COMPONENT_NAME.value}__message`}>\n          {renderDescription()}\n          {operationContent ? <div class={`${COMPONENT_NAME.value}__operation`}>{operationContent}</div> : null}\n        </div>\n      );\n    };\n\n    const renderDescription = () => {\n      let messageContent;\n\n      messageContent = renderTNodeJSX('default');\n      if (!messageContent) {\n        messageContent = renderTNodeJSX('message');\n      }\n      const contentLength = Array.isArray(messageContent) ? (messageContent as Array<SlotReturnValue>).length : 1;\n      const hasCollapse = props.maxLine > 0 && props.maxLine < contentLength;\n      const height = (descriptionRef.value?.children[0] as HTMLElement)?.offsetHeight;\n      if (hasCollapse && collapsed.value) {\n        // 折叠\n        messageContent = (messageContent as Array<SlotReturnValue>).slice(0, props.maxLine as number);\n        height && (descriptionRef.value.style.height = `${descHeight.value}px`);\n      } else if (hasCollapse) {\n        // 展开\n        height &&\n          (descriptionRef.value.style.height = `${height * (contentLength - props.maxLine) + descHeight.value}px`);\n      }\n\n      // 如果需要折叠，则元素之间补<br/>；否则不补\n      return (\n        <div class={`${COMPONENT_NAME.value}__description`} ref={descriptionRef}>\n          {hasCollapse\n            ? (messageContent as Array<string | VNode>).map((content) => <div>{content}</div>)\n            : messageContent}\n          {hasCollapse ? (\n            <div\n              class={`${COMPONENT_NAME.value}__collapse`}\n              onClick={() => {\n                collapsed.value = !collapsed.value;\n              }}\n            >\n              {collapsed.value ? globalConfig.value.expandText : globalConfig.value.collapseText}\n            </div>\n          ) : null}\n        </div>\n      );\n    };\n    const renderContent = () => {\n      return (\n        <div class={`${COMPONENT_NAME.value}__content`}>\n          {renderTitle()}\n          {renderMessage()}\n        </div>\n      );\n    };\n    const handleClose = (e: MouseEvent) => {\n      props.onClose?.({ e });\n      addClass(alertRef.value, `${COMPONENT_NAME.value}--closing`);\n    };\n\n    const handleCloseEnd = (e: TransitionEvent) => {\n      if (e.propertyName === 'opacity') {\n        visible.value = false;\n        props.onClosed?.({ e });\n      }\n    };\n\n    onMounted(() => {\n      on(alertRef.value, 'transitionend', handleCloseEnd);\n      descHeight.value = descriptionRef.value.offsetHeight;\n    });\n    onBeforeUnmount(() => {\n      off(alertRef.value, 'transitionend', handleCloseEnd);\n    });\n\n    return () => (\n      <div\n        ref={alertRef}\n        class={[\n          `${COMPONENT_NAME.value}`,\n          `${COMPONENT_NAME.value}--${props.theme}`,\n          {\n            [`${classPrefix.value}-is-hidden`]: !visible.value,\n          },\n        ]}\n      >\n        {renderIcon()}\n        {renderContent()}\n        {renderClose()}\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","useConfig","globalConfig","classPrefix","useGlobalIcon","CheckCircleFilledIcon","TdCheckCircleFilledIcon","CloseIcon","TdCloseIcon","ErrorCircleFilledIcon","TdErrorCircleFilledIcon","HelpCircleFilledIcon","TdHelpCircleFilledIcon","InfoCircleFilledIcon","TdInfoCircleFilledIcon","COMPONENT_NAME","usePrefixClass","renderTNodeJSX","useTNodeJSX","renderIconTNode","useIcon","alertRef","ref","descriptionRef","descHeight","visible","collapsed","renderIcon","Component","info","success","warning","error","question","iconContent","_createVNode","value","renderClose","close","closeContent","handleClose","renderTitle","titleContent","renderMessage","operationContent","renderDescription","messageContent","contentLength","Array","isArray","length","hasCollapse","maxLine","height","children","offsetHeight","slice","style","map","content","expandText","collapseText","renderContent","e","onClose","addClass","handleCloseEnd","propertyName","onClosed","onMounted","on","onBeforeUnmount","off","theme"],"mappings":"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"}