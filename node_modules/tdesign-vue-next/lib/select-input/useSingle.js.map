{"version":3,"file":"useSingle.js","sources":["../../src/select-input/useSingle.tsx"],"sourcesContent":["import { SetupContext, ref, computed, toRefs } from 'vue';\nimport isObject from 'lodash/isObject';\nimport pick from 'lodash/pick';\nimport { SelectInputCommonProperties } from './interface';\nimport { TdSelectInputProps } from './type';\nimport Input, { InputValue } from '../input';\nimport Loading from '../loading';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport useDefaultValue from '../hooks/useDefaultValue';\nimport { useFormDisabled } from '../form/hooks';\n\n// single 和 multiple 共有特性\nconst COMMON_PROPERTIES = [\n  'status',\n  'clearable',\n  'disabled',\n  'label',\n  'placeholder',\n  'readonly',\n  'suffix',\n  'suffixIcon',\n  'onPaste',\n  'onMouseenter',\n  'onMouseleave',\n];\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  value: 'value',\n};\n\nfunction getInputValue(value: TdSelectInputProps['value'], keys: TdSelectInputProps['keys']) {\n  const iKeys = keys || DEFAULT_KEYS;\n  return isObject(value) ? value[iKeys.label] : value;\n}\n\nexport default function useSingle(props: TdSelectInputProps, context: SetupContext) {\n  const { value, keys, inputValue: propsInputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n  const inputRef = ref();\n  const [inputValue, setInputValue] = useDefaultValue(\n    propsInputValue,\n    props.defaultInputValue ?? '',\n    props.onInputChange,\n    'inputValue',\n  );\n  const renderTNode = useTNodeJSX();\n  const disable = useFormDisabled();\n\n  const commonInputProps = computed<SelectInputCommonProperties>(() => ({\n    ...pick(props, COMMON_PROPERTIES),\n    disabled: disable.value,\n  }));\n\n  const onInnerClear = (context: { e: MouseEvent }) => {\n    context?.e?.stopPropagation();\n    props.onClear?.(context);\n    setInputValue('', { trigger: 'clear' });\n  };\n\n  const onInnerInputChange = (value: InputValue, context: { e: InputEvent | MouseEvent }) => {\n    if (props.allowInput) {\n      setInputValue(value, { ...context, trigger: 'input' });\n    }\n  };\n\n  const renderSelectSingle = (popupVisible: boolean) => {\n    const singleValueDisplay = renderTNode('valueDisplay');\n    const displayedValue = popupVisible && props.allowInput ? inputValue.value : getInputValue(value.value, keys.value);\n    const prefixContent = [singleValueDisplay, renderTNode('label')];\n    const inputProps = {\n      ...commonInputProps.value,\n      value: singleValueDisplay ? undefined : displayedValue,\n      label: prefixContent.length ? () => prefixContent : undefined,\n      autoWidth: props.autoWidth,\n      readonly: !props.allowInput || props.readonly,\n      placeholder: singleValueDisplay ? '' : props.placeholder,\n      suffixIcon: !disable.value && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n      showClearIconOnEmpty: Boolean(\n        props.clearable && (inputValue.value || displayedValue) && !disable.value && !props.readonly,\n      ),\n      allowTriggerBlur: props.allowInput && !props.readonly,\n      ...props.inputProps,\n    };\n\n    return (\n      <Input\n        ref=\"inputRef\"\n        style={context.attrs?.style}\n        v-slots={context.slots}\n        {...{\n          onChange: onInnerInputChange,\n          onClear: onInnerClear,\n          onBlur: (val: InputValue, context: { e: MouseEvent }) => {\n            props.onBlur?.(value.value, { ...context, inputValue: val });\n          },\n          onEnter: (val: InputValue, context: { e: KeyboardEvent }) => {\n            props.onEnter?.(value.value, { ...context, inputValue: val });\n          },\n          onFocus: (val, context) => {\n            props.onFocus?.(value.value, { ...context, inputValue: val });\n            !popupVisible && setInputValue(getInputValue(value.value, keys.value), { ...context, trigger: 'input' }); // 聚焦时拿到value\n          },\n          ...inputProps,\n        }}\n        inputClass={{\n          [`${classPrefix.value}-input--focused`]: popupVisible,\n          [`${classPrefix.value}-is-focused`]: popupVisible,\n        }}\n      />\n    );\n  };\n\n  return {\n    inputRef,\n    commonInputProps,\n    onInnerClear,\n    renderSelectSingle,\n  };\n}\n"],"names":["COMMON_PROPERTIES","DEFAULT_KEYS","label","value","getInputValue","keys","iKeys","isObject","useSingle","props","context","toRefs","propsInputValue","inputValue","classPrefix","usePrefixClass","inputRef","ref","useDefaultValue","defaultInputValue","onInputChange","setInputValue","renderTNode","useTNodeJSX","disable","useFormDisabled","commonInputProps","computed","pick","disabled","onInnerClear","e","stopPropagation","onClear","trigger","onInnerInputChange","allowInput","renderSelectSingle","popupVisible","singleValueDisplay","displayedValue","prefixContent","inputProps","length","autoWidth","readonly","placeholder","suffixIcon","loading","_createVNode","showClearIconOnEmpty","Boolean","clearable","allowTriggerBlur","_mergeProps","attrs","style","onChange","onBlur","val","onEnter","onFocus","slots"],"mappings":"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"}