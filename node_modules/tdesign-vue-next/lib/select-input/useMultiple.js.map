{"version":3,"file":"useMultiple.js","sources":["../../src/select-input/useMultiple.tsx"],"sourcesContent":["import { SetupContext, computed, ref, toRefs } from 'vue';\nimport isObject from 'lodash/isObject';\nimport { TdSelectInputProps, SelectInputChangeContext, SelectInputKeys } from './type';\nimport { SelectInputCommonProperties } from './interface';\nimport { InputValue } from '../input';\nimport TagInput, { TagInputValue, InputValueChangeContext } from '../tag-input';\nimport Loading from '../loading';\nimport useDefault from '../hooks/useDefaultValue';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useFormDisabled } from '../form/hooks';\n\nexport interface RenderSelectMultipleParams {\n  commonInputProps: SelectInputCommonProperties;\n  onInnerClear: (context: { e: MouseEvent }) => void;\n  popupVisible: boolean;\n}\n\nconst DEFAULT_KEYS = {\n  label: 'label',\n  key: 'key',\n  children: 'children',\n};\n\nexport default function useMultiple(props: TdSelectInputProps, context: SetupContext) {\n  const { inputValue } = toRefs(props);\n  const classPrefix = usePrefixClass();\n  const tagInputRef = ref();\n  const [tInputValue, setTInputValue] = useDefault(\n    inputValue,\n    props.defaultInputValue,\n    props.onInputChange,\n    'inputValue',\n  );\n  const disable = useFormDisabled();\n\n  const iKeys = computed<SelectInputKeys>(() => ({ ...DEFAULT_KEYS, ...props.keys }));\n  const tags = computed<TagInputValue>(() => {\n    if (!(props.value instanceof Array)) {\n      return isObject(props.value) ? [props.value[iKeys.value.label]] : [props.value];\n    }\n    return props.value.map((item) => (isObject(item) ? item[iKeys.value.label] : item));\n  });\n\n  const tPlaceholder = computed<string>(() => (!tags.value || !tags.value.length ? props.placeholder : ''));\n\n  const onTagInputChange = (val: TagInputValue, context: SelectInputChangeContext) => {\n    // 避免触发浮层的显示或隐藏\n    if (context.trigger === 'tag-remove') {\n      context.e?.stopPropagation();\n    }\n    props.onTagChange?.(val, context);\n  };\n\n  const renderSelectMultiple = (p: RenderSelectMultipleParams) => {\n    const tagInputProps = {\n      ...p.commonInputProps,\n      tagProps: props.tagProps,\n      label: props.label,\n      autoWidth: props.autoWidth,\n      readonly: props.readonly,\n      placeholder: tPlaceholder.value,\n      minCollapsedNum: props.minCollapsedNum,\n      collapsedItems: props.collapsedItems,\n      tag: props.tag,\n      value: tags.value,\n      valueDisplay: props.valueDisplay,\n      inputValue: tInputValue.value || '',\n      inputProps: {\n        readonly: !props.allowInput || props.readonly,\n        inputClass: {\n          [`${classPrefix.value}-input--focused`]: p.popupVisible,\n        },\n        ...props.inputProps,\n      },\n      suffixIcon: !disable.value && props.loading ? () => <Loading loading size=\"small\" /> : props.suffixIcon,\n      ...props.tagInputProps,\n    };\n\n    return (\n      <TagInput\n        ref=\"tagInputRef\"\n        {...tagInputProps}\n        v-slots={context.slots}\n        onInputChange={(val: InputValue, context: InputValueChangeContext) => {\n          // 筛选器统一特性：筛选器按下回车时不清空输入框\n          if (context?.trigger === 'enter') return;\n          setTInputValue(val, { trigger: context.trigger, e: context.e });\n        }}\n        onChange={onTagInputChange}\n        onClear={p.onInnerClear}\n        onBlur={(val, context) => {\n          props.onBlur?.(props.value, { ...context, tagInputValue: val });\n        }}\n        onEnter={(val, context) => {\n          props.onEnter?.(props.value, { ...context, inputValue: tInputValue.value });\n        }}\n        onFocus={(val, context) => {\n          props.onFocus?.(props.value, { ...context, tagInputValue: val });\n        }}\n      />\n    );\n  };\n\n  return {\n    tags,\n    tPlaceholder,\n    tagInputRef,\n    renderSelectMultiple,\n  };\n}\n"],"names":["DEFAULT_KEYS","label","key","children","useMultiple","props","context","toRefs","inputValue","classPrefix","usePrefixClass","tagInputRef","ref","useDefault","defaultInputValue","onInputChange","tInputValue","setTInputValue","disable","useFormDisabled","iKeys","computed","keys","tags","value","Array","isObject","map","item","tPlaceholder","length","placeholder","onTagInputChange","val","trigger","e","stopPropagation","onTagChange","renderSelectMultiple","p","tagInputProps","commonInputProps","tagProps","autoWidth","readonly","minCollapsedNum","collapsedItems","tag","valueDisplay","inputProps","allowInput","inputClass","popupVisible","suffixIcon","loading","_createVNode","_mergeProps","onInnerClear","onBlur","tagInputValue","onEnter","onFocus","slots"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiBA,IAAMA,YAAe,GAAA;AACnBC,EAAAA,KAAO,EAAA,OADY;AAEnBC,EAAAA,GAAK,EAAA,KAFc;AAGnBC,EAAAA,QAAU,EAAA,UAAA;AAHS,CAArB,CAAA;AAMwB,SAAAC,WAAA,CAAYC,KAAZ,EAAuCC,OAAvC,EAA8D;EACpF,IAAuBC,OAAAA,GAAAA,MAAA,CAAOF,KAAP,CAAvB;MAAQG,UAAR,WAAQA,UAAR,CAAA;;EACA,IAAMC,cAAcC,cAAe,EAAnC,CAAA;EACA,IAAMC,cAAcC,GAAI,EAAxB,CAAA;;AACM,EAAA,IAAA,WAAA,GAAgCC,eAAA,CACpCL,UADoC,EAEpCH,KAAM,CAAAS,iBAF8B,EAGpCT,KAAM,CAAAU,aAH8B,EAIpC,YAJoC,CAAhC;AAAA,MAAA,YAAA,GAAA,cAAA,CAAA,WAAA,EAAA,CAAA,CAAA;AAAA,MAACC,WAAD,GAAA,YAAA,CAAA,CAAA,CAAA;AAAA,MAAcC,cAAd,GAAA,YAAA,CAAA,CAAA,CAAA,CAAA;;EAMN,IAAMC,UAAUC,eAAgB,EAAhC,CAAA;EAEM,IAAAC,KAAA,GAAQC,SAA0B,YAAA;AAAA,IAAA,OAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAAYrB,YAAZ,CAAA,EAA6BK,KAAM,CAAAiB,IAAnC,CAAA,CAAA;AAAA,IAAlC,CAAA;AACA,EAAA,IAAAC,IAAA,GAAOF,SAAwB,YAAM;AACrC,IAAA,IAAA,EAAEhB,KAAM,CAAAmB,KAAN,YAAuBC,KAAzB,CAAA,EAAiC;MACnC,OAAOC,QAAS,CAAArB,KAAA,CAAMmB,KAAN,CAAT,GAAwB,CAACnB,KAAA,CAAMmB,KAAN,CAAYJ,KAAA,CAAMI,KAAN,CAAYvB,KAAxB,CAAD,CAAxB,GAA2D,CAACI,MAAMmB,KAAP,CAAlE,CAAA;AACF,KAAA;;AACA,IAAA,OAAOnB,KAAM,CAAAmB,KAAN,CAAYG,GAAZ,CAAgB,UAACC,IAAD,EAAA;AAAA,MAAA,OAAWF,QAAA,CAASE,IAAT,CAAA,GAAiBA,IAAK,CAAAR,KAAA,CAAMI,KAAN,CAAYvB,KAAZ,CAAtB,GAA2C2B,IAAtD,CAAA;AAAA,KAAhB,CAAP,CAAA;AACD,IALK,CAAA;EAON,IAAMC,YAAe,GAAAR,QAAA,CAAiB,YAAA;AAAA,IAAA,OAAO,CAACE,IAAK,CAAAC,KAAN,IAAe,CAACD,IAAA,CAAKC,KAAL,CAAWM,MAA3B,GAAoCzB,KAAM,CAAA0B,WAA1C,GAAwD,EAA/D,CAAA;AAAA,GAAjB,CAArB,CAAA;;EAEM,IAAAC,gBAAA,GAAmB,SAAnBA,gBAAmB,CAACC,GAAD,EAAqB3B,QAArB,EAA2D;AAAA,IAAA,IAAA,kBAAA,CAAA;;AAE9EA,IAAAA,IAAAA,QAAAA,CAAQ4B,OAAR5B,KAAoB,YAApBA,EAAkC;AAAA,MAAA,IAAA,WAAA,CAAA;;AACpCA,MAAAA,CAAAA,WAAAA,GAAAA,QAAAA,CAAQ6B,CAAR7B,MAAAA,IAAAA,IAAAA,WAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,WAAAA,CAAW8B,eAAX9B,EAAAA,CAAAA;AACF,KAAA;;IACM,CAAAD,kBAAAA,GAAAA,KAAA,CAAAgC,WAAA,MAAA,IAAA,IAAA,kBAAA,KAAA,KAAA,CAAA,GAAA,KAAA,CAAA,GAAA,kBAAA,CAAA,IAAA,CAAAhC,KAAA,EAAc4B,GAAd,EAAmB3B,QAAnB,CAAA,CAAA;GALF,CAAA;;AAQA,EAAA,IAAAgC,oBAAA,GAAuB,SAAvBA,oBAAuB,CAACC,CAAD,EAAmC;AAC9D,IAAA,IAAMC,aAAgB,GAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EACjBD,CAAE,CAAAE,gBADe,CAAA,EAAA,EAAA,EAAA;MAEpBC,UAAUrC,KAAM,CAAAqC,QAFI;MAGpBzC,OAAOI,KAAM,CAAAJ,KAHO;MAIpB0C,WAAWtC,KAAM,CAAAsC,SAJG;MAKpBC,UAAUvC,KAAM,CAAAuC,QALI;MAMpBb,aAAaF,YAAa,CAAAL,KANN;MAOpBqB,iBAAiBxC,KAAM,CAAAwC,eAPH;MAQpBC,gBAAgBzC,KAAM,CAAAyC,cARF;MASpBC,KAAK1C,KAAM,CAAA0C,GATS;MAUpBvB,OAAOD,IAAK,CAAAC,KAVQ;MAWpBwB,cAAc3C,KAAM,CAAA2C,YAXA;AAYpBxC,MAAAA,UAAA,EAAYQ,YAAYQ,KAAZ,IAAqB,EAZb;MAapByB,UAAY,EAAA,aAAA,CAAA;QACVL,QAAU,EAAA,CAACvC,KAAM,CAAA6C,UAAP,IAAqB7C,KAAM,CAAAuC,QAD3B;AAEVO,QAAAA,UAAY,gCACN1C,WAAY,CAAAe,KADN,EAC+Be,iBAAAA,CAAAA,EAAAA,CAAE,CAAAa,YADjC,CAAA;OAGT/C,EAAAA,KAAM,CAAA4C,UALC,CAbQ;MAoBpBI,UAAY,EAAA,CAACnC,OAAQ,CAAAM,KAAT,IAAkBnB,KAAM,CAAAiD,OAAxB,GAAkC,YAAA;AAAA,QAAA,OAAAC,WAAA,CAAA,OAAA,EAAA;AAAA,UAAA,SAAA,EAAA,IAAA;UAAA,MAA4B,EAAA,OAAA;AAA5B,SAAA,EAAA,IAAA,CAAA,CAAA;OAAlC,GAA2ElD,KAAM,CAAAgD,UAAAA;KAC1FhD,EAAAA,KAAM,CAAAmC,aArBW,CAAtB,CAAA;;AAyBE,IAAA,OAAAe,WAAA,CAAA,QAAA,EAAAC,UAAA,CAAA;MAAA,KACM,EAAA,aAAA;AADN,KAAA,EAEMhB,aAFN,EAAA;AAAA,MAAA,eAAA,EAIiB,SAACP,aAAAA,CAAAA,GAAD,EAAkB3B,QAAlB,EAAuD;AAEpE,QAAA,IAAIA,CAAAA,aAAAA,IAAAA,IAAAA,mBAAAA,GAAAA,KAAAA,CAAAA,GAAAA,SAAS4B,OAAT5B,MAAqB,OAAzB,EAAkC,OAAA;QACnBW,cAAA,CAAAgB,GAAA,EAAK;UAAEC,OAAS5B,EAAAA,QAAAA,CAAQ4B,OAAnB;UAA4BC,CAAG7B,EAAAA,QAAAA,CAAQ6B,CAAAA;AAAvC,SAAL,CAAA,CAAA;OAPnB;AAAA,MAAA,UAAA,EASYH,gBATZ;MAAA,SAUWO,EAAAA,EAAEkB,YAVb;AAAA,MAAA,QAAA,EAWU,SAACxB,MAAAA,CAAAA,GAAD,EAAM3B,QAAN,EAAkB;AAAA,QAAA,IAAA,aAAA,CAAA;;QAClB,CAAAD,aAAAA,GAAAA,KAAA,CAAAqD,MAAA,MAAArD,IAAAA,IAAAA,aAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,aAAAA,CAAAA,IAAAA,CAAAA,KAAA,EAASA,MAAMmB,KAAf,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAA2BlB,QAA3B,CAAA,EAAA,EAAA,EAAA;AAAoCqD,UAAAA,aAAA,EAAe1B,GAAAA;SAAnD,CAAA,CAAA,CAAA;OAZV;AAAA,MAAA,SAAA,EAcW,SAACA,OAAAA,CAAAA,GAAD,EAAM3B,QAAN,EAAkB;AAAA,QAAA,IAAA,cAAA,CAAA;;QACnB,CAAAD,cAAAA,GAAAA,KAAA,CAAAuD,OAAA,MAAAvD,IAAAA,IAAAA,cAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,cAAAA,CAAAA,IAAAA,CAAAA,KAAA,EAAUA,MAAMmB,KAAhB,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAA4BlB,QAA5B,CAAA,EAAA,EAAA,EAAA;UAAqCE,UAAA,EAAYQ,WAAY,CAAAQ,KAAAA;SAA7D,CAAA,CAAA,CAAA;OAfV;AAAA,MAAA,SAAA,EAiBW,SAACS,OAAAA,CAAAA,GAAD,EAAM3B,QAAN,EAAkB;AAAA,QAAA,IAAA,cAAA,CAAA;;QACnB,CAAAD,cAAAA,GAAAA,KAAA,CAAAwD,OAAA,MAAAxD,IAAAA,IAAAA,cAAAA,KAAAA,KAAAA,CAAAA,GAAAA,KAAAA,CAAAA,GAAAA,cAAAA,CAAAA,IAAAA,CAAAA,KAAA,EAAUA,MAAMmB,KAAhB,EAAA,aAAA,CAAA,aAAA,CAAA,EAAA,EAA4BlB,QAA5B,CAAA,EAAA,EAAA,EAAA;AAAqCqD,UAAAA,aAAA,EAAe1B,GAAAA;SAApD,CAAA,CAAA,CAAA;AAEV,OAAA;KAjBW3B,CAAAA,EAAAA,OAAA,CAAQwD,KAHnB,CAAA,CAAA;GA1BE,CAAA;;EAkDC,OAAA;AACLvC,IAAAA,IAAA,EAAAA,IADK;AAELM,IAAAA,YAAA,EAAAA,YAFK;AAGLlB,IAAAA,WAAA,EAAAA,WAHK;AAIL2B,IAAAA,oBAAA,EAAAA,oBAAAA;GAJK,CAAA;AAMT;;;;"}