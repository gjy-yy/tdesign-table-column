{"version":3,"file":"useRangeValue.js","sources":["../../../src/date-picker/hooks/useRangeValue.ts"],"sourcesContent":["import { ref, toRefs, watchEffect, computed } from 'vue';\nimport dayjs from 'dayjs';\nimport useVModel from '../../hooks/useVModel';\n\nimport { TdDateRangePickerProps, DateRangeValue } from '../type';\nimport {\n  isValidDate,\n  formatDate,\n  formatTime,\n  getDefaultFormat,\n  parseToDayjs,\n} from '../../_common/js/date-picker/format';\nimport { extractTimeFormat } from '../../_common/js/date-picker/utils';\n\nexport const PARTIAL_MAP = { first: 'start', second: 'end' };\n\n// 初始化面板年份月份\nexport function initYearMonthTime({\n  value,\n  mode = 'date',\n  format,\n  timeFormat = 'HH:mm:ss',\n  enableTimePicker,\n}: {\n  value: DateRangeValue;\n  mode: string;\n  format: string;\n  timeFormat?: string;\n  enableTimePicker?: boolean;\n}) {\n  const defaultYearMonthTime = {\n    year: [dayjs().year(), dayjs().year()],\n    month: [dayjs().month(), dayjs().month()],\n    time: [dayjs().format(timeFormat), dayjs().format(timeFormat)],\n  };\n  if (mode === 'year') {\n    defaultYearMonthTime.year[1] += 10;\n  } else if (mode === 'month' || mode === 'quarter') {\n    defaultYearMonthTime.year[1] += 1;\n  } else if ((mode === 'date' || mode === 'week') && !enableTimePicker) {\n    defaultYearMonthTime.month[1] += 1;\n  }\n\n  if (!value || !Array.isArray(value) || !value.length) {\n    return defaultYearMonthTime;\n  }\n\n  return {\n    year: value.map((v) => parseToDayjs(v, format).year()),\n    month: value.map((v) => parseToDayjs(v, format).month()),\n    time: value.map((v) => parseToDayjs(v, format).format(timeFormat)),\n  };\n}\n\nexport default function useRangeValue(props: TdDateRangePickerProps) {\n  const { value: valueFromProps, modelValue } = toRefs(props);\n\n  const [value, onChange] = useVModel(valueFromProps, modelValue, props.defaultValue, props.onChange);\n\n  const formatRef = computed(() =>\n    getDefaultFormat({\n      mode: props.mode,\n      format: props.format,\n      valueType: props.valueType,\n      enableTimePicker: props.enableTimePicker,\n    }),\n  );\n\n  if (props.enableTimePicker) {\n    if (!extractTimeFormat(formatRef.value.format))\n      console.error(`format: ${formatRef.value.format} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n    if (!extractTimeFormat(formatRef.value.valueType) && formatRef.value.valueType !== 'time-stamp')\n      console.error(`valueType: ${formatRef.value.valueType} 不规范，包含时间选择必须要有时间格式化 HH:mm:ss`);\n  }\n\n  // warning invalid value\n  if (!Array.isArray(value.value)) {\n    console.error(`typeof value: ${value.value} must be Array!`);\n  } else if (!isValidDate(value.value, formatRef.value.valueType)) {\n    console.error(\n      `value: ${value.value} is invalid dateTime! Check whether the value is consistent with format: ${formatRef.value.format}`,\n    );\n  }\n\n  const isFirstValueSelected = ref(false); // 记录面板点击次数，两次后才自动关闭\n  const time = ref(\n    initYearMonthTime({\n      value: value.value,\n      mode: props.mode,\n      format: formatRef.value.format,\n      timeFormat: formatRef.value.timeFormat,\n    }).time,\n  );\n  const month = ref(\n    initYearMonthTime({\n      value: value.value,\n      mode: props.mode,\n      format: formatRef.value.format,\n      enableTimePicker: props.enableTimePicker,\n    }).month,\n  );\n  const year = ref(initYearMonthTime({ value: value.value, mode: props.mode, format: formatRef.value.format }).year);\n  const cacheValue = ref(\n    formatDate(value.value, { format: formatRef.value.format, targetFormat: formatRef.value.format }),\n  ); // 选择阶段预选状态\n\n  // 输入框响应 value 变化\n  watchEffect(() => {\n    if (!value.value) {\n      cacheValue.value = [];\n      return;\n    }\n    if (!isValidDate(value.value, formatRef.value.valueType)) return;\n\n    cacheValue.value = formatDate(value.value, {\n      format: formatRef.value.format,\n      targetFormat: formatRef.value.format,\n    });\n    time.value = formatTime(value.value, formatRef.value.timeFormat) as string[];\n  });\n\n  return {\n    year,\n    month,\n    value,\n    time,\n    isFirstValueSelected,\n    cacheValue,\n    onChange,\n  };\n}\n"],"names":["PARTIAL_MAP","first","second","initYearMonthTime","value","mode","format","timeFormat","enableTimePicker","defaultYearMonthTime","year","dayjs","month","time","Array","isArray","length","map","v","parseToDayjs","useRangeValue","props","toRefs","valueFromProps","modelValue","useVModel","defaultValue","onChange","formatRef","computed","getDefaultFormat","valueType","extractTimeFormat","console","error","isValidDate","isFirstValueSelected","ref","cacheValue","formatDate","targetFormat","watchEffect","formatTime"],"mappings":"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"}