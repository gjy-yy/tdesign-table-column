{"version":3,"file":"Table.js","sources":["../../../src/date-picker/base/Table.tsx"],"sourcesContent":["import { defineComponent, PropType, computed } from 'vue';\nimport TDatePickerCell from './Cell';\nimport { useConfig, usePrefixClass } from '../../hooks/useConfig';\nimport type { TdDatePickerProps } from '../type';\nimport { parseToDayjs } from '../../_common/js/date-picker/format';\n\nexport default defineComponent({\n  name: 'TDatePickerTable',\n  props: {\n    mode: {\n      type: String as PropType<TdDatePickerProps['mode']>,\n      default: 'date',\n    },\n    value: [String, Number, Array, Date],\n    format: String,\n    firstDayOfWeek: Number,\n    data: Array,\n    time: String,\n    onCellClick: Function,\n    onCellMouseEnter: Function,\n    onCellMouseLeave: Function,\n  },\n  setup(props) {\n    const COMPONENT_NAME = usePrefixClass('date-picker__table');\n    const { globalConfig } = useConfig('datePicker');\n    const { weekdays, weekAbbreviation } = globalConfig.value;\n\n    const weekArr = computed(() => {\n      const _weekArr = [];\n      let wi = props.firstDayOfWeek - 1;\n      const len = weekdays.length;\n      while (_weekArr.length < len) {\n        _weekArr.push(weekdays[wi]);\n        wi = (wi + len + 1) % len;\n      }\n\n      if (props.mode === 'week') _weekArr.unshift(weekAbbreviation);\n\n      return _weekArr;\n    });\n\n    const showThead = computed(() => props.mode === 'date' || props.mode === 'week');\n\n    // 高亮周区间\n    const weekRowClass = (value: any, format: string, targetValue: Date) => {\n      if (props.mode !== 'week') return {};\n\n      if (Array.isArray(value)) {\n        if (!value.length) return {};\n        const [startObj, endObj] = value.map((v) => parseToDayjs(v, format));\n        const startYear = startObj.year();\n        const startWeek = startObj.week();\n        const endYear = endObj && endObj.year();\n        const endWeek = endObj && endObj.week();\n\n        const targetObj = parseToDayjs(targetValue, format);\n        const targetYear = targetObj.year();\n        const targetWeek = targetObj.week();\n        const isActive =\n          (targetYear === startYear && targetWeek === startWeek) || (targetYear === endYear && targetWeek === endWeek);\n        const isRange =\n          targetYear >= startYear && targetYear <= endYear && targetWeek > startWeek && targetWeek < endWeek;\n        return {\n          // 同年同周\n          [`${COMPONENT_NAME.value}-${props.mode}-row--active`]: isActive,\n          [`${COMPONENT_NAME.value}-${props.mode}-row--range`]: isRange,\n        };\n      }\n\n      return {\n        [`${COMPONENT_NAME.value}-${props.mode}-row--active`]:\n          parseToDayjs(value, format).week() === parseToDayjs(targetValue, format).week(),\n      };\n    };\n\n    return () => (\n      <div class={COMPONENT_NAME.value} onMouseleave={(e: MouseEvent) => props.onCellMouseLeave?.({ e })}>\n        <table>\n          {showThead.value && (\n            <thead>\n              <tr>\n                {weekArr.value.map((value: string, i: number) => (\n                  <th key={i}>{value}</th>\n                ))}\n              </tr>\n            </thead>\n          )}\n          <tbody>\n            {props.data.map((row: Array<any>, i: number) => (\n              <tr\n                key={i}\n                class={{\n                  [`${COMPONENT_NAME.value}-${props.mode}-row`]: true,\n                  ...weekRowClass(props.value, props.format, row[0].value),\n                }}\n              >\n                {row.map((col: any, j: number) => (\n                  <TDatePickerCell\n                    {...col}\n                    key={j}\n                    time={props.time}\n                    onClick={props.onCellClick}\n                    onMouseEnter={props.onCellMouseEnter}\n                  />\n                ))}\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","mode","type","String","value","Number","Array","Date","format","firstDayOfWeek","data","time","onCellClick","Function","onCellMouseEnter","onCellMouseLeave","setup","COMPONENT_NAME","usePrefixClass","useConfig","globalConfig","weekdays","weekAbbreviation","weekArr","computed","_weekArr","wi","len","length","push","unshift","showThead","weekRowClass","targetValue","isArray","map","v","parseToDayjs","startObj","endObj","startYear","year","startWeek","week","endYear","endWeek","targetObj","targetYear","targetWeek","isActive","isRange","_createVNode","e","i","row","col","j","_mergeProps"],"mappings":"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"}