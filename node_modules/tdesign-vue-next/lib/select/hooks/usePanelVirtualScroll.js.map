{"version":3,"file":"usePanelVirtualScroll.js","sources":["../../../src/select/hooks/usePanelVirtualScroll.ts"],"sourcesContent":["import { Ref, computed, onMounted, onBeforeUnmount, toRefs } from 'vue';\nimport useVirtualScroll from '../../hooks/useVirtualScroll';\nimport { TdSelectProps } from '../type';\nimport { Styles } from '../../common';\n\nexport const usePanelVirtualScroll = (props: {\n  scroll: TdSelectProps['scroll'];\n  popupContentRef: Ref<HTMLElement>;\n  options: Ref<TdSelectProps['options']>;\n}) => {\n  const isVirtual = computed(\n    () => props.scroll?.type === 'virtual' && props.options.value?.length > (props.scroll?.threshold || 100),\n  );\n\n  const {\n    trs = null,\n    visibleData = null,\n    handleScroll: handleVirtualScroll = null,\n    scrollHeight = null,\n    translateY = null,\n    handleRowMounted = null,\n  } = props.scroll?.type === 'virtual'\n    ? useVirtualScroll({\n        container: props.popupContentRef,\n        data: props.options,\n        fixedHeight: props.scroll?.isFixedRowHeight || false,\n        lineHeight: props.scroll?.rowHeight || 28, // 默认每行高度28\n        bufferSize: props.scroll?.bufferSize || 20,\n        threshold: props.scroll?.threshold || 100,\n      })\n    : {};\n  let lastScrollY = -1;\n\n  const onInnerVirtualScroll = (e: WheelEvent) => {\n    if (!isVirtual.value) {\n      return;\n    }\n    const target = e.target as HTMLElement;\n    const top = target.scrollTop;\n    // 排除横向滚动出发的纵向虚拟滚动计算\n    if (Math.abs(lastScrollY - top) > 5) {\n      handleVirtualScroll();\n      lastScrollY = top;\n    } else {\n      lastScrollY = -1;\n    }\n  };\n\n  // 监听popup滚动 处理虚拟滚动时的virtualData变化\n  onMounted(() => {\n    if (isVirtual.value) {\n      props.popupContentRef.value?.addEventListener('scroll', onInnerVirtualScroll);\n    }\n  });\n\n  // 卸载时取消监听\n  onBeforeUnmount(() => {\n    if (isVirtual.value) {\n      props.popupContentRef.value?.removeEventListener('scroll', onInnerVirtualScroll);\n    }\n  });\n\n  const cursorStyle = computed(\n    () =>\n      ({\n        position: 'absolute',\n        width: '1px',\n        height: '1px',\n        transition: 'transform 0.2s',\n        transform: `translate(0, ${scrollHeight.value}px)`,\n        '-ms-transform': `translate(0, ${scrollHeight.value}px)`,\n        '-moz-transform': `translate(0, ${scrollHeight.value}px)`,\n        '-webkit-transform': `translate(0, ${scrollHeight.value}px)`,\n      } as Styles),\n  );\n\n  const panelStyle = computed(\n    () =>\n      ({\n        transform: `translate(0, ${translateY.value}px)`,\n        '-ms-transform': `translate(0, ${translateY.value}px)`,\n        '-moz-transform': `translate(0, ${translateY.value}px)`,\n        '-webkit-transform': `translate(0, ${translateY.value}px)`,\n      } as Styles),\n  );\n\n  return {\n    trs,\n    scrollHeight,\n    translateY,\n    visibleData,\n    handleRowMounted,\n    isVirtual,\n    cursorStyle,\n    panelStyle,\n  };\n};\n"],"names":["usePanelVirtualScroll","props","isVirtual","computed","scroll","type","options","value","length","threshold","useVirtualScroll","container","popupContentRef","data","fixedHeight","isFixedRowHeight","lineHeight","rowHeight","bufferSize","trs","visibleData","handleScroll","handleVirtualScroll","scrollHeight","translateY","handleRowMounted","lastScrollY","onInnerVirtualScroll","e","target","top","scrollTop","Math","abs","onMounted","addEventListener","onBeforeUnmount","removeEventListener","cursorStyle","position","width","height","transition","transform","panelStyle"],"mappings":"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"}