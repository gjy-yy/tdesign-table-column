{"version":3,"file":"primary-table.js","sources":["../../src/table/primary-table.tsx"],"sourcesContent":["import { computed, defineComponent, toRefs, h, ref, onMounted, SetupContext } from 'vue';\nimport get from 'lodash/get';\nimport omit from 'lodash/omit';\nimport baseTableProps from './base-table-props';\nimport primaryTableProps from './primary-table-props';\nimport BaseTable from './base-table';\nimport { useTNodeJSX } from '../hooks/tnode';\nimport useColumnController from './hooks/useColumnController';\nimport useRowExpand from './hooks/useRowExpand';\nimport useTableHeader, { renderTitle } from './hooks/useTableHeader';\nimport useRowSelect from './hooks/useRowSelect';\nimport {\n  TdPrimaryTableProps,\n  PrimaryTableCol,\n  TableRowData,\n  PrimaryTableCellParams,\n  PrimaryTableRowEditContext,\n} from './type';\nimport useSorter from './hooks/useSorter';\nimport useFilter from './hooks/useFilter';\nimport useDragSort from './hooks/useDragSort';\nimport useAsyncLoading from './hooks/useAsyncLoading';\nimport EditableCell, { EditableCellProps } from './editable-cell';\nimport { PageInfo } from '../pagination';\nimport useClassName from './hooks/useClassName';\nimport useEditableRow from './hooks/useEditableRow';\n\nexport { BASE_TABLE_ALL_EVENTS } from './base-table';\n\nconst OMIT_PROPS = [\n  'hideSortTips',\n  'dragSort',\n  'defaultExpandedRowKeys',\n  'defaultSelectedRowKeys',\n  'columnController',\n  'filterRow',\n  'sortOnRowDraggable',\n  'expandOnRowClick',\n  'multipleSort',\n  'expandIcon',\n  'onChange',\n  'onAsyncLoadingClick',\n  'onColumnChange',\n  'onColumnControllerVisibleChange',\n  'onDataChange',\n  'onDisplayColumnsChange',\n  'onDragSort',\n  'onExpandChange',\n  'onFilterChange',\n  'onSelectChange',\n  'onSortChange',\n];\n\nconst cellRuleMap = new Map<any, PrimaryTableRowEditContext<TableRowData>[]>();\n\nexport default defineComponent({\n  name: 'TPrimaryTable',\n\n  props: {\n    ...baseTableProps,\n    ...primaryTableProps,\n  },\n\n  setup(props: TdPrimaryTableProps, context: SetupContext) {\n    const renderTNode = useTNodeJSX();\n    const { columns, columnController } = toRefs(props);\n    const primaryTableRef = ref(null);\n    const { tableDraggableClasses, tableBaseClass, tableSelectedClasses } = useClassName();\n    // 自定义列配置功能\n    const { tDisplayColumns, renderColumnController } = useColumnController(props, context);\n    // 展开/收起行功能\n    const { showExpandedRow, showExpandIconColumn, getExpandColumn, renderExpandedRow, onInnerExpandRowClick } =\n      useRowExpand(props, context);\n    // 排序功能\n    const { renderSortIcon } = useSorter(props, context);\n    // 行选中功能\n    const { formatToRowSelectColumn, selectedRowClassNames } = useRowSelect(props, tableSelectedClasses);\n    // 过滤功能\n    const {\n      hasEmptyCondition,\n      isTableOverflowHidden,\n      renderFilterIcon,\n      renderFirstFilterRow,\n      setFilterPrimaryTableRef,\n    } = useFilter(props, context);\n\n    // 拖拽排序功能\n    const { isRowHandlerDraggable, isRowDraggable, isColDraggable, setDragSortPrimaryTableRef, setDragSortColumns } =\n      useDragSort(props, context);\n\n    const { renderTitleWidthIcon } = useTableHeader(props);\n    const { renderAsyncLoading } = useAsyncLoading(props, context);\n\n    const { errorListMap, editableKeysMap, validateRowData, validateTableData, onRuleChange, clearValidateData } =\n      useEditableRow(props);\n\n    const primaryTableClasses = computed(() => {\n      return {\n        [tableDraggableClasses.colDraggable]: isColDraggable.value,\n        [tableDraggableClasses.rowHandlerDraggable]: isRowHandlerDraggable.value,\n        [tableDraggableClasses.rowDraggable]: isRowDraggable.value,\n        [tableBaseClass.overflowVisible]: isTableOverflowHidden.value === false,\n        [tableBaseClass.tableRowEdit]: props.editableRowKeys,\n      };\n    });\n\n    // 如果想给 TR 添加类名，请在这里补充，不要透传更多额外 Props 到 BaseTable\n    const tRowClassNames = computed(() => {\n      const tClassNames = [props.rowClassName, selectedRowClassNames.value];\n      return tClassNames.filter((v) => v);\n    });\n\n    // 如果想给 TR 添加属性，请在这里补充，不要透传更多额外 Props 到 BaseTable\n    const tRowAttributes = computed(() => {\n      const tAttributes = [props.rowAttributes];\n      if (isRowHandlerDraggable.value || isRowDraggable.value) {\n        tAttributes.push(({ row }) => ({ 'data-id': get(row, props.rowKey || 'id') }));\n      }\n      return tAttributes.filter((v) => v);\n    });\n\n    // 多个 Hook 共用 primaryTableRef\n    onMounted(() => {\n      setFilterPrimaryTableRef(primaryTableRef.value);\n      setDragSortPrimaryTableRef(primaryTableRef.value);\n    });\n\n    // 对外暴露的方法\n    context.expose({\n      validateRowData,\n      validateTableData,\n      clearValidateData,\n      refreshTable: () => {\n        primaryTableRef.value.refreshTable();\n      },\n    });\n\n    // 1. 影响列数量的因素有：自定义列配置、展开/收起行、多级表头；2. 影响表头内容的因素有：排序图标、筛选图标\n    const getColumns = (columns: PrimaryTableCol<TableRowData>[]) => {\n      const arr: PrimaryTableCol<TableRowData>[] = [];\n      for (let i = 0, len = columns.length; i < len; i++) {\n        let item = { ...columns[i] };\n        // 自定义列显示控制\n        const isDisplayColumn = item.children?.length || tDisplayColumns.value?.includes(item.colKey);\n        if (!isDisplayColumn && props.columnController) continue;\n        item = formatToRowSelectColumn(item);\n        // 添加排序图标和过滤图标\n        if (item.sorter || item.filter) {\n          const titleContent = renderTitle(context.slots, item, i);\n          const { ellipsisTitle } = item;\n          item.title = (h, p) => {\n            const sortIcon = item.sorter ? renderSortIcon(p) : null;\n            const filterIcon = item.filter ? renderFilterIcon(p) : null;\n            // @ts-ignore 注意：此处 Vue2 和 Vue3 有所不同\n            const attach = primaryTableRef.value?.tableContentRef;\n            return renderTitleWidthIcon([titleContent, sortIcon, filterIcon], p.col, p.colIndex, ellipsisTitle, attach);\n          };\n          item.ellipsisTitle = false;\n        }\n        // 如果是单元格可编辑状态\n        if (item.edit?.component) {\n          const oldCell = item.cell;\n          item.cell = (h, p: PrimaryTableCellParams<TableRowData>) => {\n            const cellProps: EditableCellProps = {\n              ...p,\n              oldCell,\n              tableBaseClass,\n              cellEmptyContent: props.cellEmptyContent,\n              onChange: props.onRowEdit,\n              onValidate: props.onRowValidate,\n              onRuleChange,\n            };\n            if (props.editableRowKeys) {\n              const rowValue = get(p.row, props.rowKey || 'id');\n              cellProps.editable = editableKeysMap.value[rowValue] || false;\n              const key = [rowValue, p.col.colKey].join('__');\n              const errorList = errorListMap.value?.[key];\n              errorList && (cellProps.errors = errorList);\n            }\n            if (props.editableCellState) {\n              cellProps.readonly = !props.editableCellState(p);\n            }\n            return <EditableCell {...cellProps} v-slots={context.slots} />;\n          };\n        }\n        if (item.children?.length) {\n          item.children = getColumns(item.children);\n        }\n        // 多级表头和自定义列配置特殊逻辑：要么子节点不存在，要么子节点长度大于 1，方便做自定义列配置\n        if (!item.children || item.children?.length) {\n          arr.push(item);\n        }\n      }\n      return arr;\n    };\n\n    const tColumns = computed(() => {\n      const cols = getColumns(columns.value);\n      if (showExpandIconColumn.value) {\n        cols.unshift(getExpandColumn());\n      }\n      return cols;\n    });\n\n    const onInnerPageChange = (pageInfo: PageInfo, newData: Array<TableRowData>) => {\n      props.onPageChange?.(pageInfo, newData);\n      const changeParams: Parameters<TdPrimaryTableProps['onChange']> = [\n        { pagination: pageInfo },\n        { trigger: 'pagination', currentData: newData },\n      ];\n      props.onChange?.(...changeParams);\n    };\n\n    return () => {\n      const formatNode = (\n        api: string,\n        renderInnerNode: Function,\n        condition: boolean,\n        extra?: { reverse?: boolean },\n      ) => {\n        if (!condition) return props[api];\n        const innerNode = renderInnerNode(h);\n        const propsNode = renderTNode(api);\n        if (innerNode && !propsNode) return () => innerNode;\n        if (propsNode && !innerNode) return () => propsNode;\n        if (innerNode && propsNode) {\n          return () =>\n            extra?.reverse ? (\n              <div>\n                {innerNode}\n                {propsNode}\n              </div>\n            ) : (\n              <div>\n                {propsNode}\n                {innerNode}\n              </div>\n            );\n        }\n        return null;\n      };\n      const isColumnController = !!(columnController.value && Object.keys(columnController.value).length);\n      // @ts-ignore\n      const placement = isColumnController ? columnController.value.placement || 'top-right' : '';\n      const isBottomController = isColumnController && placement?.indexOf('bottom') !== -1;\n      const topContent = formatNode('topContent', renderColumnController, isColumnController && !isBottomController);\n      const bottomContent = formatNode('bottomContent', renderColumnController, isBottomController, {\n        reverse: true,\n      });\n      const firstFullRow = formatNode('firstFullRow', renderFirstFilterRow, !hasEmptyCondition.value);\n      const lastFullRow = formatNode('lastFullRow', renderAsyncLoading, !!props.asyncLoading);\n\n      const baseTableProps = {\n        ...omit(props, OMIT_PROPS),\n        rowClassName: tRowClassNames.value,\n        rowAttributes: tRowAttributes.value,\n        columns: tColumns.value,\n        topContent,\n        bottomContent,\n        firstFullRow,\n        lastFullRow,\n        onPageChange: onInnerPageChange,\n        renderExpandedRow: showExpandedRow.value ? renderExpandedRow : undefined,\n      };\n\n      if (props.expandOnRowClick) {\n        baseTableProps.onRowClick = onInnerExpandRowClick;\n      }\n\n      return (\n        // @ts-ignore\n        <BaseTable\n          ref={primaryTableRef}\n          v-slots={context.slots}\n          {...baseTableProps}\n          class={primaryTableClasses.value}\n          onLeafColumnsChange={setDragSortColumns}\n        />\n      );\n    };\n  },\n});\n"],"names":["OMIT_PROPS","defineComponent","name","props","baseTableProps","primaryTableProps","setup","context","renderTNode","useTNodeJSX","toRefs","columns","columnController","primaryTableRef","ref","useClassName","tableDraggableClasses","tableBaseClass","tableSelectedClasses","useColumnController","tDisplayColumns","renderColumnController","useRowExpand","showExpandedRow","showExpandIconColumn","getExpandColumn","renderExpandedRow","onInnerExpandRowClick","useSorter","renderSortIcon","useRowSelect","formatToRowSelectColumn","selectedRowClassNames","useFilter","hasEmptyCondition","isTableOverflowHidden","renderFilterIcon","renderFirstFilterRow","setFilterPrimaryTableRef","useDragSort","isRowHandlerDraggable","isRowDraggable","isColDraggable","setDragSortPrimaryTableRef","setDragSortColumns","useTableHeader","renderTitleWidthIcon","useAsyncLoading","renderAsyncLoading","useEditableRow","errorListMap","editableKeysMap","validateRowData","validateTableData","onRuleChange","clearValidateData","primaryTableClasses","computed","colDraggable","value","rowHandlerDraggable","rowDraggable","overflowVisible","tableRowEdit","editableRowKeys","tRowClassNames","tClassNames","rowClassName","filter","v","tRowAttributes","tAttributes","rowAttributes","push","row","get","rowKey","onMounted","expose","refreshTable","getColumns","arr","i","len","item","isDisplayColumn","children","length","includes","colKey","sorter","titleContent","renderTitle","slots","ellipsisTitle","title","h","p","sortIcon","filterIcon","attach","tableContentRef","col","colIndex","edit","component","oldCell","cell","cellProps","cellEmptyContent","onChange","onRowEdit","onValidate","onRowValidate","rowValue","editable","key","join","errorList","errors","editableCellState","readonly","_createVNode","tColumns","cols","unshift","onInnerPageChange","pageInfo","newData","onPageChange","changeParams","pagination","trigger","currentData","formatNode","api","renderInnerNode","condition","extra","innerNode","propsNode","reverse","isColumnController","Object","keys","placement","isBottomController","indexOf","topContent","bottomContent","firstFullRow","lastFullRow","asyncLoading","omit","expandOnRowClick","onRowClick","BaseTable","_mergeProps"],"mappings":"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"}