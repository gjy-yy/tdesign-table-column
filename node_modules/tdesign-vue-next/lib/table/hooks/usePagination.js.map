{"version":3,"file":"usePagination.js","sources":["../../../src/table/hooks/usePagination.tsx"],"sourcesContent":["import { ref, SetupContext, toRefs, watch } from 'vue';\nimport { useConfig } from '../../hooks/useConfig';\nimport Pagination, { PageInfo } from '../../pagination';\nimport { TdBaseTableProps, TableRowData } from '../type';\n\n// 分页功能包含：远程数据排序受控、远程数据排序非受控、本地数据排序受控、本地数据排序非受控 等 4 类功能\nexport default function usePagination(props: TdBaseTableProps) {\n  const { pagination, data, disableDataPage } = toRefs(props);\n  const { classPrefix } = useConfig();\n\n  const dataSource = ref<TableRowData[]>([]);\n  const isPaginateData = ref(false);\n\n  const updateDataSourceAndPaginate = (current = 1, pageSize = 10) => {\n    const { data } = props;\n    // data 数据数量超出分页大小时，则自动启动本地数据分页\n    const t = Boolean(!disableDataPage.value && data.length > pageSize);\n    isPaginateData.value = t;\n    if (t) {\n      const start = (current - 1) * pageSize;\n      const end = current * pageSize;\n      dataSource.value = data.slice(start, end);\n    } else {\n      dataSource.value = data;\n    }\n  };\n\n  // 受控情况，只有 pagination.current 或者 pagination.pageSize 变化，才对数据进行排序\n  watch(\n    () => [pagination.value?.current, pagination.value?.pageSize, data.value.length, disableDataPage],\n    () => {\n      if (!pagination.value || !pagination.value.current) return;\n      updateDataSourceAndPaginate(pagination.value.current, pagination.value.pageSize);\n    },\n    { immediate: true },\n  );\n\n  // 非受控情况，只执行一次 Props 数据更新（pagination.defaultCurrent 和 pagination.defaultPageSize）\n  watch(\n    [data],\n    () => {\n      if (!pagination.value || !pagination.value.defaultCurrent) return;\n      updateDataSourceAndPaginate(pagination.value.defaultCurrent, pagination.value.defaultPageSize);\n    },\n    { immediate: true },\n  );\n\n  const renderPagination = () => {\n    if (!props.pagination) return null;\n    const paginationProps = { ...props.pagination };\n    // Vue3，两个 onChange 事件绑定，会成为数组，因为需提前移除外部 onChange\n    delete paginationProps.onChange;\n    return (\n      <div class={`${classPrefix.value}-table__pagination`}>\n        <Pagination\n          {...paginationProps}\n          onChange={(pageInfo: PageInfo) => {\n            props.pagination?.onChange?.(pageInfo);\n            props.onPageChange?.(pageInfo, dataSource.value);\n            // 如果是非受控情况的分页变化，还需更新分页数据（data）\n            if (pagination && !pagination.value.current && pagination.value.defaultCurrent) {\n              updateDataSourceAndPaginate(pageInfo.current, pageInfo.pageSize);\n            }\n          }}\n        />\n      </div>\n    );\n  };\n\n  return {\n    isPaginateData,\n    dataSource,\n    renderPagination,\n  };\n}\n"],"names":["usePagination","props","toRefs","pagination","data","disableDataPage","useConfig","classPrefix","dataSource","ref","isPaginateData","updateDataSourceAndPaginate","current","pageSize","t","Boolean","value","length","start","end","slice","watch","immediate","defaultCurrent","defaultPageSize","renderPagination","paginationProps","onChange","_createVNode","_mergeProps","pageInfo","onPageChange"],"mappings":"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"}