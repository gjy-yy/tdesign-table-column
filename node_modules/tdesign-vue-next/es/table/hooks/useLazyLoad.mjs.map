{"version":3,"file":"useLazyLoad.mjs","sources":["../../../src/table/hooks/useLazyLoad.ts"],"sourcesContent":["import { ref, onMounted, computed, nextTick, Ref, UnwrapRef } from 'vue';\nimport observe from '../../_common/js/utils/observe';\nimport { isServer } from '../../utils/dom';\n\nexport type UseLazyLoadParams = UnwrapRef<{\n  type: 'lazy' | 'virtual';\n  rowIndex: number;\n  rowHeight?: number;\n  bufferSize?: number;\n}>;\n\nexport default function useLazyLoad(\n  containerRef: Ref<HTMLElement>,\n  childRef: Ref<HTMLTableRowElement>,\n  params: UseLazyLoadParams,\n) {\n  const tRowHeight = computed(() => Math.max(params.rowHeight || 48, 48));\n  const isInit = ref(params.rowIndex === 0);\n  const hasLazyLoadHolder = computed(() => params?.type === 'lazy' && !isInit.value);\n\n  const requestAnimationFrame = (!isServer && window.requestAnimationFrame) || ((cb) => setTimeout(cb, 16.6));\n\n  const init = () => {\n    if (!isInit.value) {\n      requestAnimationFrame(() => {\n        isInit.value = true;\n      });\n    }\n  };\n\n  onMounted(() => {\n    if (params?.type !== 'lazy') return;\n    nextTick(() => {\n      const bufferSize = Math.max(10, params.bufferSize || 10);\n      const height = tRowHeight.value * bufferSize;\n      observe(childRef.value, containerRef.value, init, height);\n    });\n  });\n\n  return {\n    hasLazyLoadHolder,\n    tRowHeight,\n  };\n}\n"],"names":["useLazyLoad","containerRef","childRef","params","tRowHeight","computed","Math","max","rowHeight","isInit","ref","rowIndex","hasLazyLoadHolder","type","value","requestAnimationFrame","isServer","window","cb","setTimeout","init","onMounted","nextTick","bufferSize","height","observe"],"mappings":";;;;;;;;;;;;;;;;;AAWwB,SAAAA,WAAA,CACtBC,YADsB,EAEtBC,QAFsB,EAGtBC,MAHsB,EAItB;EACM,IAAAC,UAAA,GAAaC,SAAS,YAAA;IAAA,OAAMC,IAAA,CAAKC,GAAL,CAASJ,MAAO,CAAAK,SAAP,IAAoB,EAA7B,EAAiC,EAAjC,CAAN,CAAA;AAAA,IAAtB,CAAA;EACN,IAAMC,MAAS,GAAAC,GAAA,CAAIP,MAAO,CAAAQ,QAAP,KAAoB,CAAxB,CAAf,CAAA;EACM,IAAAC,iBAAA,GAAoBP,SAAS,YAAA;AAAA,IAAA,OAAM,CAAAF,MAAA,KAAA,IAAA,IAAAA,MAAA,WAAA,GAAAA,KAAAA,CAAAA,GAAAA,MAAA,CAAQU,IAAR,MAAiB,MAAjB,IAA2B,CAACJ,OAAOK,KAAzC,CAAA;AAAA,IAA7B,CAAA;;EAEA,IAAAC,qBAAA,GAAyB,CAACC,QAAD,IAAaC,MAAA,CAAOF,qBAApB,IAA+C,UAACG,EAAD,EAAA;AAAA,IAAA,OAAQC,UAAW,CAAAD,EAAA,EAAI,IAAJ,CAAnB,CAAA;GAAxE,CAAA;;AAEN,EAAA,IAAME,OAAO,SAAPA,IAAO,GAAM;AACb,IAAA,IAAA,CAACX,OAAOK,KAAR,EAAe;AACjBC,MAAAA,qBAAA,CAAsB,YAAM;QAC1BN,MAAA,CAAOK,KAAP,GAAe,IAAf,CAAA;AACD,OAFD,CAAA,CAAA;AAGF,KAAA;GALF,CAAA;;AAQAO,EAAAA,SAAA,CAAU,YAAM;AACd,IAAA,IAAI,CAAAlB,WAAA,IAAA,IAAAA,iBAAA,GAAAA,KAAAA,CAAAA,GAAAA,OAAQU,IAAR,MAAiB,MAArB,EAA6B,OAAA;AAC7BS,IAAAA,QAAA,CAAS,YAAM;AACb,MAAA,IAAMC,aAAajB,IAAK,CAAAC,GAAL,CAAS,EAAT,EAAaJ,MAAA,CAAOoB,UAAP,IAAqB,EAAlC,CAAnB,CAAA;AACM,MAAA,IAAAC,MAAA,GAASpB,WAAWU,KAAX,GAAmBS,UAA5B,CAAA;AACNE,MAAAA,OAAA,CAAQvB,QAAS,CAAAY,KAAjB,EAAwBb,YAAa,CAAAa,KAArC,EAA4CM,IAA5C,EAAkDI,MAAlD,CAAA,CAAA;AACD,KAJD,CAAA,CAAA;AAKD,GAPD,CAAA,CAAA;EASO,OAAA;AACLZ,IAAAA,iBAAA,EAAAA,iBADK;AAELR,IAAAA,UAAA,EAAAA,UAAAA;GAFK,CAAA;AAIT;;;;"}