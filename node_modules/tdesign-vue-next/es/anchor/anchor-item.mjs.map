{"version":3,"file":"anchor-item.mjs","sources":["../../src/anchor/anchor-item.tsx"],"sourcesContent":["import { defineComponent, h, VNodeChild, onMounted, onUnmounted, inject, watch } from 'vue';\nimport { ANCHOR_SHARP_REGEXP } from './utils';\nimport props from './anchor-item-props';\nimport { usePrefixClass, useCommonClassName } from '../hooks/useConfig';\nimport { AnchorInjectionKey } from './constants';\n\nconst localProps = {\n  ...props,\n  href: {\n    type: String,\n    required: true,\n    validator(v: string): boolean {\n      return ANCHOR_SHARP_REGEXP.test(v);\n    },\n  },\n};\n\nexport default defineComponent({\n  name: 'TAnchorItem',\n  inject: {\n    tAnchor: { default: undefined },\n  },\n  props: localProps,\n  setup(props, { slots }) {\n    const anchor = inject(AnchorInjectionKey, undefined);\n    const CLASSNAME_PREFIX = usePrefixClass('anchor__item');\n    const { STATUS } = useCommonClassName();\n    const register = () => {\n      anchor.registerLink(props.href as string);\n    };\n    const unregister = () => {\n      const { href } = props;\n      if (!href) return;\n      anchor.unregisterLink(href);\n    };\n    const handleClick = (e: MouseEvent) => {\n      const { href, title } = props;\n      anchor.handleScrollTo(href);\n      anchor.handleLinkClick({ href, title: typeof title === 'string' ? title : undefined, e });\n    };\n    const renderTitle = () => {\n      const { title } = props;\n      const { title: titleSlot } = slots;\n      let titleVal: VNodeChild;\n      if (typeof title === 'string') {\n        titleVal = title;\n      } else if (typeof title === 'function') {\n        titleVal = title(h);\n      } else if (titleSlot) {\n        titleVal = titleSlot(null);\n      }\n      return titleVal;\n    };\n    watch(\n      () => props.href,\n      () => {\n        unregister();\n        register();\n      },\n      { immediate: true },\n    );\n    onMounted(() => {\n      register();\n    });\n    onUnmounted(() => {\n      register();\n    });\n    return () => {\n      const { href, target } = props;\n      const { default: children, title: titleSlot } = slots;\n      const title = renderTitle();\n      const titleAttr = typeof title === 'string' ? title : null;\n      const active = anchor.active === href;\n      const wrapperClass = {\n        [CLASSNAME_PREFIX.value]: true,\n        [STATUS.value.active]: active,\n      };\n      const titleClass = {\n        [`${CLASSNAME_PREFIX.value}-link`]: true,\n      };\n      return (\n        <div class={wrapperClass}>\n          <a href={href} title={titleAttr} class={titleClass} target={target} onClick={handleClick}>\n            {titleSlot ? titleSlot(null) : title}\n          </a>\n          {children && children(null)}\n        </div>\n      );\n    };\n  },\n});\n"],"names":["localProps","props","href","type","String","required","validator","v","ANCHOR_SHARP_REGEXP","test","defineComponent","name","inject","tAnchor","setup","slots","anchor","AnchorInjectionKey","CLASSNAME_PREFIX","usePrefixClass","useCommonClassName","STATUS","register","registerLink","unregister","unregisterLink","handleClick","e","title","handleScrollTo","handleLinkClick","renderTitle","titleSlot","titleVal","h","watch","immediate","onMounted","onUnmounted","target","children","titleAttr","active","wrapperClass","value","titleClass","_createVNode"],"mappings":"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"}