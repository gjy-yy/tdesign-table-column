{"version":3,"file":"draggable.mjs","sources":["../../../../src/_common/js/color-picker/draggable.ts"],"sourcesContent":["/* eslint-disable no-use-before-define */\nexport interface Coordinate {\n  x: number;\n  y: number;\n}\n\nexport type DraggableEvent = MouseEvent;\n\ninterface DraggableCallback {\n  (coordinate: Coordinate, event?: DraggableEvent): void;\n}\n\nexport interface DraggableProps {\n  start?: DraggableCallback;\n  drag?: DraggableCallback;\n  end?: DraggableCallback;\n}\n\ninterface DraggableHandles {\n  start: (this: Draggable, event: DraggableEvent) => {};\n  drag: (this: Draggable, event: DraggableEvent) => {};\n  end: (this: Draggable, event: DraggableEvent) => {};\n}\n\n// 配置项\nconst defaultsOptions: DraggableProps = {\n  start: (coordinate: Coordinate, event: DraggableEvent) => {},\n  drag: (coordinate: Coordinate, event: DraggableEvent) => {},\n  end: (coordinate: Coordinate, event: DraggableEvent) => {},\n};\n\nexport class Draggable {\n  private dragging = false;\n\n  private $el: HTMLElement;\n\n  private props: DraggableProps;\n\n  private handles: DraggableHandles;\n\n  constructor(el: HTMLElement, options?: DraggableProps) {\n    this.$el = el;\n    this.props = { ...defaultsOptions, ...options };\n    this.handles = {\n      start: this.#dragStart.bind(this),\n      drag: this.#drag.bind(this),\n      end: this.#dragEnd.bind(this),\n    };\n    this.$el.addEventListener('mousedown', this.handles.start, false);\n  }\n\n  #dragStart(event: DraggableEvent) {\n    if (this.dragging) {\n      return;\n    }\n    // event.preventDefault();\n    window.addEventListener('mousemove', this.handles.drag, false);\n    window.addEventListener('mouseup', this.handles.end, false);\n    window.addEventListener('contextmenu', this.handles.end, false);\n    this.dragging = true;\n    this.props.start(this.#getCoordinate(event), event);\n  }\n\n  #drag(event: DraggableEvent) {\n    if (!this.dragging) {\n      return;\n    }\n    this.props.drag(this.#getCoordinate(event), event);\n  }\n\n  #dragEnd(event: DraggableEvent) {\n    setTimeout(() => {\n      this.dragging = false;\n      this.props.end(this.#getCoordinate(event), event);\n    }, 0);\n    window.removeEventListener('mousemove', this.handles.drag, false);\n    window.removeEventListener('mouseup', this.handles.end, false);\n    window.removeEventListener('contextmenu', this.handles.end, false);\n  }\n\n  #getCoordinate(event: DraggableEvent) {\n    const rect = this.$el.getBoundingClientRect();\n    const mouseEvent = event;\n    const left = mouseEvent.clientX - rect.left;\n    const top = mouseEvent.clientY - rect.top;\n    return {\n      y: Math.min(Math.max(0, top), rect.height),\n      x: Math.min(Math.max(0, left), rect.width),\n    };\n  }\n\n  destroy() {\n    this.$el.removeEventListener('mousedown', this.handles.start, false);\n    window.removeEventListener('mousemove', this.handles.drag, false);\n    window.removeEventListener('mouseup', this.handles.end, false);\n    window.removeEventListener('contextmenu', this.handles.end, false);\n  }\n}\n\nexport default Draggable;\n"],"names":["defaultsOptions","start","coordinate","event","drag","end","Draggable","el","options","$el","props","handles","bind","addEventListener","removeEventListener","window","dragging","setTimeout","rect","getBoundingClientRect","mouseEvent","left","clientX","top","clientY","y","Math","min","max","height","x","width"],"mappings":"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"}