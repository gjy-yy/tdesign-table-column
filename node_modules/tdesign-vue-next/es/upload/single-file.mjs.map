{"version":3,"file":"single-file.mjs","sources":["../../src/upload/single-file.tsx"],"sourcesContent":["import { defineComponent, PropType, computed } from 'vue';\n\nimport {\n  CloseCircleFilledIcon as TdCloseCircleFilledIcon,\n  ErrorCircleFilledIcon as TdErrorCircleFilledIcon,\n  CheckCircleFilledIcon as TdCheckCircleFilledIcon,\n} from 'tdesign-icons-vue-next';\n\nimport TLoading from '../loading';\nimport props from './props';\nimport { UploadFile } from './type';\nimport { abridgeName } from './util';\n\nimport { useTNodeJSX } from '../hooks/tnode';\nimport { useGlobalIcon } from '../hooks/useGlobalIcon';\nimport { useConfig, usePrefixClass } from '../hooks/useConfig';\n\nconst SingleFileProps = {\n  file: {\n    type: Object as PropType<UploadFile>,\n    default: () => {\n      return null as UploadFile;\n    },\n  },\n  loadingFile: {\n    type: Object as PropType<UploadFile>,\n    default: () => {\n      return null as UploadFile;\n    },\n  },\n  percent: {\n    type: Number,\n  },\n  showUploadProgress: props.showUploadProgress,\n  theme: props.theme,\n  placeholder: props.placeholder,\n  onRemove: Function as PropType<(e: MouseEvent) => void>,\n};\n\nexport default defineComponent({\n  name: 'TUploadSingleFile',\n\n  props: SingleFileProps,\n\n  setup(props) {\n    const renderTNodeJSX = useTNodeJSX();\n    const { classPrefix: prefix } = useConfig('upload');\n    const UPLOAD_NAME = usePrefixClass('upload');\n    const { CloseCircleFilledIcon, ErrorCircleFilledIcon, CheckCircleFilledIcon } = useGlobalIcon({\n      CloseCircleFilledIcon: TdCloseCircleFilledIcon,\n      ErrorCircleFilledIcon: TdErrorCircleFilledIcon,\n      CheckCircleFilledIcon: TdCheckCircleFilledIcon,\n    });\n\n    const showProgress = computed(() => {\n      return !!(props.loadingFile && props.loadingFile.status === 'progress');\n    });\n\n    const inputName = computed(() => {\n      const fileName = props.file && props.file.name;\n      const loadingName = props.loadingFile && props.loadingFile.name;\n      return showProgress.value ? loadingName : fileName;\n    });\n    const inputText = computed(() => {\n      return inputName.value || props.placeholder;\n    });\n    const inputTextClass = computed(() => {\n      return [`${prefix.value}-input__inner`, { [`${UPLOAD_NAME.value}__placeholder`]: !inputName.value }];\n    });\n    const classes = computed(() => {\n      return [`${UPLOAD_NAME.value}__single`, `${UPLOAD_NAME.value}__single-${props.theme}`];\n    });\n\n    const renderProgress = () => {\n      if (props.loadingFile.status === 'fail') {\n        return <ErrorCircleFilledIcon />;\n      }\n\n      if (props.showUploadProgress) {\n        return (\n          <div class={`${UPLOAD_NAME.value}__single-progress`}>\n            <TLoading />\n            <span class={`${UPLOAD_NAME.value}__single-percent`}>{Math.min(props.percent, 99)}%</span>\n          </div>\n        );\n      }\n    };\n\n    // 文本型预览\n    const renderFilePreviewAsText = () => {\n      if (!inputName.value || props.theme !== 'file') return;\n      return (\n        <div class={`${UPLOAD_NAME.value}__single-display-text ${UPLOAD_NAME.value}__display-text--margin`}>\n          <span class={`${UPLOAD_NAME.value}__single-name`}>{inputName.value}</span>\n          {showProgress.value ? (\n            renderProgress()\n          ) : (\n            <CloseCircleFilledIcon\n              class={`${UPLOAD_NAME.value}__icon-delete`}\n              onClick={({ e }: { e: MouseEvent }) => props.onRemove(e)}\n            />\n          )}\n        </div>\n      );\n    };\n\n    // 输入框型预览\n    const renderFilePreviewAsInput = () => {\n      if (props.theme !== 'file-input') return;\n      const renderResult = () => {\n        if (!!props.loadingFile && props.loadingFile.status === 'fail') {\n          return <ErrorCircleFilledIcon />;\n        }\n        if (props.file && props.file.name && !props.loadingFile) {\n          return <CheckCircleFilledIcon />;\n        }\n        return '';\n      };\n\n      return (\n        <div class={`${UPLOAD_NAME.value}__single-input-preview ${prefix.value}-input`}>\n          <div class={inputTextClass.value}>\n            {<span class={`${UPLOAD_NAME.value}__single-input-text`}>{abridgeName(inputText.value, 4, 6)}</span>}\n            {showProgress.value && renderProgress()}\n            {renderResult()}\n          </div>\n        </div>\n      );\n    };\n\n    return () => (\n      <div class={classes.value}>\n        {renderFilePreviewAsInput()}\n        {renderTNodeJSX('default')}\n        {renderFilePreviewAsText()}\n      </div>\n    );\n  },\n});\n"],"names":["SingleFileProps","file","type","Object","loadingFile","percent","Number","showUploadProgress","props","theme","placeholder","onRemove","Function","defineComponent","name","setup","renderTNodeJSX","useTNodeJSX","useConfig","prefix","classPrefix","UPLOAD_NAME","usePrefixClass","useGlobalIcon","CloseCircleFilledIcon","TdCloseCircleFilledIcon","ErrorCircleFilledIcon","TdErrorCircleFilledIcon","CheckCircleFilledIcon","TdCheckCircleFilledIcon","showProgress","computed","status","inputName","fileName","loadingName","value","inputText","inputTextClass","classes","renderProgress","_createVNode","TLoading","Math","min","renderFilePreviewAsText","e","renderFilePreviewAsInput","renderResult","abridgeName"],"mappings":"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"}