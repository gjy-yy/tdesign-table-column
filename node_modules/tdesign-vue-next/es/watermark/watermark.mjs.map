{"version":3,"file":"watermark.mjs","sources":["../../src/watermark/watermark.tsx"],"sourcesContent":["import { computed, onMounted, defineComponent, h, VNode, ref, reactive } from 'vue';\nimport props from './props';\nimport generateBase64Url from '../_common/js/watermark/generateBase64Url';\nimport randomMovingStyle from '../_common/js/watermark/randomMovingStyle';\nimport injectStyle from '../_common/js/utils/injectStyle';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useMutationObserver } from './hooks';\nimport { useContent } from '../hooks/tnode';\n\nexport default defineComponent({\n  name: 'TWatermark',\n  props,\n  setup(props) {\n    const backgroundImage = ref('');\n    const watermarkRef = ref<HTMLElement>();\n    const watermarkContentRef = ref<HTMLElement>();\n    const parent = ref<HTMLElement>();\n\n    const offset = reactive(props.offset || []);\n\n    const gapX = computed(() => {\n      return props.movable ? 0 : props.x;\n    });\n\n    const gapY = computed(() => {\n      return props.movable ? 0 : props.y;\n    });\n\n    const rotate = computed(() => {\n      return props.movable ? 0 : props.rotate;\n    });\n\n    const backgroundRepeat = computed(() => {\n      if (props.movable) {\n        return 'no-repeat';\n      }\n      return props.isRepeat ? 'repeat' : 'no-repeat';\n    });\n\n    const offsetLeft = computed(() => {\n      return offset[0] || gapX.value / 2;\n    });\n\n    const offsetTop = computed(() => {\n      return offset[1] || gapY.value / 2;\n    });\n\n    const bgImageOptions = {\n      width: props.width,\n      height: props.height,\n      rotate: rotate.value,\n      lineSpace: props.lineSpace,\n      alpha: props.alpha,\n      gapX: gapX.value,\n      gapY: gapY.value,\n      watermarkContent: props.watermarkContent,\n      offsetLeft: offsetLeft.value,\n      offsetTop: offsetTop.value,\n    };\n\n    onMounted(() => {\n      generateBase64Url(bgImageOptions, (base64Url) => {\n        backgroundImage.value = base64Url;\n      });\n      parent.value = watermarkRef.value.parentElement;\n      const keyframesStyle = randomMovingStyle();\n      injectStyle(keyframesStyle);\n\n      useMutationObserver(\n        parent.value,\n        (mutations) => {\n          if (props.removable) return;\n          mutations.forEach((mutation) => {\n            if (mutation.type === 'childList') {\n              const removeNodes = mutation.removedNodes;\n              removeNodes.forEach((node) => {\n                const element = node as HTMLElement;\n                if (element === watermarkRef.value) {\n                  parent.value.appendChild(element);\n                }\n                if (element === watermarkContentRef.value) {\n                  watermarkRef.value.appendChild(element);\n                }\n              });\n            }\n          });\n        },\n        {\n          attributes: true,\n          childList: true,\n          characterData: true,\n          subtree: true,\n        },\n      );\n    });\n\n    return {\n      gapX,\n      gapY,\n      backgroundRepeat,\n      backgroundImage,\n      watermarkRef,\n      watermarkContentRef,\n      bgImageOptions,\n    };\n  },\n\n  render() {\n    const COMPONENT_NAME = usePrefixClass('watermark');\n    const renderContent = useContent();\n\n    return (\n      <div\n        style={{ position: 'relative', overflow: 'hidden', width: '100%' }}\n        class={COMPONENT_NAME.value}\n        ref=\"watermarkRef\"\n      >\n        {renderContent('default', 'content')}\n        <div\n          ref=\"watermarkContentRef\"\n          style={{\n            zIndex: this.zIndex,\n            position: 'absolute',\n            left: 0,\n            right: 0,\n            top: 0,\n            bottom: 0,\n            width: '100%',\n            height: '100%',\n            backgroundSize: `${this.gapX + this.width}px`,\n            pointerEvents: 'none',\n            backgroundRepeat: this.backgroundRepeat,\n            backgroundImage: `url('${this.backgroundImage}')`,\n            animation: this.movable ? `watermark infinite ${(this.moveInterval * 4) / 60}s` : 'none',\n          }}\n        />\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","setup","backgroundImage","ref","watermarkRef","watermarkContentRef","parent","offset","reactive","gapX","computed","movable","x","gapY","y","rotate","backgroundRepeat","isRepeat","offsetLeft","value","offsetTop","bgImageOptions","width","height","lineSpace","alpha","watermarkContent","onMounted","generateBase64Url","base64Url","parentElement","keyframesStyle","randomMovingStyle","injectStyle","useMutationObserver","mutations","removable","forEach","mutation","type","removeNodes","removedNodes","node","element","appendChild","attributes","childList","characterData","subtree","render","COMPONENT_NAME","usePrefixClass","renderContent","useContent","_createVNode","position","overflow","zIndex","left","right","top","bottom","backgroundSize","pointerEvents","animation","moveInterval"],"mappings":"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"}