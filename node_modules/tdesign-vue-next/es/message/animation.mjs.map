{"version":3,"file":"animation.mjs","sources":["../../src/message/animation.ts"],"sourcesContent":["import { PLACEMENT_LIST } from './const';\n\ninterface Keyframe {\n  composite?: CompositeOperationOrAuto;\n  easing?: string;\n  offset?: number | null;\n  [property: string]: string | number | null | undefined;\n}\ntype CompositeOperationOrAuto = 'accumulate' | 'add' | 'auto' | 'replace';\n\nconst ANIMATION_OPTION = {\n  duration: 200,\n  easing: 'linear',\n};\n\nfunction fadeIn(dom: HTMLElement, placement: string) {\n  if (!dom) return;\n  const offsetWidth = dom?.offsetWidth || 0;\n  const offsetHeight = dom?.offsetHeight || 0;\n  const fadeInKeyframes: Array<Keyframe> | null = getFadeInKeyframes(placement, offsetWidth, offsetHeight);\n  if (!fadeInKeyframes) return;\n  const styleAfterFadeIn = fadeInKeyframes[fadeInKeyframes.length - 1];\n  setDomStyleAfterAnimation(dom, styleAfterFadeIn);\n  dom.animate && dom.animate(fadeInKeyframes, ANIMATION_OPTION);\n}\n\nfunction fadeOut(dom: HTMLElement, placement: string, onFinish: Function) {\n  if (!dom) return;\n  const offsetHeight = dom?.offsetHeight || 0;\n  const fadeOutKeyframes: Array<Keyframe> | null = getFadeOutKeyframes(placement, offsetHeight);\n  if (!fadeOutKeyframes) return onFinish();\n  const styleAfterFadeOut = fadeOutKeyframes[fadeOutKeyframes.length - 1];\n  setDomStyleAfterAnimation(dom, styleAfterFadeOut);\n\n  const animation = dom.animate && dom.animate(fadeOutKeyframes, ANIMATION_OPTION);\n  if (animation) {\n    animation.onfinish = () => {\n      // eslint-disable-next-line no-param-reassign\n      dom.style.display = 'none';\n      onFinish();\n    };\n  } else {\n    // eslint-disable-next-line no-param-reassign\n    dom.style.display = 'none';\n    onFinish();\n  }\n}\n\nfunction setDomStyleAfterAnimation(dom: HTMLElement, styleAfterAnimation: Keyframe) {\n  const keys = Object.keys(styleAfterAnimation);\n  for (let i = 0; i < keys.length; i += 1) {\n    const key = keys[i];\n    // eslint-disable-next-line no-param-reassign\n    dom.style[key] = styleAfterAnimation[key];\n  }\n}\n\nfunction getFadeInKeyframes(placement: string, offsetWidth: Number, offsetHeight: Number): Array<Keyframe> | null {\n  if (!PLACEMENT_LIST.includes(placement)) return null;\n  if (['top-left', 'left', 'bottom-left'].includes(placement)) {\n    return [\n      { opacity: 0, marginLeft: `-${offsetWidth}px` },\n      { opacity: 1, marginLeft: '0' },\n    ];\n  }\n  if (['top-right', 'right', 'bottom-right'].includes(placement)) {\n    return [\n      { opacity: 0, marginRight: `-${offsetWidth}px` },\n      { opacity: 1, marginRight: '0' },\n    ];\n  }\n  if (['top', 'center'].includes(placement)) {\n    return [\n      { opacity: 0, marginTop: `-${offsetHeight}px` },\n      { opacity: 1, marginTop: '0' },\n    ];\n  }\n  if (['bottom'].includes(placement)) {\n    return [\n      { opacity: 0, transform: `translate3d(0, ${offsetHeight}px, 0)` },\n      { opacity: 1, transform: 'translate3d(0, 0, 0)' },\n    ];\n  }\n}\n\nfunction getFadeOutKeyframes(placement: string, offsetHeight: Number): Array<Keyframe> | null {\n  if (!PLACEMENT_LIST.includes(placement)) return null;\n  if (['bottom-left', 'bottom', 'bottom-right'].includes(placement)) {\n    const marginOffset = `${offsetHeight}px`;\n    return [\n      { opacity: 1, marginTop: '0px' },\n      { opacity: 0, marginTop: marginOffset },\n    ];\n  }\n  const marginOffset = `-${offsetHeight}px`;\n  return [\n    { opacity: 1, marginTop: '0px' },\n    { opacity: 0, marginTop: marginOffset },\n  ];\n}\n\nexport { fadeIn, fadeOut };\n"],"names":["ANIMATION_OPTION","duration","easing","fadeIn","dom","placement","offsetWidth","offsetHeight","fadeInKeyframes","getFadeInKeyframes","styleAfterFadeIn","length","setDomStyleAfterAnimation","animate","fadeOut","onFinish","fadeOutKeyframes","getFadeOutKeyframes","styleAfterFadeOut","animation","onfinish","style","display","styleAfterAnimation","keys","Object","i","key","PLACEMENT_LIST","includes","opacity","marginLeft","marginRight","marginTop","transform","marginOffset"],"mappings":";;;;;;;;AAUA,IAAMA,gBAAmB,GAAA;AACvBC,EAAAA,QAAU,EAAA,GADa;AAEvBC,EAAAA,MAAQ,EAAA,QAAA;AAFe,CAAzB,CAAA;;AAKA,SAASC,MAAT,CAAgBC,GAAhB,EAAkCC,SAAlC,EAAqD;EACnD,IAAI,CAACD,GAAL,EAAU,OAAA;AACJ,EAAA,IAAAE,WAAA,GAAc,CAAAF,QAAA,IAAA,IAAAA,cAAA,GAAAA,KAAAA,CAAAA,GAAAA,IAAKE,WAAL,KAAoB,CAAlC,CAAA;AACA,EAAA,IAAAC,YAAA,GAAe,CAAAH,QAAA,IAAA,IAAAA,cAAA,GAAAA,KAAAA,CAAAA,GAAAA,IAAKG,YAAL,KAAqB,CAApC,CAAA;EACN,IAAMC,eAA0C,GAAAC,kBAAA,CAAmBJ,SAAnB,EAA8BC,WAA9B,EAA2CC,YAA3C,CAAhD,CAAA;EACA,IAAI,CAACC,eAAL,EAAsB,OAAA;EAChB,IAAAE,gBAAA,GAAmBF,eAAgB,CAAAA,eAAA,CAAgBG,MAAhB,GAAyB,CAAzB,CAAnC,CAAA;AACNC,EAAAA,yBAAA,CAA0BR,GAA1B,EAA+BM,gBAA/B,CAAA,CAAA;EACAN,GAAA,CAAIS,OAAJ,IAAeT,GAAA,CAAIS,OAAJ,CAAYL,eAAZ,EAA6BR,gBAA7B,CAAf,CAAA;AACF,CAAA;;AAEA,SAASc,OAAT,CAAiBV,GAAjB,EAAmCC,SAAnC,EAAsDU,QAAtD,EAA0E;EACxE,IAAI,CAACX,GAAL,EAAU,OAAA;AACJ,EAAA,IAAAG,YAAA,GAAe,CAAAH,QAAA,IAAA,IAAAA,cAAA,GAAAA,KAAAA,CAAAA,GAAAA,IAAKG,YAAL,KAAqB,CAApC,CAAA;AACA,EAAA,IAAAS,gBAAA,GAA2CC,mBAAoB,CAAAZ,SAAA,EAAWE,YAAX,CAA/D,CAAA;AACN,EAAA,IAAI,CAACS,gBAAL,EAAuB,OAAOD,QAAS,EAAhB,CAAA;EACjB,IAAAG,iBAAA,GAAoBF,gBAAiB,CAAAA,gBAAA,CAAiBL,MAAjB,GAA0B,CAA1B,CAArC,CAAA;AACNC,EAAAA,yBAAA,CAA0BR,GAA1B,EAA+Bc,iBAA/B,CAAA,CAAA;AAEA,EAAA,IAAMC,YAAYf,GAAI,CAAAS,OAAJ,IAAeT,GAAI,CAAAS,OAAJ,CAAYG,gBAAZ,EAA8BhB,gBAA9B,CAAjC,CAAA;;AACA,EAAA,IAAImB,SAAJ,EAAe;IACbA,SAAA,CAAUC,QAAV,GAAqB,YAAM;AAEzBhB,MAAAA,GAAA,CAAIiB,KAAJ,CAAUC,OAAV,GAAoB,MAApB,CAAA;MACSP,QAAA,EAAA,CAAA;KAHX,CAAA;AAKK,GANP,MAMO;AAELX,IAAAA,GAAA,CAAIiB,KAAJ,CAAUC,OAAV,GAAoB,MAApB,CAAA;IACSP,QAAA,EAAA,CAAA;AACX,GAAA;AACF,CAAA;;AAEA,SAASH,yBAAT,CAAmCR,GAAnC,EAAqDmB,mBAArD,EAAoF;AAC5E,EAAA,IAAAC,IAAA,GAAOC,MAAO,CAAAD,IAAP,CAAYD,mBAAZ,CAAP,CAAA;;AACN,EAAA,KAAA,IAASG,IAAI,CAAb,EAAgBA,CAAA,GAAIF,IAAK,CAAAb,MAAzB,EAAiCe,KAAK,CAAtC,EAAyC;AACvC,IAAA,IAAMC,MAAMH,IAAK,CAAAE,CAAA,CAAjB,CAAA;IAEItB,GAAA,CAAAiB,KAAA,CAAMM,GAAN,IAAaJ,mBAAoB,CAAAI,GAAA,CAAjC,CAAA;AACN,GAAA;AACF,CAAA;;AAEA,SAASlB,kBAAT,CAA4BJ,SAA5B,EAA+CC,WAA/C,EAAoEC,YAApE,EAAkH;EAC5G,IAAA,CAACqB,cAAe,CAAAC,QAAf,CAAwBxB,SAAxB,CAAD,EAA4C,OAAA,IAAA,CAAA;;EAChD,IAAI,CAAC,UAAD,EAAa,MAAb,EAAqB,aAArB,CAAA,CAAoCwB,QAApC,CAA6CxB,SAA7C,CAAJ,EAA6D;AACpD,IAAA,OAAA,CACL;AAAEyB,MAAAA,OAAA,EAAS,CAAX;AAAcC,MAAAA,UAAA,aAAgBzB,WAAhB,EAAA,IAAA,CAAA;AAAd,KADK,EAEL;AAAEwB,MAAAA,OAAA,EAAS,CAAX;AAAcC,MAAAA,UAAA,EAAY,GAAA;AAA1B,KAFK,CAAA,CAAA;AAIT,GAAA;;EACA,IAAI,CAAC,WAAD,EAAc,OAAd,EAAuB,cAAvB,CAAA,CAAuCF,QAAvC,CAAgDxB,SAAhD,CAAJ,EAAgE;AACvD,IAAA,OAAA,CACL;AAAEyB,MAAAA,OAAA,EAAS,CAAX;AAAcE,MAAAA,WAAA,aAAiB1B,WAAjB,EAAA,IAAA,CAAA;AAAd,KADK,EAEL;AAAEwB,MAAAA,OAAA,EAAS,CAAX;AAAcE,MAAAA,WAAA,EAAa,GAAA;AAA3B,KAFK,CAAA,CAAA;AAIT,GAAA;;EACA,IAAI,CAAC,KAAD,EAAQ,QAAR,EAAkBH,QAAlB,CAA2BxB,SAA3B,CAAJ,EAA2C;AAClC,IAAA,OAAA,CACL;AAAEyB,MAAAA,OAAA,EAAS,CAAX;AAAcG,MAAAA,SAAA,aAAe1B,YAAf,EAAA,IAAA,CAAA;AAAd,KADK,EAEL;AAAEuB,MAAAA,OAAA,EAAS,CAAX;AAAcG,MAAAA,SAAA,EAAW,GAAA;AAAzB,KAFK,CAAA,CAAA;AAIT,GAAA;;AACA,EAAA,IAAI,CAAC,QAAD,CAAA,CAAWJ,QAAX,CAAoBxB,SAApB,CAAJ,EAAoC;AAC3B,IAAA,OAAA,CACL;AAAEyB,MAAAA,OAAA,EAAS,CAAX;AAAcI,MAAAA,SAAA,2BAA6B3B,YAA7B,EAAA,QAAA,CAAA;AAAd,KADK,EAEL;AAAEuB,MAAAA,OAAA,EAAS,CAAX;AAAcI,MAAAA,SAAA,EAAW,sBAAA;AAAzB,KAFK,CAAA,CAAA;AAIT,GAAA;AACF,CAAA;;AAEA,SAASjB,mBAAT,CAA6BZ,SAA7B,EAAgDE,YAAhD,EAA8F;EACxF,IAAA,CAACqB,cAAe,CAAAC,QAAf,CAAwBxB,SAAxB,CAAD,EAA4C,OAAA,IAAA,CAAA;;EAChD,IAAI,CAAC,aAAD,EAAgB,QAAhB,EAA0B,cAA1B,CAAA,CAA0CwB,QAA1C,CAAmDxB,SAAnD,CAAJ,EAAmE;IACjE,IAAM8B,gBAAkB5B,EAAAA,CAAAA,MAAAA,CAAAA,cAAxB,IAAA,CAAA,CAAA;AACO,IAAA,OAAA,CACL;AAAEuB,MAAAA,OAAA,EAAS,CAAX;AAAcG,MAAAA,SAAA,EAAW,KAAA;AAAzB,KADK,EAEL;AAAEH,MAAAA,OAAA,EAAS,CAAX;AAAcG,MAAAA,SAAA,EAAWE,aAAAA;AAAzB,KAFK,CAAA,CAAA;AAIT,GAAA;;EACA,IAAMA,eAAmB5B,GAAAA,CAAAA,MAAAA,CAAAA,cAAzB,IAAA,CAAA,CAAA;AACO,EAAA,OAAA,CACL;AAAEuB,IAAAA,OAAA,EAAS,CAAX;AAAcG,IAAAA,SAAA,EAAW,KAAA;AAAzB,GADK,EAEL;AAAEH,IAAAA,OAAA,EAAS,CAAX;AAAcG,IAAAA,SAAA,EAAWE,YAAAA;AAAzB,GAFK,CAAA,CAAA;AAIT;;;;"}