{"version":3,"file":"plugin.mjs","sources":["../../src/message/plugin.tsx"],"sourcesContent":["/**\n * Vue.prototype.$message = MessagePlugin;\n *\n * this.$message({ theme: 'info', default: '这是信息', duration: 3000 })\n * this.$message.info('这是信息')\n * this.$message.info('这是信息', 3000)\n * this.$message.info({ content: '这是信息', duration: 3000 })\n * this.$message.success({ content: '这是信息', duration: 3000 })\n * this.$message.warning()\n * this.$message.error()\n * this.$message.question()\n * this.$message.loading()\n * 上述函数返回值：promise: Promise<{close: Function}>\n *\n * // close all message\n * this.$message.closeAll()\n *\n * // close one message. 参数 p 为 this.$message 系列函数返回值，promise: Promise<{close: Function}>\n * this.$message.close(p)\n *\n * // close one message.\n * const msg = this.$message.info({ content: '这是信息', duration: 0 })\n * msg.then(instance => instance.close())\n *\n */\nimport { App, createApp, nextTick, Plugin, ComponentPublicInstance } from 'vue';\nimport MessageList, { DEFAULT_Z_INDEX } from './messageList';\nimport { getAttach } from '../utils/dom';\nimport {\n  MessageOptions,\n  MessageMethod,\n  MessageInstance,\n  MessageInfoMethod,\n  MessageErrorMethod,\n  MessageWarningMethod,\n  MessageSuccessMethod,\n  MessageLoadingMethod,\n  MessageQuestionMethod,\n  MessageCloseMethod,\n  MessageCloseAllMethod,\n} from './type';\nimport { AttachNodeReturnValue } from '../common';\n\n// 存储不同 attach 和 不同 placement 消息列表实例\nconst instanceMap: Map<AttachNodeReturnValue, Record<string, ComponentPublicInstance>> = new Map();\n\nfunction handleParams(params: MessageOptions): MessageOptions {\n  const options: MessageOptions = {\n    duration: 3000,\n    attach: 'body',\n    zIndex: DEFAULT_Z_INDEX,\n    placement: 'top',\n    ...params,\n  };\n  options.content = params.content;\n  return options;\n}\n\nconst MessageFunction = (props: MessageOptions): Promise<MessageInstance> => {\n  const options = handleParams(props);\n  const { attach, placement } = options;\n  const attachDom = getAttach(attach);\n  if (!instanceMap.get(attachDom)) {\n    instanceMap.set(attachDom, {});\n  }\n  const p = instanceMap.get(attachDom)[placement];\n  if (!p) {\n    const wrapper = document.createElement('div');\n\n    const instance = createApp(MessageList, {\n      zIndex: options.zIndex,\n      placement: options.placement,\n    }).mount(wrapper);\n\n    instance.add(options);\n    instanceMap.get(attachDom)[placement] = instance;\n    attachDom.appendChild(wrapper);\n  } else {\n    p.add(options);\n  }\n  // 返回最新消息的 Element\n  return new Promise((resolve) => {\n    const ins = instanceMap.get(attachDom)[placement];\n    nextTick(() => {\n      const msg: Array<MessageInstance> = ins.messageList;\n      resolve(msg[msg.length - 1]);\n    });\n  });\n};\n\nconst showThemeMessage: MessageMethod = (theme, params, duration) => {\n  let options: MessageOptions = { theme };\n  if (typeof params === 'string') {\n    options.content = params;\n  } else if (typeof params === 'object' && !(params instanceof Array)) {\n    options = { ...options, ...params };\n  }\n  (duration || duration === 0) && (options.duration = duration);\n  return MessageFunction(options);\n};\n\ninterface ExtraApi {\n  info: MessageInfoMethod;\n  success: MessageSuccessMethod;\n  warning: MessageWarningMethod;\n  error: MessageErrorMethod;\n  question: MessageQuestionMethod;\n  loading: MessageLoadingMethod;\n  close: MessageCloseMethod;\n  closeAll: MessageCloseAllMethod;\n}\n\nexport type MessagePluginType = Plugin & ExtraApi & MessageMethod;\n\nconst extraApi: ExtraApi = {\n  info: (params, duration) => showThemeMessage('info', params, duration),\n  success: (params, duration) => showThemeMessage('success', params, duration),\n  warning: (params, duration) => showThemeMessage('warning', params, duration),\n  error: (params, duration) => showThemeMessage('error', params, duration),\n  question: (params, duration) => showThemeMessage('question', params, duration),\n  loading: (params, duration) => showThemeMessage('loading', params, duration),\n  close: (promise) => {\n    promise.then((instance) => instance.close());\n  },\n  closeAll: () => {\n    if (instanceMap instanceof Map) {\n      instanceMap.forEach((attach) => {\n        Object.keys(attach).forEach((placement) => {\n          const instance = attach[placement];\n          instance.list = [];\n        });\n      });\n    }\n  },\n};\n\nconst MessagePlugin: MessagePluginType = showThemeMessage as MessagePluginType;\n\nMessagePlugin.install = (app: App): void => {\n  app.config.globalProperties.$message = showThemeMessage;\n  // 这样定义后，可以通过 this.$message 调用插件\n  Object.keys(extraApi).forEach((funcName) => {\n    app.config.globalProperties.$message[funcName] = extraApi[funcName];\n  });\n};\n\n/**\n * 这样定义后，用户可以直接引入方法然后调用，示例如下：\n * import { showMessage } from 'message/index.ts';\n * showMessage();\n */\nObject.keys(extraApi).forEach((funcName) => {\n  MessagePlugin[funcName] = extraApi[funcName];\n});\n\nexport default MessagePlugin;\n"],"names":["instanceMap","Map","handleParams","params","options","duration","attach","zIndex","DEFAULT_Z_INDEX","placement","content","MessageFunction","props","attachDom","getAttach","get","set","p","wrapper","document","createElement","instance","createApp","MessageList","mount","add","appendChild","Promise","resolve","ins","nextTick","msg","messageList","length","showThemeMessage","theme","Array","extraApi","info","success","warning","error","question","loading","close","promise","then","closeAll","forEach","Object","keys","list","MessagePlugin","install","app","config","globalProperties","$message","funcName"],"mappings":"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"}