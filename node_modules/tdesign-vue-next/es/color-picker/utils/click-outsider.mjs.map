{"version":3,"file":"click-outsider.mjs","sources":["../../../src/color-picker/utils/click-outsider.ts"],"sourcesContent":["import { ComponentPublicInstance, VNode } from 'vue';\nimport { usePrefixClass } from '../../hooks/useConfig';\nimport { isServer, on } from '../../utils/dom';\n\ntype Handler = (...args: unknown[]) => unknown;\n\ninterface ElementHandler {\n  elements: HTMLElement[];\n  handler: Handler;\n}\n\ntype FlushList = Map<number, ElementHandler>;\n\nconst nodeList: FlushList = new Map();\n\nlet startClick: MouseEvent;\n\nlet uid = 0;\n\nif (!isServer && window.document) {\n  on(document, 'mousedown', (e: MouseEvent) => (startClick = e));\n  on(document, 'mouseup', (e: MouseEvent) => {\n    for (const { handler } of nodeList.values()) {\n      handler(e);\n    }\n  });\n}\n\ntype NodeElement = HTMLElement | VNode | ComponentPublicInstance;\n\nconst createDocumentHandler = (elements: HTMLElement[], handler: Handler, includePopup = true) => {\n  const POPUP_SELECTOR = usePrefixClass('popup');\n  return (e: MouseEvent) => {\n    if (includePopup) {\n      document.querySelectorAll(POPUP_SELECTOR.value).forEach((ele: Element) => {\n        elements.push(ele as HTMLElement);\n      });\n    }\n    elements = Array.from(new Set(elements));\n    const mouseUpTarget = e.target as Node;\n    const mouseDownTarget = startClick?.target as Node;\n    const isTargetUnExists = !mouseUpTarget || !mouseDownTarget;\n    if (isTargetUnExists) {\n      return;\n    }\n    const isContained = elements.some((el) => {\n      const isSelf = el === mouseUpTarget;\n      const isContainedByEl = el.contains(mouseUpTarget) || el.contains(mouseDownTarget);\n      return isSelf || isContainedByEl;\n    });\n    if (isContained) {\n      return;\n    }\n    handler();\n  };\n};\n\n/**\n * 元素外面点击\n *\n * @example\n *  onMounted(() => {\n *    // 确保元素已挂载\n *    addClickOutsider(refs.value, () => {\n *      visible.value = false\n *    });\n *  });\n *\n *  onBeforeUnmount(() => removeClickOutsider);\n */\nexport const useClickOutsider = () => {\n  uid++;\n  const clickOutsiderId = uid;\n  const addClickOutsider = (els: NodeElement[], handler: Handler) => {\n    const elements = Array.from(new Set(els.filter((el) => el))).map((el: any) => {\n      const node = (el.el || el.$el || el) as HTMLElement;\n      return node;\n    });\n    const documentHandler = createDocumentHandler(elements, handler, true);\n    nodeList.set(clickOutsiderId, {\n      elements,\n      handler: documentHandler,\n    });\n  };\n\n  const removeClickOutsider = () => {\n    nodeList.has(clickOutsiderId) && nodeList.delete(clickOutsiderId);\n  };\n  return {\n    clickOutsiderId,\n    addClickOutsider,\n    removeClickOutsider,\n  };\n};\n"],"names":["nodeList","Map","startClick","uid","isServer","window","document","on","e","values","handler","createDocumentHandler","elements","includePopup","POPUP_SELECTOR","usePrefixClass","querySelectorAll","value","forEach","ele","push","Array","from","Set","mouseUpTarget","target","mouseDownTarget","isTargetUnExists","isContained","some","el","isSelf","isContainedByEl","contains","useClickOutsider","clickOutsiderId","addClickOutsider","els","filter","map","node","$el","documentHandler","set","removeClickOutsider","has"],"mappings":"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"}