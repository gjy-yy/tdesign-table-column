{"version":3,"file":"useRipple.mjs","sources":["../../src/hooks/useRipple.ts"],"sourcesContent":["import { ref, onMounted, onUnmounted, Ref } from 'vue';\nimport useKeepAnimation from './useKeepAnimation';\nimport { usePrefixClass } from './useConfig';\nimport setStyle from '../utils/set-style';\n\nconst period = 200;\nconst noneRippleBg = 'rgba(0, 0, 0, 0)';\nconst defaultRippleColor = 'rgba(0, 0, 0, 0.35)';\n\n// 设置动画颜色 get the ripple animation color\nconst getRippleColor = (el: HTMLElement, fixedRippleColor?: string) => {\n  // get fixed color from params\n  if (fixedRippleColor) {\n    return fixedRippleColor;\n  }\n  // get dynamic color from the dataset\n  if (el?.dataset?.ripple) {\n    const rippleColor = el.dataset.ripple;\n    return rippleColor;\n  }\n  // use css variable\n  const cssVariable = getComputedStyle(el).getPropertyValue('--ripple-color');\n  if (cssVariable) {\n    return cssVariable;\n  }\n  return defaultRippleColor;\n};\n\n/**\n * 斜八角动画hooks 支持三种方式使用\n * 1. fixedRippleColor 固定色值 useRipple(ref,fixedRippleColor);\n * 2. dynamicColor 动态色值 data.ripple=\"rippleColor\" useRipple(ref)\n * 3. CSS variables（recommended） 配合节点对应CSS设置 --ripple-color useRipple(ref)\n * @param ref 需要使用斜八角动画的DOM\n * @param fixedRippleColor 斜八角的动画颜色\n */\nexport default function useRipple(el: Ref<HTMLElement>, fixedRippleColor?: Ref<string>) {\n  const rippleContainer = ref(null);\n  const classPrefix = usePrefixClass();\n\n  // 全局配置ripple\n  const { keepRipple } = useKeepAnimation();\n\n  // 为节点添加斜八角动画 add ripple to the DOM and set up the animation\n  const handleAddRipple = (e: MouseEvent) => {\n    const dom = el.value;\n    const rippleColor = getRippleColor(dom, fixedRippleColor?.value);\n    if (e.button !== 0 || !el || !keepRipple) return;\n\n    if (\n      dom.classList.contains(`${classPrefix.value}-is-active`) ||\n      dom.classList.contains(`${classPrefix.value}-is-disabled`) ||\n      dom.classList.contains(`${classPrefix.value}-is-checked`) ||\n      dom.classList.contains(`${classPrefix.value}-is-loading`)\n    )\n      return;\n\n    const elStyle = getComputedStyle(dom);\n\n    const elBorder = parseInt(elStyle.borderWidth, 10);\n    const border = elBorder > 0 ? elBorder : 0;\n    const width = dom.offsetWidth;\n    const height = dom.offsetHeight;\n\n    if (rippleContainer.value.parentNode === null) {\n      setStyle(rippleContainer.value, {\n        position: 'absolute',\n        left: `${0 - border}px`,\n        top: `${0 - border}px`,\n        width: `${width}px`,\n        height: `${height}px`,\n        borderRadius: elStyle.borderRadius,\n        pointerEvents: 'none',\n        overflow: 'hidden',\n      });\n      dom.appendChild(rippleContainer.value);\n    }\n    // 新增一个ripple\n    const ripple = document.createElement('div');\n\n    setStyle(ripple, {\n      marginTop: '0',\n      marginLeft: '0',\n      right: `${width}px`,\n      width: `${width + 20}px`,\n      height: '100%',\n      transition: `transform ${period}ms cubic-bezier(.38, 0, .24, 1), background ${period * 2}ms linear`,\n      transform: 'skewX(-8deg)',\n      pointerEvents: 'none',\n      position: 'absolute',\n      zIndex: 0,\n      backgroundColor: rippleColor,\n      opacity: '0.9',\n    });\n\n    // fix zIndex：避免遮盖内部元素\n    const elMap = new WeakMap();\n    for (let n = dom.children.length, i = 0; i < n; ++i) {\n      const child = dom.children[i];\n      if ((child as HTMLElement).style.zIndex === '' && child !== rippleContainer.value) {\n        (child as HTMLElement).style.zIndex = '1';\n        elMap.set(child, true);\n      }\n    }\n\n    // fix position\n    const initPosition = dom.style.position ? dom.style.position : getComputedStyle(dom).position;\n    if (initPosition === '' || initPosition === 'static') {\n      // eslint-disable-next-line no-param-reassign\n      dom.style.position = 'relative';\n    }\n    rippleContainer.value.insertBefore(ripple, rippleContainer.value.firstChild);\n\n    setTimeout(() => {\n      ripple.style.transform = `translateX(${width}px)`;\n    }, 0);\n    // 清除动画节点 clear ripple container\n    const handleClearRipple = () => {\n      ripple.style.backgroundColor = noneRippleBg;\n\n      if (!el.value) return;\n\n      el.value.removeEventListener('pointerup', handleClearRipple, false);\n      el.value.removeEventListener('pointerleave', handleClearRipple, false);\n\n      setTimeout(() => {\n        ripple.remove();\n        if (rippleContainer.value.children.length === 0) rippleContainer.value.remove();\n      }, period * 2 + 100);\n    };\n    el.value.addEventListener('pointerup', handleClearRipple, false);\n    el.value.addEventListener('pointerleave', handleClearRipple, false);\n  };\n\n  onMounted(() => {\n    const dom = el.value;\n    if (!dom) return;\n\n    rippleContainer.value = document.createElement('div');\n\n    dom.addEventListener('pointerdown', handleAddRipple, false);\n  });\n\n  onUnmounted(() => {\n    el.value?.removeEventListener('pointerdown', handleAddRipple, false);\n  });\n}\n"],"names":["period","noneRippleBg","defaultRippleColor","getRippleColor","el","fixedRippleColor","dataset","ripple","rippleColor","cssVariable","getComputedStyle","getPropertyValue","useRipple","rippleContainer","ref","classPrefix","usePrefixClass","useKeepAnimation","keepRipple","handleAddRipple","e","dom","value","button","classList","contains","elStyle","elBorder","parseInt","borderWidth","border","width","offsetWidth","height","offsetHeight","parentNode","setStyle","position","left","top","borderRadius","pointerEvents","overflow","appendChild","document","createElement","marginTop","marginLeft","right","transition","transform","zIndex","backgroundColor","opacity","elMap","WeakMap","n","children","length","i","child","style","set","initPosition","insertBefore","firstChild","setTimeout","handleClearRipple","removeEventListener","remove","addEventListener","onMounted","onUnmounted"],"mappings":"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"}