{"version":3,"file":"tooltip.mjs","sources":["../../src/tooltip/tooltip.tsx"],"sourcesContent":["import { computed, defineComponent, onMounted, ref, toRefs, watch, getCurrentInstance } from 'vue';\nimport isFunction from 'lodash/isFunction';\nimport props from './props';\nimport popupProps from '../popup/props';\nimport Popup, { PopupVisibleChangeContext } from '../popup';\nimport { usePrefixClass } from '../hooks/useConfig';\nimport { useTNodeJSX, useContent } from '../hooks/tnode';\nimport { useMouse } from './util';\nimport useVModel from '../hooks/useVModel';\n\nexport default defineComponent({\n  name: 'TTooltip',\n  props: {\n    ...popupProps,\n    ...props,\n  },\n  setup(props, ctx) {\n    const timer = ref(null);\n    const popupRef = ref(null);\n\n    const { visible, modelValue } = toRefs(props);\n    const [innerVisible, setInnerVisible] = useVModel(\n      visible,\n      modelValue,\n      props.defaultVisible,\n      props.onVisibleChange,\n      'visible',\n    );\n    const vm = getCurrentInstance();\n    const innerTooltipVisible = ref(props.visible || props.defaultVisible);\n    const classPrefix = usePrefixClass();\n    const renderTNodeJSX = useTNodeJSX();\n    const renderContent = useContent();\n    const { x } = useMouse();\n    const offsetX = ref(x.value);\n\n    onMounted(() => {\n      if (props.duration && innerTooltipVisible.value) {\n        timer.value = setTimeout(() => {\n          innerTooltipVisible.value = false;\n          clearTimeout(timer.value);\n          timer.value = null;\n        }, props.duration);\n      }\n    });\n\n    const onTipVisibleChange = (val: boolean, ctx?: PopupVisibleChangeContext) => {\n      // 因 props={this.getPopupProps()} 已经透传 onVisibleChange props，此处不再需要使用 emitEvent\n      if (timer.value && ctx?.trigger !== 'document') return;\n      if (val) {\n        offsetX.value = x.value;\n      }\n      setInnerVisible(val, ctx);\n    };\n\n    const tooltipOverlayClassName = computed(() => {\n      return [\n        `${classPrefix.value}-tooltip`,\n        { [`${classPrefix.value}-tooltip--${props.theme}`]: props.theme },\n        props.overlayClassName,\n      ];\n    });\n\n    const popupProps = computed(() => ({\n      ...(vm?.vnode.props || {}),\n      placement: props.placement === 'mouse' ? 'bottom-left' : props.placement,\n      showArrow: props.placement === 'mouse' ? false : props.showArrow,\n      content: () => renderTNodeJSX('content'),\n      default: () => renderContent('default', 'triggerElement'),\n      overlayClassName: tooltipOverlayClassName.value,\n      onVisibleChange: onTipVisibleChange,\n    }));\n\n    const overlayInnerStyle = computed(() => {\n      if (props.placement !== 'mouse' || offsetX.value === 0) {\n        return props.overlayInnerStyle;\n      }\n      const offsetStyle = (triggerEl: HTMLElement) => ({\n        transform: `translateX(${offsetX.value - triggerEl.getBoundingClientRect().left}px)`,\n      });\n      if (props.overlayInnerStyle) {\n        return (triggerEl: HTMLElement, popupEl: HTMLElement) => ({\n          ...offsetStyle(triggerEl),\n          ...(isFunction(props.overlayInnerStyle)\n            ? props.overlayInnerStyle(triggerEl, popupEl)\n            : props.overlayInnerStyle),\n        });\n      }\n      return offsetStyle;\n    });\n\n    watch(\n      () => innerTooltipVisible.value,\n      () => {\n        if (timer.value && !innerTooltipVisible.value) {\n          clearTimeout(timer.value);\n          timer.value = null;\n        }\n      },\n    );\n\n    const onPopupUpdate = () => {\n      popupRef.value?.updatePopper?.();\n    };\n\n    /**\n     * 透传更新popup实例方法，供外部调用\n     */\n    ctx.expose({\n      updatePopper: onPopupUpdate,\n    });\n\n    return () => (\n      <Popup\n        ref={popupRef}\n        visible={innerVisible.value}\n        {...popupProps.value}\n        overlayInnerStyle={overlayInnerStyle.value}\n      />\n    );\n  },\n});\n"],"names":["defineComponent","name","props","popupProps","setup","ctx","timer","ref","popupRef","toRefs","visible","modelValue","useVModel","defaultVisible","onVisibleChange","innerVisible","setInnerVisible","vm","getCurrentInstance","innerTooltipVisible","classPrefix","usePrefixClass","renderTNodeJSX","useTNodeJSX","renderContent","useContent","useMouse","x","offsetX","value","onMounted","duration","setTimeout","clearTimeout","onTipVisibleChange","val","trigger","tooltipOverlayClassName","computed","theme","overlayClassName","vnode","placement","showArrow","content","overlayInnerStyle","offsetStyle","triggerEl","transform","getBoundingClientRect","left","popupEl","isFunction","watch","onPopupUpdate","updatePopper","expose","_createVNode","_mergeProps"],"mappings":"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"}