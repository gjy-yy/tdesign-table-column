{"version":3,"file":"ImageItem.mjs","sources":["../../../src/image-viewer/base/ImageItem.tsx"],"sourcesContent":["import { computed, defineComponent, ref, watch } from 'vue';\nimport { ImageErrorIcon } from 'tdesign-icons-vue-next';\nimport { usePrefixClass } from '../../hooks/useConfig';\nimport { useDrag } from '../hooks';\n\nexport default defineComponent({\n  name: 'TImageItem',\n  props: {\n    rotate: Number,\n    scale: Number,\n    mirror: Number,\n    src: String,\n    placementSrc: String,\n  },\n  setup(props) {\n    const classPrefix = usePrefixClass();\n    const error = ref(false);\n    const loaded = ref(false);\n    const { transform, mouseDownHandler } = useDrag({ translateX: 0, translateY: 0 });\n\n    const imgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !props.placementSrc || loaded.value ? 'block' : 'none',\n    }));\n    const placementImgStyle = computed(() => ({\n      transform: `rotate(${props.rotate}deg) scale(${props.scale})`,\n      display: !loaded.value ? 'block' : 'none',\n    }));\n    const boxStyle = computed(() => {\n      const { translateX, translateY } = transform.value;\n      return {\n        transform: `translate(${translateX}px, ${translateY}px) scale(${props.mirror}, 1)`,\n      };\n    });\n\n    const resetStatus = () => {\n      error.value = false;\n      loaded.value = false;\n    };\n\n    watch(\n      () => props.src,\n      () => {\n        resetStatus();\n      },\n    );\n\n    return () => (\n      <div class={`${classPrefix.value}-image-viewer__modal--pic`}>\n        <div class={`${classPrefix.value}-image-viewer__modal--box`} style={boxStyle.value}>\n          {error.value && (\n            <div class={`${classPrefix.value}-image-viewer__img-error`}>\n              {/* 脱离文档流 */}\n              <div class={`${classPrefix.value}-image-viewer__img-error--content`}>\n                <ImageErrorIcon size=\"4em\" />\n                <div class={`${classPrefix.value}-image-viewer__img-error--text`}>图片加载失败，可尝试重新加载</div>\n              </div>\n            </div>\n          )}\n\n          {!error.value && !!props.placementSrc && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal--image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={props.placementSrc}\n              style={placementImgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n\n          {!error.value && (\n            <img\n              class={`${classPrefix.value}-image-viewer__modal--image`}\n              onMousedown={(event: MouseEvent) => {\n                event.stopPropagation();\n                mouseDownHandler(event);\n              }}\n              src={props.src}\n              onLoad={() => (loaded.value = true)}\n              onError={() => (error.value = true)}\n              style={imgStyle.value}\n              alt=\"image\"\n              draggable=\"false\"\n            />\n          )}\n        </div>\n      </div>\n    );\n  },\n});\n"],"names":["defineComponent","name","props","rotate","Number","scale","mirror","src","String","placementSrc","setup","classPrefix","usePrefixClass","error","ref","loaded","useDrag","translateX","translateY","transform","mouseDownHandler","imgStyle","computed","display","value","placementImgStyle","boxStyle","resetStatus","watch","_createVNode","event","stopPropagation"],"mappings":"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"}