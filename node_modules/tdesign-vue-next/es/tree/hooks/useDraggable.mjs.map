{"version":3,"file":"useDraggable.mjs","sources":["../../../src/tree/hooks/useDraggable.ts"],"sourcesContent":["import { ref, toRefs, inject } from 'vue';\nimport throttle from 'lodash/throttle';\nimport { TreeNode } from '../../_common/js/tree/tree-node';\nimport { DropPosition } from '../interface';\nimport { dragInjectKey } from '../constants';\n\nexport default function useDraggable(props: { nodeRef: HTMLElement | undefined; node: TreeNode }) {\n  const { nodeRef, node } = toRefs(props);\n  const onDrag = inject(dragInjectKey);\n\n  const isDragOver = ref(false);\n  const isDragging = ref(false);\n  const dropPosition = ref<DropPosition>(0);\n\n  const updateDropPosition = throttle((e: DragEvent) => {\n    if (!nodeRef.value) return;\n\n    const rect = nodeRef.value.getBoundingClientRect();\n    const offsetY = window.pageYOffset + rect.top;\n    const { pageY } = e;\n    const gapHeight = rect.height / 4;\n    const diff = pageY - offsetY;\n\n    // 其实三元可行\n    if (diff < gapHeight) {\n      dropPosition.value = -1;\n    } else if (diff < rect.height - gapHeight) {\n      dropPosition.value = 0;\n    } else {\n      dropPosition.value = 1;\n    }\n  });\n\n  const setDragStatus = (status: 'dragStart' | 'dragOver' | 'dragLeave' | 'dragEnd' | 'drop', e: DragEvent) => {\n    switch (status) {\n      case 'dragStart':\n        isDragging.value = true;\n        dropPosition.value = 0;\n        onDrag.onDragStart?.({ node: node.value, e });\n        break;\n      case 'dragEnd':\n        isDragging.value = false;\n        isDragOver.value = false;\n        dropPosition.value = 0;\n        updateDropPosition.cancel();\n        onDrag.onDragEnd?.({ node: node.value, e });\n        break;\n      case 'dragOver':\n        isDragOver.value = true;\n        updateDropPosition(e);\n        onDrag.onDragOver?.({ node: node.value, e });\n        break;\n      case 'dragLeave':\n        isDragOver.value = false;\n        dropPosition.value = 0;\n        updateDropPosition.cancel();\n        onDrag.onDragLeave?.({ node: node.value, e });\n        break;\n      case 'drop':\n        onDrag.onDrop?.({ node: node.value, dropPosition: dropPosition.value, e });\n        isDragOver.value = false;\n        updateDropPosition.cancel();\n        break;\n      default:\n        break;\n    }\n  };\n\n  return {\n    isDragOver,\n    isDragging,\n    dropPosition,\n    setDragStatus,\n  };\n}\n"],"names":["useDraggable","props","toRefs","nodeRef","node","onDrag","inject","dragInjectKey","isDragOver","ref","isDragging","dropPosition","updateDropPosition","throttle","e","value","rect","getBoundingClientRect","offsetY","window","pageYOffset","top","pageY","gapHeight","height","diff","setDragStatus","status","onDragStart","cancel","onDragEnd","onDragOver","onDragLeave","onDrop"],"mappings":"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"}